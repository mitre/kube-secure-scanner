
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A flexible, security-focused framework for scanning containers in Kubernetes environments with multiple scanning engines">
      
      
        <meta name="author" content="MITRE SAF Team">
      
      
        <link rel="canonical" href="http://localhost:8000/gitlab-pipeline-examples/">
      
      
        <link rel="prev" href="../github-workflow-examples/inventory/">
      
      
        <link rel="next" href="inventory/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>GitLab Pipelines - Kube Secure Scanner</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gitlab-pipeline-examples" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Kube Secure Scanner" class="md-header__button md-logo" aria-label="Kube Secure Scanner" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kube Secure Scanner
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GitLab Pipelines
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mitre/kube-secure-scanner" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    mitre/kube-secure-scanner
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../tasks/" class="md-tabs__link">
          
  
  Common Tasks

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../developer-guide/deployment/scenarios/enterprise/" class="md-tabs__link">
          
  
  Deployment Scenarios

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../approaches/" class="md-tabs__link">
          
  
  Technical Documentation

        </a>
      </li>
    
  

    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../configuration/" class="md-tabs__link">
          
  
  Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../developer-guide/" class="md-tabs__link">
          
  
  Project

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Kube Secure Scanner" class="md-nav__button md-logo" aria-label="Kube Secure Scanner" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Kube Secure Scanner
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mitre/kube-secure-scanner" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    mitre/kube-secure-scanner
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../site-index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Site Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common-abbreviations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Common Abbreviations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/executive-summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Executive Summary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/compliance/approach-comparison/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Approach Security Comparison
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/risk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Risk Considerations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Technical Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/enterprise-integration-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enterprise Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/ascii-diagrams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASCII Diagrams
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Learning Paths
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            Learning Paths
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learning-paths/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learning-paths/new-users/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    For New Users
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learning-paths/security-first/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security-First Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learning-paths/core-concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learning-paths/implementation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Implementation Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learning-paths/advanced-features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learning-paths/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learning-paths/template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Template
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Common Tasks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Common Tasks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Template
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scanning Containers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Scanning Containers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/standard-container-scan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standard Container Scan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/distroless-container-scan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distroless Container Scan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/sidecar-container-scan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sidecar Container Scan
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes Scripts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes Scripts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes-scripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes-scripts/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Script Inventory
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CI/CD Integration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            CI/CD Integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/github-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Actions Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/gitlab-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab CI Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/thresholds-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuring Thresholds
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Security Setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Security Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/rbac-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RBAC Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/token-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Token Management
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/kubernetes-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/helm-deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Helm Chart Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/script-deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Script-Based Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment Scenarios
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Deployment Scenarios
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/scenarios/enterprise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enterprise Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/scenarios/development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/scenarios/cicd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/scenarios/multi-tenant/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi-Tenant Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/scenarios/air-gapped/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Air-Gapped Environment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Technical Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Technical Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Approaches
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Approaches
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/comparison/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Comparison
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/decision-matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decision Matrix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/direct-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Direct Commands
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_6" >
        
          
          <label class="md-nav__link" for="__nav_4_1_6" id="__nav_4_1_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes API Approach
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_6">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes API Approach
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/kubernetes-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/kubernetes-api/implementation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/kubernetes-api/rbac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RBAC Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/kubernetes-api/limitations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Limitations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/kubernetes-api/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_7" >
        
          
          <label class="md-nav__link" for="__nav_4_1_7" id="__nav_4_1_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Debug Container Approach
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_7">
            <span class="md-nav__icon md-icon"></span>
            Debug Container Approach
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/debug-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/debug-container/distroless-basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distroless Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/debug-container/implementation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/debug-container/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_8" >
        
          
          <label class="md-nav__link" for="__nav_4_1_8" id="__nav_4_1_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Sidecar Container Approach
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_8">
            <span class="md-nav__icon md-icon"></span>
            Sidecar Container Approach
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/sidecar-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/sidecar-container/implementation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/sidecar-container/pod-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pod Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/sidecar-container/retrieving-results/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Retrieving Results
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/sidecar-container/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_9" >
        
          
          <label class="md-nav__link" for="__nav_4_1_9" id="__nav_4_1_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Helper Scripts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_9">
            <span class="md-nav__icon md-icon"></span>
            Helper Scripts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/helper-scripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/helper-scripts/available-scripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Available Scripts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/helper-scripts/scripts-vs-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scripts vs. Commands
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../approaches/helper-scripts/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Components
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3">
            <span class="md-nav__icon md-icon"></span>
            Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/components/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/components/core-components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/components/security-components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/components/communication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Communication
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2_4" >
        
          
          <label class="md-nav__link" for="__nav_4_2_4" id="__nav_4_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workflows
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4">
            <span class="md-nav__icon md-icon"></span>
            Workflows
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/workflows/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/workflows/standard-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standard Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/workflows/distroless-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distroless Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/workflows/sidecar-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sidecar Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/workflows/security-workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Workflows
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2_5" >
        
          
          <label class="md-nav__link" for="__nav_4_2_5" id="__nav_4_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Diagrams
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_5">
            <span class="md-nav__icon md-icon"></span>
            Diagrams
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/diagrams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/diagrams/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/diagrams/component-diagrams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Component Diagrams
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/diagrams/workflow-diagrams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workflow Diagrams
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/diagrams/deployment-diagrams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment Diagrams
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2_6" >
        
          
          <label class="md-nav__link" for="__nav_4_2_6" id="__nav_4_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/deployment/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/deployment/script-deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Script Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/deployment/helm-deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Helm Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/deployment/ci-cd-deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2_7" >
        
          
          <label class="md-nav__link" for="__nav_4_2_7" id="__nav_4_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Integrations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_7">
            <span class="md-nav__icon md-icon"></span>
            Integrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/integrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/integrations/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/integrations/github-actions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/integrations/gitlab-ci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab CI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/integrations/gitlab-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/integrations/custom-integrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Integrations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3_3" id="__nav_4_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Security Principles
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_3">
            <span class="md-nav__icon md-icon"></span>
            Security Principles
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/principles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/principles/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/principles/least-privilege/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Least Privilege
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/principles/ephemeral-creds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ephemeral Credentials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/principles/resource-isolation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resource Isolation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/principles/secure-transport/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secure Transport
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3_4" >
        
          
          <label class="md-nav__link" for="__nav_4_3_4" id="__nav_4_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Risk Analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_4">
            <span class="md-nav__icon md-icon"></span>
            Risk Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/risk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Risk Considerations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/risk/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/risk/model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Risk Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/risk/kubernetes-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes API Approach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/risk/debug-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Container Approach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/risk/sidecar-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sidecar Container Approach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/risk/mitigations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Risk Mitigations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3_5" >
        
          
          <label class="md-nav__link" for="__nav_4_3_5" id="__nav_4_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Threat Model
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_5">
            <span class="md-nav__icon md-icon"></span>
            Threat Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/threat-model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/threat-model/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/threat-model/attack-vectors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Attack Vectors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/threat-model/lateral-movement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lateral Movement
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/threat-model/token-exposure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Token Exposure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/threat-model/threat-mitigations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Threat Mitigations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3_6" >
        
          
          <label class="md-nav__link" for="__nav_4_3_6" id="__nav_4_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Compliance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_6">
            <span class="md-nav__icon md-icon"></span>
            Compliance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/compliance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/compliance/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/compliance/approach-comparison/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Approach Security Comparison
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/compliance/risk-documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Risk Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/compliance/cis-benchmarks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CIS Benchmarks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/compliance/disa-srg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DISA SRG
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/compliance/dod-8500-01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DoD 8500.01
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/compliance/kubernetes-stig/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes STIG
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/compliance/nsa-cisa-hardening/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NSA/CISA Hardening Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3_7" >
        
          
          <label class="md-nav__link" for="__nav_4_3_7" id="__nav_4_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Recommendations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_7">
            <span class="md-nav__icon md-icon"></span>
            Recommendations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/recommendations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/recommendations/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/recommendations/network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Security
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1_3" >
        
          
          <label class="md-nav__link" for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubeconfig
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3">
            <span class="md-nav__icon md-icon"></span>
            Kubeconfig
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/kubeconfig/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/kubeconfig/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/kubeconfig/generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/kubeconfig/management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/kubeconfig/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/kubeconfig/dynamic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1_4" >
        
          
          <label class="md-nav__link" for="__nav_5_1_4" id="__nav_5_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Thresholds
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_4">
            <span class="md-nav__icon md-icon"></span>
            Thresholds
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/thresholds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/thresholds/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/thresholds/basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/thresholds/advanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/thresholds/examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example Configurations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/thresholds/cicd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Integration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1_5" >
        
          
          <label class="md-nav__link" for="__nav_5_1_5" id="__nav_5_1_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Plugins
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_5">
            <span class="md-nav__icon md-icon"></span>
            Plugins
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/plugins/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/plugins/distroless/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distroless Support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/plugins/implementation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Implementation Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/plugins/testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1_6" >
        
          
          <label class="md-nav__link" for="__nav_5_1_6" id="__nav_5_1_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Integration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_6">
            <span class="md-nav__icon md-icon"></span>
            Integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/integration/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/integration/saf-cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SAF CLI Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/integration/github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/integration/gitlab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab CI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1_7" >
        
          
          <label class="md-nav__link" for="__nav_5_1_7" id="__nav_5_1_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_7">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/security/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/security/hardening/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardening
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/security/credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Credential Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/security/rbac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RBAC Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1_8" >
        
          
          <label class="md-nav__link" for="__nav_5_1_8" id="__nav_5_1_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_8">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/advanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/advanced/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Integration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/approach-mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Approach Mapping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/gitlab-services-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_5" >
        
          
          <label class="md-nav__link" for="__nav_5_2_5" id="__nav_5_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Platforms
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_5">
            <span class="md-nav__icon md-icon"></span>
            Platforms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/platforms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/platforms/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/platforms/github-actions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/platforms/gitlab-ci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab CI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/platforms/gitlab-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab Services
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_6" >
        
          
          <label class="md-nav__link" for="__nav_5_2_6" id="__nav_5_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workflows
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_6">
            <span class="md-nav__icon md-icon"></span>
            Workflows
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/workflows/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/workflows/standard-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standard Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/workflows/distroless-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distroless Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/workflows/sidecar-container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sidecar Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/workflows/security-workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Workflows
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_7" >
        
          
          <label class="md-nav__link" for="__nav_5_2_7" id="__nav_5_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_7">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/configuration/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/configuration/environment-variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Environment Variables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/configuration/secrets-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secrets Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/configuration/thresholds-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thresholds Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/configuration/reporting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reporting Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_8" >
        
          
          <label class="md-nav__link" for="__nav_5_2_8" id="__nav_5_2_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_8">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/examples/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/examples/github-examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/examples/gitlab-examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab Examples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Helm Charts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Helm Charts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3_3" id="__nav_5_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_3">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/overview/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/overview/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3_4" >
        
          
          <label class="md-nav__link" for="__nav_5_3_4" id="__nav_5_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scanner Types
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_4">
            <span class="md-nav__icon md-icon"></span>
            Scanner Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/scanner-types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/scanner-types/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/scanner-types/common-scanner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Common Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/scanner-types/standard-scanner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes API Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/scanner-types/distroless-scanner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Container Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/scanner-types/sidecar-scanner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sidecar Container Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3_5" >
        
          
          <label class="md-nav__link" for="__nav_5_3_5" id="__nav_5_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scanner Infrastructure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_5">
            <span class="md-nav__icon md-icon"></span>
            Scanner Infrastructure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/scanner-infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/scanner-infrastructure/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3_6" >
        
          
          <label class="md-nav__link" for="__nav_5_3_6" id="__nav_5_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Infrastructure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_6">
            <span class="md-nav__icon md-icon"></span>
            Infrastructure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/infrastructure/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/infrastructure/rbac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RBAC Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/infrastructure/service-accounts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Accounts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/infrastructure/namespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Namespaces
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3_7" >
        
          
          <label class="md-nav__link" for="__nav_5_3_7" id="__nav_5_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_7">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/usage/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/usage/customization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customization Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/usage/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/usage/values/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Values Files
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3_8" >
        
          
          <label class="md-nav__link" for="__nav_5_3_8" id="__nav_5_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_8">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/security/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/security/best-practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Best Practices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/security/rbac-hardening/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RBAC Hardening
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/security/risk-assessment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Risk Assessment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3_9" >
        
          
          <label class="md-nav__link" for="__nav_5_3_9" id="__nav_5_3_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Operations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_9">
            <span class="md-nav__icon md-icon"></span>
            Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/operations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/operations/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/operations/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/operations/performance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/operations/maintenance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maintenance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Authentication
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Authentication
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rbac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RBAC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rbac/label-based/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Label-based RBAC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rbac/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tokens/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tokens
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tokens/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Token Directory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../service-accounts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Accounts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../service-accounts/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Accounts Directory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4_8" >
        
          
          <label class="md-nav__link" for="__nav_5_4_8" id="__nav_5_4_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes Setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_8">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes-setup/existing-cluster-requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Requirements for Existing Clusters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes-setup/minikube-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Minikube Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes-setup/best-practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Best Practices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes-setup/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Example Resources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Example Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../github-workflow-examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Workflows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../github-workflow-examples/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Workflow Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    GitLab Pipelines
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    GitLab Pipelines
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#available-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Available Examples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-gitlab-ci-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Standard GitLab CI Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-rbac-scanning-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic RBAC Scanning Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#existing-cluster-scanning-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Existing Cluster Scanning Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gitlab-ci-with-services-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      GitLab CI with Services Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidecar-container-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Sidecar Container Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidecar-with-services-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Sidecar with Services Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab Pipeline Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gitlab-services-examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gitlab-services-examples/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab Services Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/code-display-demo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Display Demo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_5_10" id="__nav_5_5_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Script References
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_10">
            <span class="md-nav__icon md-icon"></span>
            Script References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes-scripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Project
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Project
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1_3" >
        
          
          <label class="md-nav__link" for="__nav_6_1_3" id="__nav_6_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_3">
            <span class="md-nav__icon md-icon"></span>
            Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/testing/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1_4" >
        
          
          <label class="md-nav__link" for="__nav_6_1_4" id="__nav_6_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_4">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1_4_3" >
        
          
          <label class="md-nav__link" for="__nav_6_1_4_3" id="__nav_6_1_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment Methods
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_4_3">
            <span class="md-nav__icon md-icon"></span>
            Deployment Methods
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/script-deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Script Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/helm-deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Helm Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/cicd-deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Integration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1_4_4" >
        
          
          <label class="md-nav__link" for="__nav_6_1_4_4" id="__nav_6_1_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment Scenarios
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_4_4">
            <span class="md-nav__icon md-icon"></span>
            Deployment Scenarios
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/scenarios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/scenarios/enterprise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enterprise Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/scenarios/development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/scenarios/cicd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/scenarios/multi-tenant/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi-Tenant Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/scenarios/air-gapped/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Air-Gapped Environment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1_4_5" >
        
          
          <label class="md-nav__link" for="__nav_6_1_4_5" id="__nav_6_1_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced Topics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_4_5">
            <span class="md-nav__icon md-icon"></span>
            Advanced Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/advanced-topics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/advanced-topics/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/advanced-topics/scaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scaling and Performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/advanced-topics/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Enhancements
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/advanced-topics/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring and Maintenance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/advanced-topics/specialized-environments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Specialized Environments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/advanced-topics/verification/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment Verification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/deployment/advanced-topics/custom-development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Development
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/documentation-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/stig-api-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STIG/SRG API Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/code-snippets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Snippets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/diagram-color-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diagram Color Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2_7" >
        
          
          <label class="md-nav__link" for="__nav_6_2_7" id="__nav_6_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Documentation Testing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_7">
            <span class="md-nav__icon md-icon"></span>
            Documentation Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/testing/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/testing/dark-light-mode-test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Theme Testing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Project Information
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Project Information
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tasks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3_5" >
        
          
          <label class="md-nav__link" for="__nav_6_3_5" id="__nav_6_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_5">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/documentation-gaps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Gaps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/content-map/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Content Map
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/content-organization-approach/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Content Organization Approach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/project-target-organization-plan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Restructuring Plan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/documentation-entry-refactoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Refactoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/documentation-review-plan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Review Plan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/documentation-cleanup-progress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Cleanup Progress
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/documentation-cleanup-plan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Cleanup Plan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/warning-resolution-scripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Warning Resolution Scripts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/documentation-coming-soon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coming Soon Documents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/security-nav-update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Navigation Update
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/terminology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terminology
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../includes/abbreviations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abbreviations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3_5_15" >
        
          
          <label class="md-nav__link" for="__nav_6_3_5_15" id="__nav_6_3_5_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reorganization Summaries
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_3_5_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_5_15">
            <span class="md-nav__icon md-icon"></span>
            Reorganization Summaries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/integration-reorganization-summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integration Reorganization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/architecture-reorganization-summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture Reorganization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/approaches-reorganization-summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Approaches Reorganization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/configuration-reorganization-summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration Reorganization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/helm-charts-reorganization-summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Helm Charts Reorganization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/security-reorganization-summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Reorganization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/security-reorganization-plan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Reorganization Plan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/documentation-structure-progress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Structure
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3_6" >
        
          
          <label class="md-nav__link" for="__nav_6_3_6" id="__nav_6_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tools & Utilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_6">
            <span class="md-nav__icon md-icon"></span>
            Tools & Utilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/documentation-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/mkdocs-material-features-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MkDocs Material Features Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/ascii-to-mermaid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASCII to Mermaid Conversion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/mkdocs-link-fixer-proposal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MkDocs Link Fixer Proposal
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3_7" >
        
          
          <label class="md-nav__link" for="__nav_6_3_7" id="__nav_6_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_7">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/archive/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/archive/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Directory Contents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/archive/ascii-diagrams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASCII Diagrams
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#available-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Available Examples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-gitlab-ci-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Standard GitLab CI Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-rbac-scanning-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic RBAC Scanning Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#existing-cluster-scanning-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Existing Cluster Scanning Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gitlab-ci-with-services-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      GitLab CI with Services Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidecar-container-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Sidecar Container Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidecar-with-services-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Sidecar with Services Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="gitlab-pipeline-examples">GitLab Pipeline Examples<a class="headerlink" href="#gitlab-pipeline-examples" title="Permanent link">&para;</a></h1>
<p>This directory contains example GitLab CI pipeline configuration files that demonstrate various container scanning approaches.</p>
<h2 id="available-examples">Available Examples<a class="headerlink" href="#available-examples" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Standard Kubernetes API</strong>: Four-stage pipeline for container scanning using the Kubernetes API</li>
<li><strong>Dynamic RBAC Scanning</strong>: Label-based pod targeting with restricted RBAC permissions</li>
<li><strong>Existing Cluster Scanning</strong>: Configuration for scanning distroless containers</li>
<li><strong>GitLab CI with Services</strong>: Pipeline using GitLab services for a pre-configured scanning environment</li>
<li><strong>Sidecar Container</strong>: Pipeline implementing pod deployment with shared process namespace</li>
<li><strong>Sidecar with Services</strong>: Pipeline using GitLab services for sidecar scanner deployment</li>
</ul>
<h2 id="standard-gitlab-ci-pipeline">Standard GitLab CI Pipeline<a class="headerlink" href="#standard-gitlab-ci-pipeline" title="Permanent link">&para;</a></h2>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">  1</a></span>
<span class="normal"><a href="#__codelineno-0-2">  2</a></span>
<span class="normal"><a href="#__codelineno-0-3">  3</a></span>
<span class="normal"><a href="#__codelineno-0-4">  4</a></span>
<span class="normal"><a href="#__codelineno-0-5">  5</a></span>
<span class="normal"><a href="#__codelineno-0-6">  6</a></span>
<span class="normal"><a href="#__codelineno-0-7">  7</a></span>
<span class="normal"><a href="#__codelineno-0-8">  8</a></span>
<span class="normal"><a href="#__codelineno-0-9">  9</a></span>
<span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nt">stages</span><span class="p">:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">report</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">  </span><span class="nt">SCANNER_NAMESPACE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;inspec-test&quot;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">  </span><span class="nt">TARGET_LABEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app=target-app&quot;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">  </span><span class="nt">THRESHOLD_VALUE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;70&quot;</span><span class="w">  </span><span class="c1"># Minimum passing score (0-100)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="nt">deploy_container</span><span class="p">:</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">      </span><span class="no">kind: Pod</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">        </span><span class="no">name: scan-target-${CI_PIPELINE_ID}</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">        </span><span class="no">labels:</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">          </span><span class="no">app: target-app</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">          </span><span class="no">pipeline: &quot;${CI_PIPELINE_ID}&quot;</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">      </span><span class="no">spec:</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">        </span><span class="no">containers:</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">        </span><span class="no">- name: target</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">          </span><span class="no">image: registry.example.com/my-image:latest</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">          </span><span class="no">command: [&quot;sleep&quot;, &quot;1h&quot;]</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">      </span><span class="no"># Wait for pod to be ready</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">      </span><span class="no">kubectl wait --for=condition=ready pod/scan-target-${CI_PIPELINE_ID} \</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">        </span><span class="no">-n ${SCANNER_NAMESPACE} --timeout=120s</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">      </span><span class="no"># Save target info for later stages</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">      </span><span class="no">echo &quot;TARGET_POD=scan-target-${CI_PIPELINE_ID}&quot; &gt;&gt; deploy.env</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">      </span><span class="no">echo &quot;TARGET_CONTAINER=target&quot; &gt;&gt; deploy.env</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy.env</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="nt">create_access</span><span class="p">:</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">deploy_container</span><span class="p p-Indicator">]</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">      </span><span class="no"># Create the role for this specific pod</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">      </span><span class="no">apiVersion: rbac.authorization.k8s.io/v1</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">      </span><span class="no">kind: Role</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="w">        </span><span class="no">name: scanner-role-${CI_PIPELINE_ID}</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">      </span><span class="no">rules:</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">        </span><span class="no">resources: [&quot;pods&quot;]</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">        </span><span class="no">verbs: [&quot;get&quot;, &quot;list&quot;]</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="w">        </span><span class="no">resources: [&quot;pods/exec&quot;]</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="w">        </span><span class="no">verbs: [&quot;create&quot;]</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="w">        </span><span class="no">resourceNames: [&quot;${TARGET_POD}&quot;]</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">        </span><span class="no">resources: [&quot;pods/log&quot;]</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">        </span><span class="no">verbs: [&quot;get&quot;]</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">        </span><span class="no">resourceNames: [&quot;${TARGET_POD}&quot;]</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="w">      </span><span class="no"># Create service account</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">      </span><span class="no">kind: ServiceAccount</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="w">        </span><span class="no">name: scanner-sa-${CI_PIPELINE_ID}</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="w">      </span><span class="no"># Create role binding</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="w">      </span><span class="no">apiVersion: rbac.authorization.k8s.io/v1</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="w">      </span><span class="no">kind: RoleBinding</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="w">        </span><span class="no">name: scanner-binding-${CI_PIPELINE_ID}</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">      </span><span class="no">subjects:</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">      </span><span class="no">- kind: ServiceAccount</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="w">        </span><span class="no">name: scanner-sa-${CI_PIPELINE_ID}</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="w">      </span><span class="no">roleRef:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">        </span><span class="no">kind: Role</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="w">        </span><span class="no">name: scanner-role-${CI_PIPELINE_ID}</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">        </span><span class="no">apiGroup: rbac.authorization.k8s.io</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">      </span><span class="no"># Generate token</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="w">      </span><span class="no">TOKEN=$(kubectl create token scanner-sa-${CI_PIPELINE_ID} \</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="w">        </span><span class="no">-n ${SCANNER_NAMESPACE} --duration=30m)</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">      </span><span class="no">echo &quot;SCANNER_TOKEN=${TOKEN}&quot; &gt;&gt; scanner.env</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">      </span><span class="no"># Save cluster info</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">      </span><span class="no">SERVER=$(kubectl config view --minify -o jsonpath=&#39;{.clusters[0].cluster.server}&#39;)</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="w">      </span><span class="no">CA_DATA=$(kubectl config view --raw --minify --flatten \</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">        </span><span class="no">-o jsonpath=&#39;{.clusters[].cluster.certificate-authority-data}&#39;)</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="w">      </span><span class="no">echo &quot;CLUSTER_SERVER=${SERVER}&quot; &gt;&gt; scanner.env</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="w">      </span><span class="no">echo &quot;CLUSTER_CA_DATA=${CA_DATA}&quot; &gt;&gt; scanner.env</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scanner.env</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="nt">run_scan</span><span class="p">:</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">deploy_container</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">create_access</span><span class="p p-Indicator">]</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">      </span><span class="no"># Create a kubeconfig file</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">      </span><span class="no">cat &gt; scan-kubeconfig.yaml &lt;&lt; EOF</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="w">      </span><span class="no">kind: Config</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="w">      </span><span class="no">preferences: {}</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="w">      </span><span class="no">clusters:</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="w">      </span><span class="no">- cluster:</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">          </span><span class="no">server: ${CLUSTER_SERVER}</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">          </span><span class="no">certificate-authority-data: ${CLUSTER_CA_DATA}</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="w">        </span><span class="no">name: scanner-cluster</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">      </span><span class="no">contexts:</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">      </span><span class="no">- context:</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="w">          </span><span class="no">cluster: scanner-cluster</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="w">          </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="w">          </span><span class="no">user: scanner-user</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="w">        </span><span class="no">name: scanner-context</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="w">      </span><span class="no">current-context: scanner-context</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">      </span><span class="no">users:</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="w">      </span><span class="no">- name: scanner-user</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="w">        </span><span class="no">user:</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">          </span><span class="no">token: ${SCANNER_TOKEN}</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="w">      </span><span class="no"># Install CINC Auditor</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="w">      </span><span class="no">curl -L https://omnitruck.cinc.sh/install.sh | sudo bash -s -- -P cinc-auditor</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="w">      </span><span class="no"># Install train-k8s-container plugin</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">      </span><span class="no">cinc-auditor plugin install train-k8s-container</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="w">      </span><span class="no"># Install SAF CLI</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="w">      </span><span class="no">npm install -g @mitre/saf</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="w">      </span><span class="no"># Run cinc-auditor scan</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="w">      </span><span class="no">KUBECONFIG=scan-kubeconfig.yaml \</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="w">        </span><span class="no">cinc-auditor exec ${CINC_PROFILE_PATH} \</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">        </span><span class="no">-t k8s-container://${SCANNER_NAMESPACE}/${TARGET_POD}/${TARGET_CONTAINER} \</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="w">        </span><span class="no">--reporter json:scan-results.json</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="w">      </span><span class="no"># Generate scan summary using SAF CLI</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="w">      </span><span class="no">saf summary --input scan-results.json --output-md scan-summary.md</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="w">      </span><span class="no"># Display summary in job output</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="w">      </span><span class="no">cat scan-summary.md</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">      </span><span class="no"># Check scan against threshold</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="w">      </span><span class="no">saf threshold -i scan-results.json -t ${THRESHOLD_VALUE}</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="w">      </span><span class="no">THRESHOLD_RESULT=$?</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">      </span><span class="no"># Save result for later stages</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="w">      </span><span class="no">echo &quot;THRESHOLD_PASSED=${THRESHOLD_RESULT}&quot; &gt;&gt; scan.env</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="w">      </span><span class="no">if [ ${THRESHOLD_RESULT} -eq 0 ]; then</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="w">        </span><span class="no">echo &quot; Security scan passed threshold requirements&quot;</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="w">      </span><span class="no">else</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="w">        </span><span class="no">echo &quot; Security scan failed to meet threshold requirements&quot;</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="w">        </span><span class="no"># Uncomment to enforce threshold as a gate</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="w">        </span><span class="no"># exit ${THRESHOLD_RESULT}</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-results.json</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-summary.md</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan.env</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="nt">generate_report</span><span class="p">:</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">report</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">run_scan</span><span class="p p-Indicator">]</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="w">      </span><span class="no"># Install SAF CLI if needed in this stage</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="w">      </span><span class="no">which saf || npm install -g @mitre/saf</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="w">      </span><span class="no"># Generate a more comprehensive report</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="w">      </span><span class="no">saf view -i scan-results.json --output scan-report.html</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="w">      </span><span class="no"># Create a simple markdown report for the MR</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="w">      </span><span class="no">cat &gt; scan-report.md &lt;&lt; EOF</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="w">      </span><span class="no"># Security Scan Results</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="w">      </span><span class="no">## Summary</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">      </span><span class="no">$(cat scan-summary.md)</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="w">      </span><span class="no">## Threshold Check</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="w">      </span><span class="no">${THRESHOLD_PASSED} -eq 0 &amp;&amp; echo &quot; **PASSED**&quot; || echo &quot; **FAILED**&quot;</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="w">      </span><span class="no">Threshold: ${THRESHOLD_VALUE}%</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="w">      </span><span class="no">## Details</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="w">      </span><span class="no">For full results, see the artifacts.</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-report.html</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-report.md</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="nt">cleanup</span><span class="p">:</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">run_scan</span><span class="p p-Indicator">]</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span><span class="w">  </span><span class="c1"># Run even if previous stages failed</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="w">      </span><span class="no"># Delete all resources</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="w">      </span><span class="no">kubectl delete pod/${TARGET_POD} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="w">      </span><span class="no">kubectl delete role/scanner-role-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="w">      </span><span class="no">kubectl delete sa/scanner-sa-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="w">      </span><span class="no">kubectl delete rolebinding/scanner-binding-${CI_PIPELINE_ID} \</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="w">        </span><span class="no">-n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="dynamic-rbac-scanning-pipeline">Dynamic RBAC Scanning Pipeline<a class="headerlink" href="#dynamic-rbac-scanning-pipeline" title="Permanent link">&para;</a></h2>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">  1</a></span>
<span class="normal"><a href="#__codelineno-1-2">  2</a></span>
<span class="normal"><a href="#__codelineno-1-3">  3</a></span>
<span class="normal"><a href="#__codelineno-1-4">  4</a></span>
<span class="normal"><a href="#__codelineno-1-5">  5</a></span>
<span class="normal"><a href="#__codelineno-1-6">  6</a></span>
<span class="normal"><a href="#__codelineno-1-7">  7</a></span>
<span class="normal"><a href="#__codelineno-1-8">  8</a></span>
<span class="normal"><a href="#__codelineno-1-9">  9</a></span>
<span class="normal"><a href="#__codelineno-1-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-1-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-1-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-1-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-1-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-1-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-1-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-1-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-1-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-1-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-1-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-1-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-1-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-1-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-1-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-1-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-1-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-1-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-1-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-1-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-1-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-1-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-1-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-1-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-1-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-1-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-1-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-1-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-1-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-1-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-1-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-1-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-1-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-1-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-1-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-1-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-1-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-1-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-1-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-1-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-1-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-1-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-1-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-1-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-1-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-1-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-1-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-1-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-1-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-1-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-1-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-1-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-1-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-1-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-1-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-1-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-1-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-1-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-1-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-1-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-1-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-1-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-1-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-1-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-1-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-1-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-1-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-1-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-1-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-1-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-1-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-1-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-1-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-1-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-1-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-1-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-1-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-1-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-1-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-1-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-1-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-1-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-1-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-1-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-1-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-1-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-1-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-1-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-1-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-1-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-1-100">100</a></span>
<span class="normal"><a href="#__codelineno-1-101">101</a></span>
<span class="normal"><a href="#__codelineno-1-102">102</a></span>
<span class="normal"><a href="#__codelineno-1-103">103</a></span>
<span class="normal"><a href="#__codelineno-1-104">104</a></span>
<span class="normal"><a href="#__codelineno-1-105">105</a></span>
<span class="normal"><a href="#__codelineno-1-106">106</a></span>
<span class="normal"><a href="#__codelineno-1-107">107</a></span>
<span class="normal"><a href="#__codelineno-1-108">108</a></span>
<span class="normal"><a href="#__codelineno-1-109">109</a></span>
<span class="normal"><a href="#__codelineno-1-110">110</a></span>
<span class="normal"><a href="#__codelineno-1-111">111</a></span>
<span class="normal"><a href="#__codelineno-1-112">112</a></span>
<span class="normal"><a href="#__codelineno-1-113">113</a></span>
<span class="normal"><a href="#__codelineno-1-114">114</a></span>
<span class="normal"><a href="#__codelineno-1-115">115</a></span>
<span class="normal"><a href="#__codelineno-1-116">116</a></span>
<span class="normal"><a href="#__codelineno-1-117">117</a></span>
<span class="normal"><a href="#__codelineno-1-118">118</a></span>
<span class="normal"><a href="#__codelineno-1-119">119</a></span>
<span class="normal"><a href="#__codelineno-1-120">120</a></span>
<span class="normal"><a href="#__codelineno-1-121">121</a></span>
<span class="normal"><a href="#__codelineno-1-122">122</a></span>
<span class="normal"><a href="#__codelineno-1-123">123</a></span>
<span class="normal"><a href="#__codelineno-1-124">124</a></span>
<span class="normal"><a href="#__codelineno-1-125">125</a></span>
<span class="normal"><a href="#__codelineno-1-126">126</a></span>
<span class="normal"><a href="#__codelineno-1-127">127</a></span>
<span class="normal"><a href="#__codelineno-1-128">128</a></span>
<span class="normal"><a href="#__codelineno-1-129">129</a></span>
<span class="normal"><a href="#__codelineno-1-130">130</a></span>
<span class="normal"><a href="#__codelineno-1-131">131</a></span>
<span class="normal"><a href="#__codelineno-1-132">132</a></span>
<span class="normal"><a href="#__codelineno-1-133">133</a></span>
<span class="normal"><a href="#__codelineno-1-134">134</a></span>
<span class="normal"><a href="#__codelineno-1-135">135</a></span>
<span class="normal"><a href="#__codelineno-1-136">136</a></span>
<span class="normal"><a href="#__codelineno-1-137">137</a></span>
<span class="normal"><a href="#__codelineno-1-138">138</a></span>
<span class="normal"><a href="#__codelineno-1-139">139</a></span>
<span class="normal"><a href="#__codelineno-1-140">140</a></span>
<span class="normal"><a href="#__codelineno-1-141">141</a></span>
<span class="normal"><a href="#__codelineno-1-142">142</a></span>
<span class="normal"><a href="#__codelineno-1-143">143</a></span>
<span class="normal"><a href="#__codelineno-1-144">144</a></span>
<span class="normal"><a href="#__codelineno-1-145">145</a></span>
<span class="normal"><a href="#__codelineno-1-146">146</a></span>
<span class="normal"><a href="#__codelineno-1-147">147</a></span>
<span class="normal"><a href="#__codelineno-1-148">148</a></span>
<span class="normal"><a href="#__codelineno-1-149">149</a></span>
<span class="normal"><a href="#__codelineno-1-150">150</a></span>
<span class="normal"><a href="#__codelineno-1-151">151</a></span>
<span class="normal"><a href="#__codelineno-1-152">152</a></span>
<span class="normal"><a href="#__codelineno-1-153">153</a></span>
<span class="normal"><a href="#__codelineno-1-154">154</a></span>
<span class="normal"><a href="#__codelineno-1-155">155</a></span>
<span class="normal"><a href="#__codelineno-1-156">156</a></span>
<span class="normal"><a href="#__codelineno-1-157">157</a></span>
<span class="normal"><a href="#__codelineno-1-158">158</a></span>
<span class="normal"><a href="#__codelineno-1-159">159</a></span>
<span class="normal"><a href="#__codelineno-1-160">160</a></span>
<span class="normal"><a href="#__codelineno-1-161">161</a></span>
<span class="normal"><a href="#__codelineno-1-162">162</a></span>
<span class="normal"><a href="#__codelineno-1-163">163</a></span>
<span class="normal"><a href="#__codelineno-1-164">164</a></span>
<span class="normal"><a href="#__codelineno-1-165">165</a></span>
<span class="normal"><a href="#__codelineno-1-166">166</a></span>
<span class="normal"><a href="#__codelineno-1-167">167</a></span>
<span class="normal"><a href="#__codelineno-1-168">168</a></span>
<span class="normal"><a href="#__codelineno-1-169">169</a></span>
<span class="normal"><a href="#__codelineno-1-170">170</a></span>
<span class="normal"><a href="#__codelineno-1-171">171</a></span>
<span class="normal"><a href="#__codelineno-1-172">172</a></span>
<span class="normal"><a href="#__codelineno-1-173">173</a></span>
<span class="normal"><a href="#__codelineno-1-174">174</a></span>
<span class="normal"><a href="#__codelineno-1-175">175</a></span>
<span class="normal"><a href="#__codelineno-1-176">176</a></span>
<span class="normal"><a href="#__codelineno-1-177">177</a></span>
<span class="normal"><a href="#__codelineno-1-178">178</a></span>
<span class="normal"><a href="#__codelineno-1-179">179</a></span>
<span class="normal"><a href="#__codelineno-1-180">180</a></span>
<span class="normal"><a href="#__codelineno-1-181">181</a></span>
<span class="normal"><a href="#__codelineno-1-182">182</a></span>
<span class="normal"><a href="#__codelineno-1-183">183</a></span>
<span class="normal"><a href="#__codelineno-1-184">184</a></span>
<span class="normal"><a href="#__codelineno-1-185">185</a></span>
<span class="normal"><a href="#__codelineno-1-186">186</a></span>
<span class="normal"><a href="#__codelineno-1-187">187</a></span>
<span class="normal"><a href="#__codelineno-1-188">188</a></span>
<span class="normal"><a href="#__codelineno-1-189">189</a></span>
<span class="normal"><a href="#__codelineno-1-190">190</a></span>
<span class="normal"><a href="#__codelineno-1-191">191</a></span>
<span class="normal"><a href="#__codelineno-1-192">192</a></span>
<span class="normal"><a href="#__codelineno-1-193">193</a></span>
<span class="normal"><a href="#__codelineno-1-194">194</a></span>
<span class="normal"><a href="#__codelineno-1-195">195</a></span>
<span class="normal"><a href="#__codelineno-1-196">196</a></span>
<span class="normal"><a href="#__codelineno-1-197">197</a></span>
<span class="normal"><a href="#__codelineno-1-198">198</a></span>
<span class="normal"><a href="#__codelineno-1-199">199</a></span>
<span class="normal"><a href="#__codelineno-1-200">200</a></span>
<span class="normal"><a href="#__codelineno-1-201">201</a></span>
<span class="normal"><a href="#__codelineno-1-202">202</a></span>
<span class="normal"><a href="#__codelineno-1-203">203</a></span>
<span class="normal"><a href="#__codelineno-1-204">204</a></span>
<span class="normal"><a href="#__codelineno-1-205">205</a></span>
<span class="normal"><a href="#__codelineno-1-206">206</a></span>
<span class="normal"><a href="#__codelineno-1-207">207</a></span>
<span class="normal"><a href="#__codelineno-1-208">208</a></span>
<span class="normal"><a href="#__codelineno-1-209">209</a></span>
<span class="normal"><a href="#__codelineno-1-210">210</a></span>
<span class="normal"><a href="#__codelineno-1-211">211</a></span>
<span class="normal"><a href="#__codelineno-1-212">212</a></span>
<span class="normal"><a href="#__codelineno-1-213">213</a></span>
<span class="normal"><a href="#__codelineno-1-214">214</a></span>
<span class="normal"><a href="#__codelineno-1-215">215</a></span>
<span class="normal"><a href="#__codelineno-1-216">216</a></span>
<span class="normal"><a href="#__codelineno-1-217">217</a></span>
<span class="normal"><a href="#__codelineno-1-218">218</a></span>
<span class="normal"><a href="#__codelineno-1-219">219</a></span>
<span class="normal"><a href="#__codelineno-1-220">220</a></span>
<span class="normal"><a href="#__codelineno-1-221">221</a></span>
<span class="normal"><a href="#__codelineno-1-222">222</a></span>
<span class="normal"><a href="#__codelineno-1-223">223</a></span>
<span class="normal"><a href="#__codelineno-1-224">224</a></span>
<span class="normal"><a href="#__codelineno-1-225">225</a></span>
<span class="normal"><a href="#__codelineno-1-226">226</a></span>
<span class="normal"><a href="#__codelineno-1-227">227</a></span>
<span class="normal"><a href="#__codelineno-1-228">228</a></span>
<span class="normal"><a href="#__codelineno-1-229">229</a></span>
<span class="normal"><a href="#__codelineno-1-230">230</a></span>
<span class="normal"><a href="#__codelineno-1-231">231</a></span>
<span class="normal"><a href="#__codelineno-1-232">232</a></span>
<span class="normal"><a href="#__codelineno-1-233">233</a></span>
<span class="normal"><a href="#__codelineno-1-234">234</a></span>
<span class="normal"><a href="#__codelineno-1-235">235</a></span>
<span class="normal"><a href="#__codelineno-1-236">236</a></span>
<span class="normal"><a href="#__codelineno-1-237">237</a></span>
<span class="normal"><a href="#__codelineno-1-238">238</a></span>
<span class="normal"><a href="#__codelineno-1-239">239</a></span>
<span class="normal"><a href="#__codelineno-1-240">240</a></span>
<span class="normal"><a href="#__codelineno-1-241">241</a></span>
<span class="normal"><a href="#__codelineno-1-242">242</a></span>
<span class="normal"><a href="#__codelineno-1-243">243</a></span>
<span class="normal"><a href="#__codelineno-1-244">244</a></span>
<span class="normal"><a href="#__codelineno-1-245">245</a></span>
<span class="normal"><a href="#__codelineno-1-246">246</a></span>
<span class="normal"><a href="#__codelineno-1-247">247</a></span>
<span class="normal"><a href="#__codelineno-1-248">248</a></span>
<span class="normal"><a href="#__codelineno-1-249">249</a></span>
<span class="normal"><a href="#__codelineno-1-250">250</a></span>
<span class="normal"><a href="#__codelineno-1-251">251</a></span>
<span class="normal"><a href="#__codelineno-1-252">252</a></span>
<span class="normal"><a href="#__codelineno-1-253">253</a></span>
<span class="normal"><a href="#__codelineno-1-254">254</a></span>
<span class="normal"><a href="#__codelineno-1-255">255</a></span>
<span class="normal"><a href="#__codelineno-1-256">256</a></span>
<span class="normal"><a href="#__codelineno-1-257">257</a></span>
<span class="normal"><a href="#__codelineno-1-258">258</a></span>
<span class="normal"><a href="#__codelineno-1-259">259</a></span>
<span class="normal"><a href="#__codelineno-1-260">260</a></span>
<span class="normal"><a href="#__codelineno-1-261">261</a></span>
<span class="normal"><a href="#__codelineno-1-262">262</a></span>
<span class="normal"><a href="#__codelineno-1-263">263</a></span>
<span class="normal"><a href="#__codelineno-1-264">264</a></span>
<span class="normal"><a href="#__codelineno-1-265">265</a></span>
<span class="normal"><a href="#__codelineno-1-266">266</a></span>
<span class="normal"><a href="#__codelineno-1-267">267</a></span>
<span class="normal"><a href="#__codelineno-1-268">268</a></span>
<span class="normal"><a href="#__codelineno-1-269">269</a></span>
<span class="normal"><a href="#__codelineno-1-270">270</a></span>
<span class="normal"><a href="#__codelineno-1-271">271</a></span>
<span class="normal"><a href="#__codelineno-1-272">272</a></span>
<span class="normal"><a href="#__codelineno-1-273">273</a></span>
<span class="normal"><a href="#__codelineno-1-274">274</a></span>
<span class="normal"><a href="#__codelineno-1-275">275</a></span>
<span class="normal"><a href="#__codelineno-1-276">276</a></span>
<span class="normal"><a href="#__codelineno-1-277">277</a></span>
<span class="normal"><a href="#__codelineno-1-278">278</a></span>
<span class="normal"><a href="#__codelineno-1-279">279</a></span>
<span class="normal"><a href="#__codelineno-1-280">280</a></span>
<span class="normal"><a href="#__codelineno-1-281">281</a></span>
<span class="normal"><a href="#__codelineno-1-282">282</a></span>
<span class="normal"><a href="#__codelineno-1-283">283</a></span>
<span class="normal"><a href="#__codelineno-1-284">284</a></span>
<span class="normal"><a href="#__codelineno-1-285">285</a></span>
<span class="normal"><a href="#__codelineno-1-286">286</a></span>
<span class="normal"><a href="#__codelineno-1-287">287</a></span>
<span class="normal"><a href="#__codelineno-1-288">288</a></span>
<span class="normal"><a href="#__codelineno-1-289">289</a></span>
<span class="normal"><a href="#__codelineno-1-290">290</a></span>
<span class="normal"><a href="#__codelineno-1-291">291</a></span>
<span class="normal"><a href="#__codelineno-1-292">292</a></span>
<span class="normal"><a href="#__codelineno-1-293">293</a></span>
<span class="normal"><a href="#__codelineno-1-294">294</a></span>
<span class="normal"><a href="#__codelineno-1-295">295</a></span>
<span class="normal"><a href="#__codelineno-1-296">296</a></span>
<span class="normal"><a href="#__codelineno-1-297">297</a></span>
<span class="normal"><a href="#__codelineno-1-298">298</a></span>
<span class="normal"><a href="#__codelineno-1-299">299</a></span>
<span class="normal"><a href="#__codelineno-1-300">300</a></span>
<span class="normal"><a href="#__codelineno-1-301">301</a></span>
<span class="normal"><a href="#__codelineno-1-302">302</a></span>
<span class="normal"><a href="#__codelineno-1-303">303</a></span>
<span class="normal"><a href="#__codelineno-1-304">304</a></span>
<span class="normal"><a href="#__codelineno-1-305">305</a></span>
<span class="normal"><a href="#__codelineno-1-306">306</a></span>
<span class="normal"><a href="#__codelineno-1-307">307</a></span>
<span class="normal"><a href="#__codelineno-1-308">308</a></span>
<span class="normal"><a href="#__codelineno-1-309">309</a></span>
<span class="normal"><a href="#__codelineno-1-310">310</a></span>
<span class="normal"><a href="#__codelineno-1-311">311</a></span>
<span class="normal"><a href="#__codelineno-1-312">312</a></span>
<span class="normal"><a href="#__codelineno-1-313">313</a></span>
<span class="normal"><a href="#__codelineno-1-314">314</a></span>
<span class="normal"><a href="#__codelineno-1-315">315</a></span>
<span class="normal"><a href="#__codelineno-1-316">316</a></span>
<span class="normal"><a href="#__codelineno-1-317">317</a></span>
<span class="normal"><a href="#__codelineno-1-318">318</a></span>
<span class="normal"><a href="#__codelineno-1-319">319</a></span>
<span class="normal"><a href="#__codelineno-1-320">320</a></span>
<span class="normal"><a href="#__codelineno-1-321">321</a></span>
<span class="normal"><a href="#__codelineno-1-322">322</a></span>
<span class="normal"><a href="#__codelineno-1-323">323</a></span>
<span class="normal"><a href="#__codelineno-1-324">324</a></span>
<span class="normal"><a href="#__codelineno-1-325">325</a></span>
<span class="normal"><a href="#__codelineno-1-326">326</a></span>
<span class="normal"><a href="#__codelineno-1-327">327</a></span>
<span class="normal"><a href="#__codelineno-1-328">328</a></span>
<span class="normal"><a href="#__codelineno-1-329">329</a></span>
<span class="normal"><a href="#__codelineno-1-330">330</a></span>
<span class="normal"><a href="#__codelineno-1-331">331</a></span>
<span class="normal"><a href="#__codelineno-1-332">332</a></span>
<span class="normal"><a href="#__codelineno-1-333">333</a></span>
<span class="normal"><a href="#__codelineno-1-334">334</a></span>
<span class="normal"><a href="#__codelineno-1-335">335</a></span>
<span class="normal"><a href="#__codelineno-1-336">336</a></span>
<span class="normal"><a href="#__codelineno-1-337">337</a></span>
<span class="normal"><a href="#__codelineno-1-338">338</a></span>
<span class="normal"><a href="#__codelineno-1-339">339</a></span>
<span class="normal"><a href="#__codelineno-1-340">340</a></span>
<span class="normal"><a href="#__codelineno-1-341">341</a></span>
<span class="normal"><a href="#__codelineno-1-342">342</a></span>
<span class="normal"><a href="#__codelineno-1-343">343</a></span>
<span class="normal"><a href="#__codelineno-1-344">344</a></span>
<span class="normal"><a href="#__codelineno-1-345">345</a></span>
<span class="normal"><a href="#__codelineno-1-346">346</a></span>
<span class="normal"><a href="#__codelineno-1-347">347</a></span>
<span class="normal"><a href="#__codelineno-1-348">348</a></span>
<span class="normal"><a href="#__codelineno-1-349">349</a></span>
<span class="normal"><a href="#__codelineno-1-350">350</a></span>
<span class="normal"><a href="#__codelineno-1-351">351</a></span>
<span class="normal"><a href="#__codelineno-1-352">352</a></span>
<span class="normal"><a href="#__codelineno-1-353">353</a></span>
<span class="normal"><a href="#__codelineno-1-354">354</a></span>
<span class="normal"><a href="#__codelineno-1-355">355</a></span>
<span class="normal"><a href="#__codelineno-1-356">356</a></span>
<span class="normal"><a href="#__codelineno-1-357">357</a></span>
<span class="normal"><a href="#__codelineno-1-358">358</a></span>
<span class="normal"><a href="#__codelineno-1-359">359</a></span>
<span class="normal"><a href="#__codelineno-1-360">360</a></span>
<span class="normal"><a href="#__codelineno-1-361">361</a></span>
<span class="normal"><a href="#__codelineno-1-362">362</a></span>
<span class="normal"><a href="#__codelineno-1-363">363</a></span>
<span class="normal"><a href="#__codelineno-1-364">364</a></span>
<span class="normal"><a href="#__codelineno-1-365">365</a></span>
<span class="normal"><a href="#__codelineno-1-366">366</a></span>
<span class="normal"><a href="#__codelineno-1-367">367</a></span>
<span class="normal"><a href="#__codelineno-1-368">368</a></span>
<span class="normal"><a href="#__codelineno-1-369">369</a></span>
<span class="normal"><a href="#__codelineno-1-370">370</a></span>
<span class="normal"><a href="#__codelineno-1-371">371</a></span>
<span class="normal"><a href="#__codelineno-1-372">372</a></span>
<span class="normal"><a href="#__codelineno-1-373">373</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nt">stages</span><span class="p">:</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">  </span><span class="nt">KUBERNETES_NAMESPACE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dynamic-scan-$CI_PIPELINE_ID&quot;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">  </span><span class="nt">TARGET_IMAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;busybox:latest&quot;</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">  </span><span class="nt">SCAN_LABEL_KEY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;scan-target&quot;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">  </span><span class="nt">SCAN_LABEL_VALUE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">  </span><span class="nt">CINC_PROFILE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dev-sec/linux-baseline&quot;</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">  </span><span class="nt">THRESHOLD_VALUE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;70&quot;</span><span class="w">  </span><span class="c1"># Minimum passing score (0-100)</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">  </span><span class="nt">DURATION_MINUTES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;15&quot;</span><span class="w"> </span><span class="c1"># Token duration in minutes</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="c1"># Allow overriding variables through pipeline triggers or UI</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="nt">.dynamic_variables</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;dynamic_variables</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">  </span><span class="nt">TARGET_IMAGE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${TARGET_IMAGE}</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">  </span><span class="nt">SCAN_LABEL_KEY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${SCAN_LABEL_KEY}</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">  </span><span class="nt">SCAN_LABEL_VALUE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${SCAN_LABEL_VALUE}</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">  </span><span class="nt">CINC_PROFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${CINC_PROFILE}</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">  </span><span class="nt">THRESHOLD_VALUE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${THRESHOLD_VALUE}</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">  </span><span class="nt">ADDITIONAL_PROFILE_ANNOTATION</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${ADDITIONAL_PROFILE_ANNOTATION}&quot;</span><span class="w">  </span><span class="c1"># Optional annotation for specifying additional profiles</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24"></a>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="nt">setup_test_environment</span><span class="p">:</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30"></a>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="w">    </span><span class="c1"># Create test namespace</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl create namespace ${KUBERNETES_NAMESPACE}</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33"></a>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="w">    </span><span class="c1"># Create multiple test pods with different images and labels</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="w">      </span><span class="no"># Create 3 pods, but only mark the first one for scanning</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w">      </span><span class="no">for i in {1..3}; do</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w">        </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39"></a><span class="w">        </span><span class="no">apiVersion: v1</span>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="w">        </span><span class="no">kind: Pod</span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="w">        </span><span class="no">metadata:</span>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="w">          </span><span class="no">name: pod-${i}</span>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="w">          </span><span class="no">namespace: ${KUBERNETES_NAMESPACE}</span>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44"></a><span class="w">          </span><span class="no">labels:</span>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="w">            </span><span class="no">app: test-pod-${i}</span>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46"></a><span class="w">            </span><span class="no">${SCAN_LABEL_KEY}: &quot;$([ $i -eq 1 ] &amp;&amp; echo &quot;${SCAN_LABEL_VALUE}&quot; || echo &quot;false&quot;)&quot;</span>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="w">          </span><span class="no">annotations:</span>
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="w">            </span><span class="no">scan-profile: &quot;${CINC_PROFILE}&quot;</span>
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49"></a><span class="w">            </span><span class="no">$([ -n &quot;${ADDITIONAL_PROFILE_ANNOTATION}&quot; ] &amp;&amp; echo &quot;${ADDITIONAL_PROFILE_ANNOTATION}&quot; || echo &quot;&quot;)</span>
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50"></a><span class="w">        </span><span class="no">spec:</span>
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51"></a><span class="w">          </span><span class="no">containers:</span>
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52"></a><span class="w">          </span><span class="no">- name: container</span>
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="w">            </span><span class="no">image: ${TARGET_IMAGE}</span>
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54"></a><span class="w">            </span><span class="no">command: [&quot;sleep&quot;, &quot;infinity&quot;]</span>
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55"></a><span class="w">        </span><span class="no">EOF</span>
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56"></a><span class="w">      </span><span class="no">done</span>
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57"></a>
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58"></a><span class="w">    </span><span class="c1"># Wait for pods to be ready</span>
</span><span id="__span-1-59"><a id="__codelineno-1-59" name="__codelineno-1-59"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl wait --for=condition=ready pod -l app=test-pod-1 -n ${KUBERNETES_NAMESPACE} --timeout=120s</span>
</span><span id="__span-1-60"><a id="__codelineno-1-60" name="__codelineno-1-60"></a>
</span><span id="__span-1-61"><a id="__codelineno-1-61" name="__codelineno-1-61"></a><span class="w">    </span><span class="c1"># Get the name of the pod with our scan label</span>
</span><span id="__span-1-62"><a id="__codelineno-1-62" name="__codelineno-1-62"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-63"><a id="__codelineno-1-63" name="__codelineno-1-63"></a><span class="w">      </span><span class="no">TARGET_POD=$(kubectl get pods -n ${KUBERNETES_NAMESPACE} -l ${SCAN_LABEL_KEY}=${SCAN_LABEL_VALUE} -o jsonpath=&#39;{.items[0].metadata.name}&#39;)</span>
</span><span id="__span-1-64"><a id="__codelineno-1-64" name="__codelineno-1-64"></a><span class="w">      </span><span class="no">if [ -z &quot;$TARGET_POD&quot; ]; then</span>
</span><span id="__span-1-65"><a id="__codelineno-1-65" name="__codelineno-1-65"></a><span class="w">        </span><span class="no">echo &quot;Error: No pod found with label ${SCAN_LABEL_KEY}=${SCAN_LABEL_VALUE}&quot;</span>
</span><span id="__span-1-66"><a id="__codelineno-1-66" name="__codelineno-1-66"></a><span class="w">        </span><span class="no">exit 1</span>
</span><span id="__span-1-67"><a id="__codelineno-1-67" name="__codelineno-1-67"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-1-68"><a id="__codelineno-1-68" name="__codelineno-1-68"></a><span class="w">      </span><span class="no">echo &quot;TARGET_POD=${TARGET_POD}&quot; &gt;&gt; deploy.env</span>
</span><span id="__span-1-69"><a id="__codelineno-1-69" name="__codelineno-1-69"></a>
</span><span id="__span-1-70"><a id="__codelineno-1-70" name="__codelineno-1-70"></a><span class="w">    </span><span class="c1"># Save scan profile from annotations if available</span>
</span><span id="__span-1-71"><a id="__codelineno-1-71" name="__codelineno-1-71"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-72"><a id="__codelineno-1-72" name="__codelineno-1-72"></a><span class="w">      </span><span class="no">SCAN_PROFILE=$(kubectl get pod ${TARGET_POD} -n ${KUBERNETES_NAMESPACE} -o jsonpath=&#39;{.metadata.annotations.scan-profile}&#39;)</span>
</span><span id="__span-1-73"><a id="__codelineno-1-73" name="__codelineno-1-73"></a><span class="w">      </span><span class="no">if [ -n &quot;$SCAN_PROFILE&quot; ]; then</span>
</span><span id="__span-1-74"><a id="__codelineno-1-74" name="__codelineno-1-74"></a><span class="w">        </span><span class="no">echo &quot;Found scan profile annotation: ${SCAN_PROFILE}&quot;</span>
</span><span id="__span-1-75"><a id="__codelineno-1-75" name="__codelineno-1-75"></a><span class="w">        </span><span class="no">echo &quot;SCAN_PROFILE=${SCAN_PROFILE}&quot; &gt;&gt; deploy.env</span>
</span><span id="__span-1-76"><a id="__codelineno-1-76" name="__codelineno-1-76"></a><span class="w">      </span><span class="no">else</span>
</span><span id="__span-1-77"><a id="__codelineno-1-77" name="__codelineno-1-77"></a><span class="w">        </span><span class="no">echo &quot;Using default profile: ${CINC_PROFILE}&quot;</span>
</span><span id="__span-1-78"><a id="__codelineno-1-78" name="__codelineno-1-78"></a><span class="w">        </span><span class="no">echo &quot;SCAN_PROFILE=${CINC_PROFILE}&quot; &gt;&gt; deploy.env</span>
</span><span id="__span-1-79"><a id="__codelineno-1-79" name="__codelineno-1-79"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-1-80"><a id="__codelineno-1-80" name="__codelineno-1-80"></a>
</span><span id="__span-1-81"><a id="__codelineno-1-81" name="__codelineno-1-81"></a><span class="w">    </span><span class="c1"># Show all pods in the namespace</span>
</span><span id="__span-1-82"><a id="__codelineno-1-82" name="__codelineno-1-82"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl get pods -n ${KUBERNETES_NAMESPACE} --show-labels</span>
</span><span id="__span-1-83"><a id="__codelineno-1-83" name="__codelineno-1-83"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-1-84"><a id="__codelineno-1-84" name="__codelineno-1-84"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-1-85"><a id="__codelineno-1-85" name="__codelineno-1-85"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy.env</span>
</span><span id="__span-1-86"><a id="__codelineno-1-86" name="__codelineno-1-86"></a>
</span><span id="__span-1-87"><a id="__codelineno-1-87" name="__codelineno-1-87"></a><span class="nt">create_dynamic_rbac</span><span class="p">:</span>
</span><span id="__span-1-88"><a id="__codelineno-1-88" name="__codelineno-1-88"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-1-89"><a id="__codelineno-1-89" name="__codelineno-1-89"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">setup_test_environment</span><span class="p p-Indicator">]</span>
</span><span id="__span-1-90"><a id="__codelineno-1-90" name="__codelineno-1-90"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-1-91"><a id="__codelineno-1-91" name="__codelineno-1-91"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-1-92"><a id="__codelineno-1-92" name="__codelineno-1-92"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-1-93"><a id="__codelineno-1-93" name="__codelineno-1-93"></a>
</span><span id="__span-1-94"><a id="__codelineno-1-94" name="__codelineno-1-94"></a><span class="w">    </span><span class="c1"># Create service account</span>
</span><span id="__span-1-95"><a id="__codelineno-1-95" name="__codelineno-1-95"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-96"><a id="__codelineno-1-96" name="__codelineno-1-96"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-1-97"><a id="__codelineno-1-97" name="__codelineno-1-97"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-1-98"><a id="__codelineno-1-98" name="__codelineno-1-98"></a><span class="w">      </span><span class="no">kind: ServiceAccount</span>
</span><span id="__span-1-99"><a id="__codelineno-1-99" name="__codelineno-1-99"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-1-100"><a id="__codelineno-1-100" name="__codelineno-1-100"></a><span class="w">        </span><span class="no">name: scanner-sa</span>
</span><span id="__span-1-101"><a id="__codelineno-1-101" name="__codelineno-1-101"></a><span class="w">        </span><span class="no">namespace: ${KUBERNETES_NAMESPACE}</span>
</span><span id="__span-1-102"><a id="__codelineno-1-102" name="__codelineno-1-102"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-1-103"><a id="__codelineno-1-103" name="__codelineno-1-103"></a>
</span><span id="__span-1-104"><a id="__codelineno-1-104" name="__codelineno-1-104"></a><span class="w">    </span><span class="c1"># Create role with label-based access</span>
</span><span id="__span-1-105"><a id="__codelineno-1-105" name="__codelineno-1-105"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-106"><a id="__codelineno-1-106" name="__codelineno-1-106"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-1-107"><a id="__codelineno-1-107" name="__codelineno-1-107"></a><span class="w">      </span><span class="no">apiVersion: rbac.authorization.k8s.io/v1</span>
</span><span id="__span-1-108"><a id="__codelineno-1-108" name="__codelineno-1-108"></a><span class="w">      </span><span class="no">kind: Role</span>
</span><span id="__span-1-109"><a id="__codelineno-1-109" name="__codelineno-1-109"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-1-110"><a id="__codelineno-1-110" name="__codelineno-1-110"></a><span class="w">        </span><span class="no">name: scanner-role</span>
</span><span id="__span-1-111"><a id="__codelineno-1-111" name="__codelineno-1-111"></a><span class="w">        </span><span class="no">namespace: ${KUBERNETES_NAMESPACE}</span>
</span><span id="__span-1-112"><a id="__codelineno-1-112" name="__codelineno-1-112"></a><span class="w">      </span><span class="no">rules:</span>
</span><span id="__span-1-113"><a id="__codelineno-1-113" name="__codelineno-1-113"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-1-114"><a id="__codelineno-1-114" name="__codelineno-1-114"></a><span class="w">        </span><span class="no">resources: [&quot;pods&quot;]</span>
</span><span id="__span-1-115"><a id="__codelineno-1-115" name="__codelineno-1-115"></a><span class="w">        </span><span class="no">verbs: [&quot;get&quot;, &quot;list&quot;]</span>
</span><span id="__span-1-116"><a id="__codelineno-1-116" name="__codelineno-1-116"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-1-117"><a id="__codelineno-1-117" name="__codelineno-1-117"></a><span class="w">        </span><span class="no">resources: [&quot;pods/exec&quot;]</span>
</span><span id="__span-1-118"><a id="__codelineno-1-118" name="__codelineno-1-118"></a><span class="w">        </span><span class="no">verbs: [&quot;create&quot;]</span>
</span><span id="__span-1-119"><a id="__codelineno-1-119" name="__codelineno-1-119"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-1-120"><a id="__codelineno-1-120" name="__codelineno-1-120"></a><span class="w">        </span><span class="no">resources: [&quot;pods/log&quot;]</span>
</span><span id="__span-1-121"><a id="__codelineno-1-121" name="__codelineno-1-121"></a><span class="w">        </span><span class="no">verbs: [&quot;get&quot;]</span>
</span><span id="__span-1-122"><a id="__codelineno-1-122" name="__codelineno-1-122"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-1-123"><a id="__codelineno-1-123" name="__codelineno-1-123"></a>
</span><span id="__span-1-124"><a id="__codelineno-1-124" name="__codelineno-1-124"></a><span class="w">    </span><span class="c1"># Create role binding</span>
</span><span id="__span-1-125"><a id="__codelineno-1-125" name="__codelineno-1-125"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-126"><a id="__codelineno-1-126" name="__codelineno-1-126"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-1-127"><a id="__codelineno-1-127" name="__codelineno-1-127"></a><span class="w">      </span><span class="no">apiVersion: rbac.authorization.k8s.io/v1</span>
</span><span id="__span-1-128"><a id="__codelineno-1-128" name="__codelineno-1-128"></a><span class="w">      </span><span class="no">kind: RoleBinding</span>
</span><span id="__span-1-129"><a id="__codelineno-1-129" name="__codelineno-1-129"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-1-130"><a id="__codelineno-1-130" name="__codelineno-1-130"></a><span class="w">        </span><span class="no">name: scanner-binding</span>
</span><span id="__span-1-131"><a id="__codelineno-1-131" name="__codelineno-1-131"></a><span class="w">        </span><span class="no">namespace: ${KUBERNETES_NAMESPACE}</span>
</span><span id="__span-1-132"><a id="__codelineno-1-132" name="__codelineno-1-132"></a><span class="w">      </span><span class="no">subjects:</span>
</span><span id="__span-1-133"><a id="__codelineno-1-133" name="__codelineno-1-133"></a><span class="w">      </span><span class="no">- kind: ServiceAccount</span>
</span><span id="__span-1-134"><a id="__codelineno-1-134" name="__codelineno-1-134"></a><span class="w">        </span><span class="no">name: scanner-sa</span>
</span><span id="__span-1-135"><a id="__codelineno-1-135" name="__codelineno-1-135"></a><span class="w">        </span><span class="no">namespace: ${KUBERNETES_NAMESPACE}</span>
</span><span id="__span-1-136"><a id="__codelineno-1-136" name="__codelineno-1-136"></a><span class="w">      </span><span class="no">roleRef:</span>
</span><span id="__span-1-137"><a id="__codelineno-1-137" name="__codelineno-1-137"></a><span class="w">        </span><span class="no">kind: Role</span>
</span><span id="__span-1-138"><a id="__codelineno-1-138" name="__codelineno-1-138"></a><span class="w">        </span><span class="no">name: scanner-role</span>
</span><span id="__span-1-139"><a id="__codelineno-1-139" name="__codelineno-1-139"></a><span class="w">        </span><span class="no">apiGroup: rbac.authorization.k8s.io</span>
</span><span id="__span-1-140"><a id="__codelineno-1-140" name="__codelineno-1-140"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-1-141"><a id="__codelineno-1-141" name="__codelineno-1-141"></a>
</span><span id="__span-1-142"><a id="__codelineno-1-142" name="__codelineno-1-142"></a><span class="w">    </span><span class="c1"># Generate token</span>
</span><span id="__span-1-143"><a id="__codelineno-1-143" name="__codelineno-1-143"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-144"><a id="__codelineno-1-144" name="__codelineno-1-144"></a><span class="w">      </span><span class="no">TOKEN=$(kubectl create token scanner-sa -n ${KUBERNETES_NAMESPACE} --duration=${DURATION_MINUTES}m)</span>
</span><span id="__span-1-145"><a id="__codelineno-1-145" name="__codelineno-1-145"></a><span class="w">      </span><span class="no">SERVER=$(kubectl config view --minify --output=jsonpath=&#39;{.clusters[0].cluster.server}&#39;)</span>
</span><span id="__span-1-146"><a id="__codelineno-1-146" name="__codelineno-1-146"></a><span class="w">      </span><span class="no">CA_DATA=$(kubectl config view --raw --minify --flatten -o jsonpath=&#39;{.clusters[].cluster.certificate-authority-data}&#39;)</span>
</span><span id="__span-1-147"><a id="__codelineno-1-147" name="__codelineno-1-147"></a>
</span><span id="__span-1-148"><a id="__codelineno-1-148" name="__codelineno-1-148"></a><span class="w">      </span><span class="no"># Save token and cluster info for later stages</span>
</span><span id="__span-1-149"><a id="__codelineno-1-149" name="__codelineno-1-149"></a><span class="w">      </span><span class="no">echo &quot;SCANNER_TOKEN=${TOKEN}&quot; &gt;&gt; scanner.env</span>
</span><span id="__span-1-150"><a id="__codelineno-1-150" name="__codelineno-1-150"></a><span class="w">      </span><span class="no">echo &quot;CLUSTER_SERVER=${SERVER}&quot; &gt;&gt; scanner.env</span>
</span><span id="__span-1-151"><a id="__codelineno-1-151" name="__codelineno-1-151"></a><span class="w">      </span><span class="no">echo &quot;CLUSTER_CA_DATA=${CA_DATA}&quot; &gt;&gt; scanner.env</span>
</span><span id="__span-1-152"><a id="__codelineno-1-152" name="__codelineno-1-152"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-1-153"><a id="__codelineno-1-153" name="__codelineno-1-153"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-1-154"><a id="__codelineno-1-154" name="__codelineno-1-154"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scanner.env</span>
</span><span id="__span-1-155"><a id="__codelineno-1-155" name="__codelineno-1-155"></a>
</span><span id="__span-1-156"><a id="__codelineno-1-156" name="__codelineno-1-156"></a><span class="nt">run_security_scan</span><span class="p">:</span>
</span><span id="__span-1-157"><a id="__codelineno-1-157" name="__codelineno-1-157"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-1-158"><a id="__codelineno-1-158" name="__codelineno-1-158"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">setup_test_environment</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">create_dynamic_rbac</span><span class="p p-Indicator">]</span>
</span><span id="__span-1-159"><a id="__codelineno-1-159" name="__codelineno-1-159"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-1-160"><a id="__codelineno-1-160" name="__codelineno-1-160"></a><span class="w">    </span><span class="c1"># Create kubeconfig with restricted token</span>
</span><span id="__span-1-161"><a id="__codelineno-1-161" name="__codelineno-1-161"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-162"><a id="__codelineno-1-162" name="__codelineno-1-162"></a><span class="w">      </span><span class="no">cat &gt; scan-kubeconfig.yaml &lt;&lt; EOF</span>
</span><span id="__span-1-163"><a id="__codelineno-1-163" name="__codelineno-1-163"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-1-164"><a id="__codelineno-1-164" name="__codelineno-1-164"></a><span class="w">      </span><span class="no">kind: Config</span>
</span><span id="__span-1-165"><a id="__codelineno-1-165" name="__codelineno-1-165"></a><span class="w">      </span><span class="no">preferences: {}</span>
</span><span id="__span-1-166"><a id="__codelineno-1-166" name="__codelineno-1-166"></a><span class="w">      </span><span class="no">clusters:</span>
</span><span id="__span-1-167"><a id="__codelineno-1-167" name="__codelineno-1-167"></a><span class="w">      </span><span class="no">- cluster:</span>
</span><span id="__span-1-168"><a id="__codelineno-1-168" name="__codelineno-1-168"></a><span class="w">          </span><span class="no">server: ${CLUSTER_SERVER}</span>
</span><span id="__span-1-169"><a id="__codelineno-1-169" name="__codelineno-1-169"></a><span class="w">          </span><span class="no">certificate-authority-data: ${CLUSTER_CA_DATA}</span>
</span><span id="__span-1-170"><a id="__codelineno-1-170" name="__codelineno-1-170"></a><span class="w">        </span><span class="no">name: scanner-cluster</span>
</span><span id="__span-1-171"><a id="__codelineno-1-171" name="__codelineno-1-171"></a><span class="w">      </span><span class="no">contexts:</span>
</span><span id="__span-1-172"><a id="__codelineno-1-172" name="__codelineno-1-172"></a><span class="w">      </span><span class="no">- context:</span>
</span><span id="__span-1-173"><a id="__codelineno-1-173" name="__codelineno-1-173"></a><span class="w">          </span><span class="no">cluster: scanner-cluster</span>
</span><span id="__span-1-174"><a id="__codelineno-1-174" name="__codelineno-1-174"></a><span class="w">          </span><span class="no">namespace: ${KUBERNETES_NAMESPACE}</span>
</span><span id="__span-1-175"><a id="__codelineno-1-175" name="__codelineno-1-175"></a><span class="w">          </span><span class="no">user: scanner-user</span>
</span><span id="__span-1-176"><a id="__codelineno-1-176" name="__codelineno-1-176"></a><span class="w">        </span><span class="no">name: scanner-context</span>
</span><span id="__span-1-177"><a id="__codelineno-1-177" name="__codelineno-1-177"></a><span class="w">      </span><span class="no">current-context: scanner-context</span>
</span><span id="__span-1-178"><a id="__codelineno-1-178" name="__codelineno-1-178"></a><span class="w">      </span><span class="no">users:</span>
</span><span id="__span-1-179"><a id="__codelineno-1-179" name="__codelineno-1-179"></a><span class="w">      </span><span class="no">- name: scanner-user</span>
</span><span id="__span-1-180"><a id="__codelineno-1-180" name="__codelineno-1-180"></a><span class="w">        </span><span class="no">user:</span>
</span><span id="__span-1-181"><a id="__codelineno-1-181" name="__codelineno-1-181"></a><span class="w">          </span><span class="no">token: ${SCANNER_TOKEN}</span>
</span><span id="__span-1-182"><a id="__codelineno-1-182" name="__codelineno-1-182"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-1-183"><a id="__codelineno-1-183" name="__codelineno-1-183"></a><span class="w">      </span><span class="no">chmod 600 scan-kubeconfig.yaml</span>
</span><span id="__span-1-184"><a id="__codelineno-1-184" name="__codelineno-1-184"></a>
</span><span id="__span-1-185"><a id="__codelineno-1-185" name="__codelineno-1-185"></a><span class="w">    </span><span class="c1"># Install CINC Auditor</span>
</span><span id="__span-1-186"><a id="__codelineno-1-186" name="__codelineno-1-186"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl -L https://omnitruck.cinc.sh/install.sh | sudo bash -s -- -P cinc-auditor</span>
</span><span id="__span-1-187"><a id="__codelineno-1-187" name="__codelineno-1-187"></a>
</span><span id="__span-1-188"><a id="__codelineno-1-188" name="__codelineno-1-188"></a><span class="w">    </span><span class="c1"># Install train-k8s-container plugin</span>
</span><span id="__span-1-189"><a id="__codelineno-1-189" name="__codelineno-1-189"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cinc-auditor plugin install train-k8s-container</span>
</span><span id="__span-1-190"><a id="__codelineno-1-190" name="__codelineno-1-190"></a>
</span><span id="__span-1-191"><a id="__codelineno-1-191" name="__codelineno-1-191"></a><span class="w">    </span><span class="c1"># Install SAF CLI</span>
</span><span id="__span-1-192"><a id="__codelineno-1-192" name="__codelineno-1-192"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm install -g @mitre/saf</span>
</span><span id="__span-1-193"><a id="__codelineno-1-193" name="__codelineno-1-193"></a>
</span><span id="__span-1-194"><a id="__codelineno-1-194" name="__codelineno-1-194"></a><span class="w">    </span><span class="c1"># Verify the tools</span>
</span><span id="__span-1-195"><a id="__codelineno-1-195" name="__codelineno-1-195"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cinc-auditor --version</span>
</span><span id="__span-1-196"><a id="__codelineno-1-196" name="__codelineno-1-196"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">saf --version</span>
</span><span id="__span-1-197"><a id="__codelineno-1-197" name="__codelineno-1-197"></a>
</span><span id="__span-1-198"><a id="__codelineno-1-198" name="__codelineno-1-198"></a><span class="w">    </span><span class="c1"># Find the target pod by label using the restricted token</span>
</span><span id="__span-1-199"><a id="__codelineno-1-199" name="__codelineno-1-199"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-200"><a id="__codelineno-1-200" name="__codelineno-1-200"></a><span class="w">      </span><span class="no">echo &quot;Looking for pods with label: ${SCAN_LABEL_KEY}=${SCAN_LABEL_VALUE}&quot;</span>
</span><span id="__span-1-201"><a id="__codelineno-1-201" name="__codelineno-1-201"></a><span class="w">      </span><span class="no">SCANNED_POD=$(KUBECONFIG=scan-kubeconfig.yaml kubectl get pods -n ${KUBERNETES_NAMESPACE} -l ${SCAN_LABEL_KEY}=${SCAN_LABEL_VALUE} -o jsonpath=&#39;{.items[0].metadata.name}&#39;)</span>
</span><span id="__span-1-202"><a id="__codelineno-1-202" name="__codelineno-1-202"></a><span class="w">      </span><span class="no">if [ -z &quot;$SCANNED_POD&quot; ]; then</span>
</span><span id="__span-1-203"><a id="__codelineno-1-203" name="__codelineno-1-203"></a><span class="w">        </span><span class="no">echo &quot;Error: No pod found with label ${SCAN_LABEL_KEY}=${SCAN_LABEL_VALUE} using restricted access&quot;</span>
</span><span id="__span-1-204"><a id="__codelineno-1-204" name="__codelineno-1-204"></a><span class="w">        </span><span class="no">exit 1</span>
</span><span id="__span-1-205"><a id="__codelineno-1-205" name="__codelineno-1-205"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-1-206"><a id="__codelineno-1-206" name="__codelineno-1-206"></a><span class="w">      </span><span class="no">echo &quot;Found target pod: ${SCANNED_POD}&quot;</span>
</span><span id="__span-1-207"><a id="__codelineno-1-207" name="__codelineno-1-207"></a>
</span><span id="__span-1-208"><a id="__codelineno-1-208" name="__codelineno-1-208"></a><span class="w">      </span><span class="no"># Verify it matches what we expected</span>
</span><span id="__span-1-209"><a id="__codelineno-1-209" name="__codelineno-1-209"></a><span class="w">      </span><span class="no">if [ &quot;$SCANNED_POD&quot; != &quot;$TARGET_POD&quot; ]; then</span>
</span><span id="__span-1-210"><a id="__codelineno-1-210" name="__codelineno-1-210"></a><span class="w">        </span><span class="no">echo &quot;Warning: Scanned pod ($SCANNED_POD) doesn&#39;t match expected target pod ($TARGET_POD)&quot;</span>
</span><span id="__span-1-211"><a id="__codelineno-1-211" name="__codelineno-1-211"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-1-212"><a id="__codelineno-1-212" name="__codelineno-1-212"></a>
</span><span id="__span-1-213"><a id="__codelineno-1-213" name="__codelineno-1-213"></a><span class="w">    </span><span class="c1"># Get container name</span>
</span><span id="__span-1-214"><a id="__codelineno-1-214" name="__codelineno-1-214"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINER_NAME=$(kubectl get pod ${TARGET_POD} -n ${KUBERNETES_NAMESPACE} -o jsonpath=&#39;{.spec.containers[0].name}&#39;)</span>
</span><span id="__span-1-215"><a id="__codelineno-1-215" name="__codelineno-1-215"></a>
</span><span id="__span-1-216"><a id="__codelineno-1-216" name="__codelineno-1-216"></a><span class="w">    </span><span class="c1"># Run CINC Auditor scan</span>
</span><span id="__span-1-217"><a id="__codelineno-1-217" name="__codelineno-1-217"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-218"><a id="__codelineno-1-218" name="__codelineno-1-218"></a><span class="w">      </span><span class="no">echo &quot;Running CINC Auditor scan on ${KUBERNETES_NAMESPACE}/${TARGET_POD}/${CONTAINER_NAME}&quot;</span>
</span><span id="__span-1-219"><a id="__codelineno-1-219" name="__codelineno-1-219"></a><span class="w">      </span><span class="no">KUBECONFIG=scan-kubeconfig.yaml cinc-auditor exec ${SCAN_PROFILE} \</span>
</span><span id="__span-1-220"><a id="__codelineno-1-220" name="__codelineno-1-220"></a><span class="w">        </span><span class="no">-t k8s-container://${KUBERNETES_NAMESPACE}/${TARGET_POD}/${CONTAINER_NAME} \</span>
</span><span id="__span-1-221"><a id="__codelineno-1-221" name="__codelineno-1-221"></a><span class="w">        </span><span class="no">--reporter cli json:scan-results.json</span>
</span><span id="__span-1-222"><a id="__codelineno-1-222" name="__codelineno-1-222"></a>
</span><span id="__span-1-223"><a id="__codelineno-1-223" name="__codelineno-1-223"></a><span class="w">      </span><span class="no"># Save scan exit code</span>
</span><span id="__span-1-224"><a id="__codelineno-1-224" name="__codelineno-1-224"></a><span class="w">      </span><span class="no">SCAN_EXIT_CODE=$?</span>
</span><span id="__span-1-225"><a id="__codelineno-1-225" name="__codelineno-1-225"></a><span class="w">      </span><span class="no">echo &quot;SCAN_EXIT_CODE=${SCAN_EXIT_CODE}&quot; &gt;&gt; scan.env</span>
</span><span id="__span-1-226"><a id="__codelineno-1-226" name="__codelineno-1-226"></a><span class="w">      </span><span class="no">echo &quot;Scan completed with exit code: ${SCAN_EXIT_CODE}&quot;</span>
</span><span id="__span-1-227"><a id="__codelineno-1-227" name="__codelineno-1-227"></a>
</span><span id="__span-1-228"><a id="__codelineno-1-228" name="__codelineno-1-228"></a><span class="w">    </span><span class="c1"># Process results with SAF-CLI</span>
</span><span id="__span-1-229"><a id="__codelineno-1-229" name="__codelineno-1-229"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-230"><a id="__codelineno-1-230" name="__codelineno-1-230"></a><span class="w">      </span><span class="no">echo &quot;Generating scan summary with SAF-CLI:&quot;</span>
</span><span id="__span-1-231"><a id="__codelineno-1-231" name="__codelineno-1-231"></a><span class="w">      </span><span class="no">saf summary --input scan-results.json --output-md scan-summary.md</span>
</span><span id="__span-1-232"><a id="__codelineno-1-232" name="__codelineno-1-232"></a>
</span><span id="__span-1-233"><a id="__codelineno-1-233" name="__codelineno-1-233"></a><span class="w">      </span><span class="no"># Display the summary in the logs</span>
</span><span id="__span-1-234"><a id="__codelineno-1-234" name="__codelineno-1-234"></a><span class="w">      </span><span class="no">cat scan-summary.md</span>
</span><span id="__span-1-235"><a id="__codelineno-1-235" name="__codelineno-1-235"></a>
</span><span id="__span-1-236"><a id="__codelineno-1-236" name="__codelineno-1-236"></a><span class="w">      </span><span class="no"># Create a threshold file</span>
</span><span id="__span-1-237"><a id="__codelineno-1-237" name="__codelineno-1-237"></a><span class="w">      </span><span class="no">cat &gt; threshold.yml &lt;&lt; EOF</span>
</span><span id="__span-1-238"><a id="__codelineno-1-238" name="__codelineno-1-238"></a><span class="w">      </span><span class="no">compliance:</span>
</span><span id="__span-1-239"><a id="__codelineno-1-239" name="__codelineno-1-239"></a><span class="w">        </span><span class="no">min: ${THRESHOLD_VALUE}</span>
</span><span id="__span-1-240"><a id="__codelineno-1-240" name="__codelineno-1-240"></a><span class="w">      </span><span class="no">failed:</span>
</span><span id="__span-1-241"><a id="__codelineno-1-241" name="__codelineno-1-241"></a><span class="w">        </span><span class="no">critical:</span>
</span><span id="__span-1-242"><a id="__codelineno-1-242" name="__codelineno-1-242"></a><span class="w">          </span><span class="no">max: 0  # No critical failures allowed</span>
</span><span id="__span-1-243"><a id="__codelineno-1-243" name="__codelineno-1-243"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-1-244"><a id="__codelineno-1-244" name="__codelineno-1-244"></a>
</span><span id="__span-1-245"><a id="__codelineno-1-245" name="__codelineno-1-245"></a><span class="w">      </span><span class="no"># Apply threshold check</span>
</span><span id="__span-1-246"><a id="__codelineno-1-246" name="__codelineno-1-246"></a><span class="w">      </span><span class="no">echo &quot;Checking against threshold with min compliance of ${THRESHOLD_VALUE}%:&quot;</span>
</span><span id="__span-1-247"><a id="__codelineno-1-247" name="__codelineno-1-247"></a><span class="w">      </span><span class="no">saf threshold -i scan-results.json -t threshold.yml</span>
</span><span id="__span-1-248"><a id="__codelineno-1-248" name="__codelineno-1-248"></a><span class="w">      </span><span class="no">THRESHOLD_RESULT=$?</span>
</span><span id="__span-1-249"><a id="__codelineno-1-249" name="__codelineno-1-249"></a><span class="w">      </span><span class="no">echo &quot;THRESHOLD_RESULT=${THRESHOLD_RESULT}&quot; &gt;&gt; scan.env</span>
</span><span id="__span-1-250"><a id="__codelineno-1-250" name="__codelineno-1-250"></a>
</span><span id="__span-1-251"><a id="__codelineno-1-251" name="__codelineno-1-251"></a><span class="w">      </span><span class="no">if [ $THRESHOLD_RESULT -eq 0 ]; then</span>
</span><span id="__span-1-252"><a id="__codelineno-1-252" name="__codelineno-1-252"></a><span class="w">        </span><span class="no">echo &quot; Security scan passed threshold requirements&quot;</span>
</span><span id="__span-1-253"><a id="__codelineno-1-253" name="__codelineno-1-253"></a><span class="w">      </span><span class="no">else</span>
</span><span id="__span-1-254"><a id="__codelineno-1-254" name="__codelineno-1-254"></a><span class="w">        </span><span class="no">echo &quot; Security scan failed to meet threshold requirements&quot;</span>
</span><span id="__span-1-255"><a id="__codelineno-1-255" name="__codelineno-1-255"></a><span class="w">        </span><span class="no"># Uncomment to enforce the threshold as a quality gate</span>
</span><span id="__span-1-256"><a id="__codelineno-1-256" name="__codelineno-1-256"></a><span class="w">        </span><span class="no"># exit $THRESHOLD_RESULT</span>
</span><span id="__span-1-257"><a id="__codelineno-1-257" name="__codelineno-1-257"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-1-258"><a id="__codelineno-1-258" name="__codelineno-1-258"></a>
</span><span id="__span-1-259"><a id="__codelineno-1-259" name="__codelineno-1-259"></a><span class="w">      </span><span class="no"># Generate comprehensive HTML report</span>
</span><span id="__span-1-260"><a id="__codelineno-1-260" name="__codelineno-1-260"></a><span class="w">      </span><span class="no">saf view -i scan-results.json --output scan-report.html</span>
</span><span id="__span-1-261"><a id="__codelineno-1-261" name="__codelineno-1-261"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-1-262"><a id="__codelineno-1-262" name="__codelineno-1-262"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-1-263"><a id="__codelineno-1-263" name="__codelineno-1-263"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-results.json</span>
</span><span id="__span-1-264"><a id="__codelineno-1-264" name="__codelineno-1-264"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-summary.md</span>
</span><span id="__span-1-265"><a id="__codelineno-1-265" name="__codelineno-1-265"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-report.html</span>
</span><span id="__span-1-266"><a id="__codelineno-1-266" name="__codelineno-1-266"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-1-267"><a id="__codelineno-1-267" name="__codelineno-1-267"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan.env</span>
</span><span id="__span-1-268"><a id="__codelineno-1-268" name="__codelineno-1-268"></a>
</span><span id="__span-1-269"><a id="__codelineno-1-269" name="__codelineno-1-269"></a><span class="nt">verify_rbac_restrictions</span><span class="p">:</span>
</span><span id="__span-1-270"><a id="__codelineno-1-270" name="__codelineno-1-270"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify</span>
</span><span id="__span-1-271"><a id="__codelineno-1-271" name="__codelineno-1-271"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">setup_test_environment</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">create_dynamic_rbac</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">run_security_scan</span><span class="p p-Indicator">]</span>
</span><span id="__span-1-272"><a id="__codelineno-1-272" name="__codelineno-1-272"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-1-273"><a id="__codelineno-1-273" name="__codelineno-1-273"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-1-274"><a id="__codelineno-1-274" name="__codelineno-1-274"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-1-275"><a id="__codelineno-1-275" name="__codelineno-1-275"></a>
</span><span id="__span-1-276"><a id="__codelineno-1-276" name="__codelineno-1-276"></a><span class="w">    </span><span class="c1"># Create a second kubeconfig with restricted token</span>
</span><span id="__span-1-277"><a id="__codelineno-1-277" name="__codelineno-1-277"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-278"><a id="__codelineno-1-278" name="__codelineno-1-278"></a><span class="w">      </span><span class="no">cat &gt; verify-kubeconfig.yaml &lt;&lt; EOF</span>
</span><span id="__span-1-279"><a id="__codelineno-1-279" name="__codelineno-1-279"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-1-280"><a id="__codelineno-1-280" name="__codelineno-1-280"></a><span class="w">      </span><span class="no">kind: Config</span>
</span><span id="__span-1-281"><a id="__codelineno-1-281" name="__codelineno-1-281"></a><span class="w">      </span><span class="no">preferences: {}</span>
</span><span id="__span-1-282"><a id="__codelineno-1-282" name="__codelineno-1-282"></a><span class="w">      </span><span class="no">clusters:</span>
</span><span id="__span-1-283"><a id="__codelineno-1-283" name="__codelineno-1-283"></a><span class="w">      </span><span class="no">- cluster:</span>
</span><span id="__span-1-284"><a id="__codelineno-1-284" name="__codelineno-1-284"></a><span class="w">          </span><span class="no">server: ${CLUSTER_SERVER}</span>
</span><span id="__span-1-285"><a id="__codelineno-1-285" name="__codelineno-1-285"></a><span class="w">          </span><span class="no">certificate-authority-data: ${CLUSTER_CA_DATA}</span>
</span><span id="__span-1-286"><a id="__codelineno-1-286" name="__codelineno-1-286"></a><span class="w">        </span><span class="no">name: scanner-cluster</span>
</span><span id="__span-1-287"><a id="__codelineno-1-287" name="__codelineno-1-287"></a><span class="w">      </span><span class="no">contexts:</span>
</span><span id="__span-1-288"><a id="__codelineno-1-288" name="__codelineno-1-288"></a><span class="w">      </span><span class="no">- context:</span>
</span><span id="__span-1-289"><a id="__codelineno-1-289" name="__codelineno-1-289"></a><span class="w">          </span><span class="no">cluster: scanner-cluster</span>
</span><span id="__span-1-290"><a id="__codelineno-1-290" name="__codelineno-1-290"></a><span class="w">          </span><span class="no">namespace: ${KUBERNETES_NAMESPACE}</span>
</span><span id="__span-1-291"><a id="__codelineno-1-291" name="__codelineno-1-291"></a><span class="w">          </span><span class="no">user: scanner-user</span>
</span><span id="__span-1-292"><a id="__codelineno-1-292" name="__codelineno-1-292"></a><span class="w">        </span><span class="no">name: scanner-context</span>
</span><span id="__span-1-293"><a id="__codelineno-1-293" name="__codelineno-1-293"></a><span class="w">      </span><span class="no">current-context: scanner-context</span>
</span><span id="__span-1-294"><a id="__codelineno-1-294" name="__codelineno-1-294"></a><span class="w">      </span><span class="no">users:</span>
</span><span id="__span-1-295"><a id="__codelineno-1-295" name="__codelineno-1-295"></a><span class="w">      </span><span class="no">- name: scanner-user</span>
</span><span id="__span-1-296"><a id="__codelineno-1-296" name="__codelineno-1-296"></a><span class="w">        </span><span class="no">user:</span>
</span><span id="__span-1-297"><a id="__codelineno-1-297" name="__codelineno-1-297"></a><span class="w">          </span><span class="no">token: ${SCANNER_TOKEN}</span>
</span><span id="__span-1-298"><a id="__codelineno-1-298" name="__codelineno-1-298"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-1-299"><a id="__codelineno-1-299" name="__codelineno-1-299"></a><span class="w">      </span><span class="no">chmod 600 verify-kubeconfig.yaml</span>
</span><span id="__span-1-300"><a id="__codelineno-1-300" name="__codelineno-1-300"></a>
</span><span id="__span-1-301"><a id="__codelineno-1-301" name="__codelineno-1-301"></a><span class="w">    </span><span class="c1"># Get a non-target pod name</span>
</span><span id="__span-1-302"><a id="__codelineno-1-302" name="__codelineno-1-302"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OTHER_POD=$(kubectl get pods -n ${KUBERNETES_NAMESPACE} -l app=test-pod-2 -o jsonpath=&#39;{.items[0].metadata.name}&#39;)</span>
</span><span id="__span-1-303"><a id="__codelineno-1-303" name="__codelineno-1-303"></a>
</span><span id="__span-1-304"><a id="__codelineno-1-304" name="__codelineno-1-304"></a><span class="w">    </span><span class="c1"># Check what we CAN do</span>
</span><span id="__span-1-305"><a id="__codelineno-1-305" name="__codelineno-1-305"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-306"><a id="__codelineno-1-306" name="__codelineno-1-306"></a><span class="w">      </span><span class="no">echo &quot;Verifying what we CAN do with restricted RBAC:&quot;</span>
</span><span id="__span-1-307"><a id="__codelineno-1-307" name="__codelineno-1-307"></a><span class="w">      </span><span class="no">echo &quot;Can list pods:&quot;</span>
</span><span id="__span-1-308"><a id="__codelineno-1-308" name="__codelineno-1-308"></a><span class="w">      </span><span class="no">KUBECONFIG=verify-kubeconfig.yaml kubectl get pods -n ${KUBERNETES_NAMESPACE} &gt; /dev/null &amp;&amp; </span>
</span><span id="__span-1-309"><a id="__codelineno-1-309" name="__codelineno-1-309"></a><span class="w">        </span><span class="no">echo &quot; Can list pods&quot; || </span>
</span><span id="__span-1-310"><a id="__codelineno-1-310" name="__codelineno-1-310"></a><span class="w">        </span><span class="no">echo &quot; Cannot list pods&quot;</span>
</span><span id="__span-1-311"><a id="__codelineno-1-311" name="__codelineno-1-311"></a>
</span><span id="__span-1-312"><a id="__codelineno-1-312" name="__codelineno-1-312"></a><span class="w">      </span><span class="no">echo &quot;Can exec into target pod:&quot;</span>
</span><span id="__span-1-313"><a id="__codelineno-1-313" name="__codelineno-1-313"></a><span class="w">      </span><span class="no">KUBECONFIG=verify-kubeconfig.yaml kubectl auth can-i create pods/exec --subresource=exec -n ${KUBERNETES_NAMESPACE} --resource-name=${TARGET_POD} &amp;&amp;</span>
</span><span id="__span-1-314"><a id="__codelineno-1-314" name="__codelineno-1-314"></a><span class="w">        </span><span class="no">echo &quot; Can exec into target pod&quot; || </span>
</span><span id="__span-1-315"><a id="__codelineno-1-315" name="__codelineno-1-315"></a><span class="w">        </span><span class="no">echo &quot; Cannot exec into target pod&quot;</span>
</span><span id="__span-1-316"><a id="__codelineno-1-316" name="__codelineno-1-316"></a>
</span><span id="__span-1-317"><a id="__codelineno-1-317" name="__codelineno-1-317"></a><span class="w">    </span><span class="c1"># Check what we CANNOT do</span>
</span><span id="__span-1-318"><a id="__codelineno-1-318" name="__codelineno-1-318"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-319"><a id="__codelineno-1-319" name="__codelineno-1-319"></a><span class="w">      </span><span class="no">echo &quot;Verifying what we CANNOT do with restricted RBAC:&quot;</span>
</span><span id="__span-1-320"><a id="__codelineno-1-320" name="__codelineno-1-320"></a><span class="w">      </span><span class="no">echo &quot;Cannot create pods:&quot;</span>
</span><span id="__span-1-321"><a id="__codelineno-1-321" name="__codelineno-1-321"></a><span class="w">      </span><span class="no">KUBECONFIG=verify-kubeconfig.yaml kubectl auth can-i create pods -n ${KUBERNETES_NAMESPACE} &amp;&amp; </span>
</span><span id="__span-1-322"><a id="__codelineno-1-322" name="__codelineno-1-322"></a><span class="w">        </span><span class="no">echo &quot; Security issue: Can create pods&quot; || </span>
</span><span id="__span-1-323"><a id="__codelineno-1-323" name="__codelineno-1-323"></a><span class="w">        </span><span class="no">echo &quot; Cannot create pods (expected)&quot;</span>
</span><span id="__span-1-324"><a id="__codelineno-1-324" name="__codelineno-1-324"></a>
</span><span id="__span-1-325"><a id="__codelineno-1-325" name="__codelineno-1-325"></a><span class="w">      </span><span class="no">echo &quot;Cannot delete pods:&quot;</span>
</span><span id="__span-1-326"><a id="__codelineno-1-326" name="__codelineno-1-326"></a><span class="w">      </span><span class="no">KUBECONFIG=verify-kubeconfig.yaml kubectl auth can-i delete pods -n ${KUBERNETES_NAMESPACE} &amp;&amp; </span>
</span><span id="__span-1-327"><a id="__codelineno-1-327" name="__codelineno-1-327"></a><span class="w">        </span><span class="no">echo &quot; Security issue: Can delete pods&quot; || </span>
</span><span id="__span-1-328"><a id="__codelineno-1-328" name="__codelineno-1-328"></a><span class="w">        </span><span class="no">echo &quot; Cannot delete pods (expected)&quot;</span>
</span><span id="__span-1-329"><a id="__codelineno-1-329" name="__codelineno-1-329"></a>
</span><span id="__span-1-330"><a id="__codelineno-1-330" name="__codelineno-1-330"></a><span class="w">    </span><span class="c1"># Create a security report for MR</span>
</span><span id="__span-1-331"><a id="__codelineno-1-331" name="__codelineno-1-331"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-1-332"><a id="__codelineno-1-332" name="__codelineno-1-332"></a><span class="w">      </span><span class="no">cat &gt; security-report.md &lt;&lt; EOF</span>
</span><span id="__span-1-333"><a id="__codelineno-1-333" name="__codelineno-1-333"></a><span class="w">      </span><span class="no"># Container Security Scan Report</span>
</span><span id="__span-1-334"><a id="__codelineno-1-334" name="__codelineno-1-334"></a>
</span><span id="__span-1-335"><a id="__codelineno-1-335" name="__codelineno-1-335"></a><span class="w">      </span><span class="no">## Scan Results</span>
</span><span id="__span-1-336"><a id="__codelineno-1-336" name="__codelineno-1-336"></a>
</span><span id="__span-1-337"><a id="__codelineno-1-337" name="__codelineno-1-337"></a><span class="w">      </span><span class="no">$(cat scan-summary.md)</span>
</span><span id="__span-1-338"><a id="__codelineno-1-338" name="__codelineno-1-338"></a>
</span><span id="__span-1-339"><a id="__codelineno-1-339" name="__codelineno-1-339"></a><span class="w">      </span><span class="no">## Threshold Check</span>
</span><span id="__span-1-340"><a id="__codelineno-1-340" name="__codelineno-1-340"></a>
</span><span id="__span-1-341"><a id="__codelineno-1-341" name="__codelineno-1-341"></a><span class="w">      </span><span class="no">$([[ &quot;${THRESHOLD_RESULT}&quot; -eq 0 ]] &amp;&amp; echo &quot; **PASSED**&quot; || echo &quot; **FAILED**&quot;)</span>
</span><span id="__span-1-342"><a id="__codelineno-1-342" name="__codelineno-1-342"></a>
</span><span id="__span-1-343"><a id="__codelineno-1-343" name="__codelineno-1-343"></a><span class="w">      </span><span class="no">Threshold: ${THRESHOLD_VALUE}%</span>
</span><span id="__span-1-344"><a id="__codelineno-1-344" name="__codelineno-1-344"></a>
</span><span id="__span-1-345"><a id="__codelineno-1-345" name="__codelineno-1-345"></a><span class="w">      </span><span class="no">## RBAC Security Verification</span>
</span><span id="__span-1-346"><a id="__codelineno-1-346" name="__codelineno-1-346"></a>
</span><span id="__span-1-347"><a id="__codelineno-1-347" name="__codelineno-1-347"></a><span class="w">      </span><span class="no">The scanner service account has properly restricted access:</span>
</span><span id="__span-1-348"><a id="__codelineno-1-348" name="__codelineno-1-348"></a><span class="w">      </span><span class="no">-  Can list pods in the namespace</span>
</span><span id="__span-1-349"><a id="__codelineno-1-349" name="__codelineno-1-349"></a><span class="w">      </span><span class="no">-  Can exec into target pods for scanning</span>
</span><span id="__span-1-350"><a id="__codelineno-1-350" name="__codelineno-1-350"></a><span class="w">      </span><span class="no">-  Cannot create or delete pods</span>
</span><span id="__span-1-351"><a id="__codelineno-1-351" name="__codelineno-1-351"></a><span class="w">      </span><span class="no">-  Cannot access cluster-wide resources</span>
</span><span id="__span-1-352"><a id="__codelineno-1-352" name="__codelineno-1-352"></a>
</span><span id="__span-1-353"><a id="__codelineno-1-353" name="__codelineno-1-353"></a><span class="w">      </span><span class="no">## Scan Details</span>
</span><span id="__span-1-354"><a id="__codelineno-1-354" name="__codelineno-1-354"></a>
</span><span id="__span-1-355"><a id="__codelineno-1-355" name="__codelineno-1-355"></a><span class="w">      </span><span class="no">- Target Pod: \`${TARGET_POD}\`</span>
</span><span id="__span-1-356"><a id="__codelineno-1-356" name="__codelineno-1-356"></a><span class="w">      </span><span class="no">- Container: \`${CONTAINER_NAME}\`</span>
</span><span id="__span-1-357"><a id="__codelineno-1-357" name="__codelineno-1-357"></a><span class="w">      </span><span class="no">- Image: \`${TARGET_IMAGE}\`</span>
</span><span id="__span-1-358"><a id="__codelineno-1-358" name="__codelineno-1-358"></a><span class="w">      </span><span class="no">- Profile: \`${SCAN_PROFILE}\`</span>
</span><span id="__span-1-359"><a id="__codelineno-1-359" name="__codelineno-1-359"></a>
</span><span id="__span-1-360"><a id="__codelineno-1-360" name="__codelineno-1-360"></a><span class="w">      </span><span class="no">For full results, see the scan artifacts.</span>
</span><span id="__span-1-361"><a id="__codelineno-1-361" name="__codelineno-1-361"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-1-362"><a id="__codelineno-1-362" name="__codelineno-1-362"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-1-363"><a id="__codelineno-1-363" name="__codelineno-1-363"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-1-364"><a id="__codelineno-1-364" name="__codelineno-1-364"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security-report.md</span>
</span><span id="__span-1-365"><a id="__codelineno-1-365" name="__codelineno-1-365"></a>
</span><span id="__span-1-366"><a id="__codelineno-1-366" name="__codelineno-1-366"></a><span class="nt">cleanup</span><span class="p">:</span>
</span><span id="__span-1-367"><a id="__codelineno-1-367" name="__codelineno-1-367"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-1-368"><a id="__codelineno-1-368" name="__codelineno-1-368"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">setup_test_environment</span><span class="p p-Indicator">]</span>
</span><span id="__span-1-369"><a id="__codelineno-1-369" name="__codelineno-1-369"></a><span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span><span class="w">  </span><span class="c1"># Run even if previous stages failed</span>
</span><span id="__span-1-370"><a id="__codelineno-1-370" name="__codelineno-1-370"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-1-371"><a id="__codelineno-1-371" name="__codelineno-1-371"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-1-372"><a id="__codelineno-1-372" name="__codelineno-1-372"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-1-373"><a id="__codelineno-1-373" name="__codelineno-1-373"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl delete namespace ${KUBERNETES_NAMESPACE} --ignore-not-found</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="existing-cluster-scanning-pipeline">Existing Cluster Scanning Pipeline<a class="headerlink" href="#existing-cluster-scanning-pipeline" title="Permanent link">&para;</a></h2>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">  1</a></span>
<span class="normal"><a href="#__codelineno-2-2">  2</a></span>
<span class="normal"><a href="#__codelineno-2-3">  3</a></span>
<span class="normal"><a href="#__codelineno-2-4">  4</a></span>
<span class="normal"><a href="#__codelineno-2-5">  5</a></span>
<span class="normal"><a href="#__codelineno-2-6">  6</a></span>
<span class="normal"><a href="#__codelineno-2-7">  7</a></span>
<span class="normal"><a href="#__codelineno-2-8">  8</a></span>
<span class="normal"><a href="#__codelineno-2-9">  9</a></span>
<span class="normal"><a href="#__codelineno-2-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-2-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-2-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-2-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-2-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-2-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-2-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-2-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-2-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-2-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-2-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-2-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-2-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-2-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-2-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-2-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-2-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-2-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-2-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-2-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-2-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-2-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-2-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-2-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-2-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-2-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-2-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-2-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-2-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-2-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-2-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-2-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-2-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-2-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-2-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-2-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-2-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-2-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-2-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-2-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-2-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-2-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-2-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-2-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-2-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-2-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-2-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-2-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-2-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-2-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-2-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-2-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-2-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-2-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-2-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-2-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-2-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-2-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-2-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-2-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-2-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-2-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-2-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-2-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-2-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-2-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-2-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-2-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-2-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-2-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-2-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-2-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-2-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-2-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-2-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-2-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-2-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-2-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-2-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-2-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-2-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-2-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-2-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-2-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-2-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-2-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-2-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-2-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-2-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-2-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-2-100">100</a></span>
<span class="normal"><a href="#__codelineno-2-101">101</a></span>
<span class="normal"><a href="#__codelineno-2-102">102</a></span>
<span class="normal"><a href="#__codelineno-2-103">103</a></span>
<span class="normal"><a href="#__codelineno-2-104">104</a></span>
<span class="normal"><a href="#__codelineno-2-105">105</a></span>
<span class="normal"><a href="#__codelineno-2-106">106</a></span>
<span class="normal"><a href="#__codelineno-2-107">107</a></span>
<span class="normal"><a href="#__codelineno-2-108">108</a></span>
<span class="normal"><a href="#__codelineno-2-109">109</a></span>
<span class="normal"><a href="#__codelineno-2-110">110</a></span>
<span class="normal"><a href="#__codelineno-2-111">111</a></span>
<span class="normal"><a href="#__codelineno-2-112">112</a></span>
<span class="normal"><a href="#__codelineno-2-113">113</a></span>
<span class="normal"><a href="#__codelineno-2-114">114</a></span>
<span class="normal"><a href="#__codelineno-2-115">115</a></span>
<span class="normal"><a href="#__codelineno-2-116">116</a></span>
<span class="normal"><a href="#__codelineno-2-117">117</a></span>
<span class="normal"><a href="#__codelineno-2-118">118</a></span>
<span class="normal"><a href="#__codelineno-2-119">119</a></span>
<span class="normal"><a href="#__codelineno-2-120">120</a></span>
<span class="normal"><a href="#__codelineno-2-121">121</a></span>
<span class="normal"><a href="#__codelineno-2-122">122</a></span>
<span class="normal"><a href="#__codelineno-2-123">123</a></span>
<span class="normal"><a href="#__codelineno-2-124">124</a></span>
<span class="normal"><a href="#__codelineno-2-125">125</a></span>
<span class="normal"><a href="#__codelineno-2-126">126</a></span>
<span class="normal"><a href="#__codelineno-2-127">127</a></span>
<span class="normal"><a href="#__codelineno-2-128">128</a></span>
<span class="normal"><a href="#__codelineno-2-129">129</a></span>
<span class="normal"><a href="#__codelineno-2-130">130</a></span>
<span class="normal"><a href="#__codelineno-2-131">131</a></span>
<span class="normal"><a href="#__codelineno-2-132">132</a></span>
<span class="normal"><a href="#__codelineno-2-133">133</a></span>
<span class="normal"><a href="#__codelineno-2-134">134</a></span>
<span class="normal"><a href="#__codelineno-2-135">135</a></span>
<span class="normal"><a href="#__codelineno-2-136">136</a></span>
<span class="normal"><a href="#__codelineno-2-137">137</a></span>
<span class="normal"><a href="#__codelineno-2-138">138</a></span>
<span class="normal"><a href="#__codelineno-2-139">139</a></span>
<span class="normal"><a href="#__codelineno-2-140">140</a></span>
<span class="normal"><a href="#__codelineno-2-141">141</a></span>
<span class="normal"><a href="#__codelineno-2-142">142</a></span>
<span class="normal"><a href="#__codelineno-2-143">143</a></span>
<span class="normal"><a href="#__codelineno-2-144">144</a></span>
<span class="normal"><a href="#__codelineno-2-145">145</a></span>
<span class="normal"><a href="#__codelineno-2-146">146</a></span>
<span class="normal"><a href="#__codelineno-2-147">147</a></span>
<span class="normal"><a href="#__codelineno-2-148">148</a></span>
<span class="normal"><a href="#__codelineno-2-149">149</a></span>
<span class="normal"><a href="#__codelineno-2-150">150</a></span>
<span class="normal"><a href="#__codelineno-2-151">151</a></span>
<span class="normal"><a href="#__codelineno-2-152">152</a></span>
<span class="normal"><a href="#__codelineno-2-153">153</a></span>
<span class="normal"><a href="#__codelineno-2-154">154</a></span>
<span class="normal"><a href="#__codelineno-2-155">155</a></span>
<span class="normal"><a href="#__codelineno-2-156">156</a></span>
<span class="normal"><a href="#__codelineno-2-157">157</a></span>
<span class="normal"><a href="#__codelineno-2-158">158</a></span>
<span class="normal"><a href="#__codelineno-2-159">159</a></span>
<span class="normal"><a href="#__codelineno-2-160">160</a></span>
<span class="normal"><a href="#__codelineno-2-161">161</a></span>
<span class="normal"><a href="#__codelineno-2-162">162</a></span>
<span class="normal"><a href="#__codelineno-2-163">163</a></span>
<span class="normal"><a href="#__codelineno-2-164">164</a></span>
<span class="normal"><a href="#__codelineno-2-165">165</a></span>
<span class="normal"><a href="#__codelineno-2-166">166</a></span>
<span class="normal"><a href="#__codelineno-2-167">167</a></span>
<span class="normal"><a href="#__codelineno-2-168">168</a></span>
<span class="normal"><a href="#__codelineno-2-169">169</a></span>
<span class="normal"><a href="#__codelineno-2-170">170</a></span>
<span class="normal"><a href="#__codelineno-2-171">171</a></span>
<span class="normal"><a href="#__codelineno-2-172">172</a></span>
<span class="normal"><a href="#__codelineno-2-173">173</a></span>
<span class="normal"><a href="#__codelineno-2-174">174</a></span>
<span class="normal"><a href="#__codelineno-2-175">175</a></span>
<span class="normal"><a href="#__codelineno-2-176">176</a></span>
<span class="normal"><a href="#__codelineno-2-177">177</a></span>
<span class="normal"><a href="#__codelineno-2-178">178</a></span>
<span class="normal"><a href="#__codelineno-2-179">179</a></span>
<span class="normal"><a href="#__codelineno-2-180">180</a></span>
<span class="normal"><a href="#__codelineno-2-181">181</a></span>
<span class="normal"><a href="#__codelineno-2-182">182</a></span>
<span class="normal"><a href="#__codelineno-2-183">183</a></span>
<span class="normal"><a href="#__codelineno-2-184">184</a></span>
<span class="normal"><a href="#__codelineno-2-185">185</a></span>
<span class="normal"><a href="#__codelineno-2-186">186</a></span>
<span class="normal"><a href="#__codelineno-2-187">187</a></span>
<span class="normal"><a href="#__codelineno-2-188">188</a></span>
<span class="normal"><a href="#__codelineno-2-189">189</a></span>
<span class="normal"><a href="#__codelineno-2-190">190</a></span>
<span class="normal"><a href="#__codelineno-2-191">191</a></span>
<span class="normal"><a href="#__codelineno-2-192">192</a></span>
<span class="normal"><a href="#__codelineno-2-193">193</a></span>
<span class="normal"><a href="#__codelineno-2-194">194</a></span>
<span class="normal"><a href="#__codelineno-2-195">195</a></span>
<span class="normal"><a href="#__codelineno-2-196">196</a></span>
<span class="normal"><a href="#__codelineno-2-197">197</a></span>
<span class="normal"><a href="#__codelineno-2-198">198</a></span>
<span class="normal"><a href="#__codelineno-2-199">199</a></span>
<span class="normal"><a href="#__codelineno-2-200">200</a></span>
<span class="normal"><a href="#__codelineno-2-201">201</a></span>
<span class="normal"><a href="#__codelineno-2-202">202</a></span>
<span class="normal"><a href="#__codelineno-2-203">203</a></span>
<span class="normal"><a href="#__codelineno-2-204">204</a></span>
<span class="normal"><a href="#__codelineno-2-205">205</a></span>
<span class="normal"><a href="#__codelineno-2-206">206</a></span>
<span class="normal"><a href="#__codelineno-2-207">207</a></span>
<span class="normal"><a href="#__codelineno-2-208">208</a></span>
<span class="normal"><a href="#__codelineno-2-209">209</a></span>
<span class="normal"><a href="#__codelineno-2-210">210</a></span>
<span class="normal"><a href="#__codelineno-2-211">211</a></span>
<span class="normal"><a href="#__codelineno-2-212">212</a></span>
<span class="normal"><a href="#__codelineno-2-213">213</a></span>
<span class="normal"><a href="#__codelineno-2-214">214</a></span>
<span class="normal"><a href="#__codelineno-2-215">215</a></span>
<span class="normal"><a href="#__codelineno-2-216">216</a></span>
<span class="normal"><a href="#__codelineno-2-217">217</a></span>
<span class="normal"><a href="#__codelineno-2-218">218</a></span>
<span class="normal"><a href="#__codelineno-2-219">219</a></span>
<span class="normal"><a href="#__codelineno-2-220">220</a></span>
<span class="normal"><a href="#__codelineno-2-221">221</a></span>
<span class="normal"><a href="#__codelineno-2-222">222</a></span>
<span class="normal"><a href="#__codelineno-2-223">223</a></span>
<span class="normal"><a href="#__codelineno-2-224">224</a></span>
<span class="normal"><a href="#__codelineno-2-225">225</a></span>
<span class="normal"><a href="#__codelineno-2-226">226</a></span>
<span class="normal"><a href="#__codelineno-2-227">227</a></span>
<span class="normal"><a href="#__codelineno-2-228">228</a></span>
<span class="normal"><a href="#__codelineno-2-229">229</a></span>
<span class="normal"><a href="#__codelineno-2-230">230</a></span>
<span class="normal"><a href="#__codelineno-2-231">231</a></span>
<span class="normal"><a href="#__codelineno-2-232">232</a></span>
<span class="normal"><a href="#__codelineno-2-233">233</a></span>
<span class="normal"><a href="#__codelineno-2-234">234</a></span>
<span class="normal"><a href="#__codelineno-2-235">235</a></span>
<span class="normal"><a href="#__codelineno-2-236">236</a></span>
<span class="normal"><a href="#__codelineno-2-237">237</a></span>
<span class="normal"><a href="#__codelineno-2-238">238</a></span>
<span class="normal"><a href="#__codelineno-2-239">239</a></span>
<span class="normal"><a href="#__codelineno-2-240">240</a></span>
<span class="normal"><a href="#__codelineno-2-241">241</a></span>
<span class="normal"><a href="#__codelineno-2-242">242</a></span>
<span class="normal"><a href="#__codelineno-2-243">243</a></span>
<span class="normal"><a href="#__codelineno-2-244">244</a></span>
<span class="normal"><a href="#__codelineno-2-245">245</a></span>
<span class="normal"><a href="#__codelineno-2-246">246</a></span>
<span class="normal"><a href="#__codelineno-2-247">247</a></span>
<span class="normal"><a href="#__codelineno-2-248">248</a></span>
<span class="normal"><a href="#__codelineno-2-249">249</a></span>
<span class="normal"><a href="#__codelineno-2-250">250</a></span>
<span class="normal"><a href="#__codelineno-2-251">251</a></span>
<span class="normal"><a href="#__codelineno-2-252">252</a></span>
<span class="normal"><a href="#__codelineno-2-253">253</a></span>
<span class="normal"><a href="#__codelineno-2-254">254</a></span>
<span class="normal"><a href="#__codelineno-2-255">255</a></span>
<span class="normal"><a href="#__codelineno-2-256">256</a></span>
<span class="normal"><a href="#__codelineno-2-257">257</a></span>
<span class="normal"><a href="#__codelineno-2-258">258</a></span>
<span class="normal"><a href="#__codelineno-2-259">259</a></span>
<span class="normal"><a href="#__codelineno-2-260">260</a></span>
<span class="normal"><a href="#__codelineno-2-261">261</a></span>
<span class="normal"><a href="#__codelineno-2-262">262</a></span>
<span class="normal"><a href="#__codelineno-2-263">263</a></span>
<span class="normal"><a href="#__codelineno-2-264">264</a></span>
<span class="normal"><a href="#__codelineno-2-265">265</a></span>
<span class="normal"><a href="#__codelineno-2-266">266</a></span>
<span class="normal"><a href="#__codelineno-2-267">267</a></span>
<span class="normal"><a href="#__codelineno-2-268">268</a></span>
<span class="normal"><a href="#__codelineno-2-269">269</a></span>
<span class="normal"><a href="#__codelineno-2-270">270</a></span>
<span class="normal"><a href="#__codelineno-2-271">271</a></span>
<span class="normal"><a href="#__codelineno-2-272">272</a></span>
<span class="normal"><a href="#__codelineno-2-273">273</a></span>
<span class="normal"><a href="#__codelineno-2-274">274</a></span>
<span class="normal"><a href="#__codelineno-2-275">275</a></span>
<span class="normal"><a href="#__codelineno-2-276">276</a></span>
<span class="normal"><a href="#__codelineno-2-277">277</a></span>
<span class="normal"><a href="#__codelineno-2-278">278</a></span>
<span class="normal"><a href="#__codelineno-2-279">279</a></span>
<span class="normal"><a href="#__codelineno-2-280">280</a></span>
<span class="normal"><a href="#__codelineno-2-281">281</a></span>
<span class="normal"><a href="#__codelineno-2-282">282</a></span>
<span class="normal"><a href="#__codelineno-2-283">283</a></span>
<span class="normal"><a href="#__codelineno-2-284">284</a></span>
<span class="normal"><a href="#__codelineno-2-285">285</a></span>
<span class="normal"><a href="#__codelineno-2-286">286</a></span>
<span class="normal"><a href="#__codelineno-2-287">287</a></span>
<span class="normal"><a href="#__codelineno-2-288">288</a></span>
<span class="normal"><a href="#__codelineno-2-289">289</a></span>
<span class="normal"><a href="#__codelineno-2-290">290</a></span>
<span class="normal"><a href="#__codelineno-2-291">291</a></span>
<span class="normal"><a href="#__codelineno-2-292">292</a></span>
<span class="normal"><a href="#__codelineno-2-293">293</a></span>
<span class="normal"><a href="#__codelineno-2-294">294</a></span>
<span class="normal"><a href="#__codelineno-2-295">295</a></span>
<span class="normal"><a href="#__codelineno-2-296">296</a></span>
<span class="normal"><a href="#__codelineno-2-297">297</a></span>
<span class="normal"><a href="#__codelineno-2-298">298</a></span>
<span class="normal"><a href="#__codelineno-2-299">299</a></span>
<span class="normal"><a href="#__codelineno-2-300">300</a></span>
<span class="normal"><a href="#__codelineno-2-301">301</a></span>
<span class="normal"><a href="#__codelineno-2-302">302</a></span>
<span class="normal"><a href="#__codelineno-2-303">303</a></span>
<span class="normal"><a href="#__codelineno-2-304">304</a></span>
<span class="normal"><a href="#__codelineno-2-305">305</a></span>
<span class="normal"><a href="#__codelineno-2-306">306</a></span>
<span class="normal"><a href="#__codelineno-2-307">307</a></span>
<span class="normal"><a href="#__codelineno-2-308">308</a></span>
<span class="normal"><a href="#__codelineno-2-309">309</a></span>
<span class="normal"><a href="#__codelineno-2-310">310</a></span>
<span class="normal"><a href="#__codelineno-2-311">311</a></span>
<span class="normal"><a href="#__codelineno-2-312">312</a></span>
<span class="normal"><a href="#__codelineno-2-313">313</a></span>
<span class="normal"><a href="#__codelineno-2-314">314</a></span>
<span class="normal"><a href="#__codelineno-2-315">315</a></span>
<span class="normal"><a href="#__codelineno-2-316">316</a></span>
<span class="normal"><a href="#__codelineno-2-317">317</a></span>
<span class="normal"><a href="#__codelineno-2-318">318</a></span>
<span class="normal"><a href="#__codelineno-2-319">319</a></span>
<span class="normal"><a href="#__codelineno-2-320">320</a></span>
<span class="normal"><a href="#__codelineno-2-321">321</a></span>
<span class="normal"><a href="#__codelineno-2-322">322</a></span>
<span class="normal"><a href="#__codelineno-2-323">323</a></span>
<span class="normal"><a href="#__codelineno-2-324">324</a></span>
<span class="normal"><a href="#__codelineno-2-325">325</a></span>
<span class="normal"><a href="#__codelineno-2-326">326</a></span>
<span class="normal"><a href="#__codelineno-2-327">327</a></span>
<span class="normal"><a href="#__codelineno-2-328">328</a></span>
<span class="normal"><a href="#__codelineno-2-329">329</a></span>
<span class="normal"><a href="#__codelineno-2-330">330</a></span>
<span class="normal"><a href="#__codelineno-2-331">331</a></span>
<span class="normal"><a href="#__codelineno-2-332">332</a></span>
<span class="normal"><a href="#__codelineno-2-333">333</a></span>
<span class="normal"><a href="#__codelineno-2-334">334</a></span>
<span class="normal"><a href="#__codelineno-2-335">335</a></span>
<span class="normal"><a href="#__codelineno-2-336">336</a></span>
<span class="normal"><a href="#__codelineno-2-337">337</a></span>
<span class="normal"><a href="#__codelineno-2-338">338</a></span>
<span class="normal"><a href="#__codelineno-2-339">339</a></span>
<span class="normal"><a href="#__codelineno-2-340">340</a></span>
<span class="normal"><a href="#__codelineno-2-341">341</a></span>
<span class="normal"><a href="#__codelineno-2-342">342</a></span>
<span class="normal"><a href="#__codelineno-2-343">343</a></span>
<span class="normal"><a href="#__codelineno-2-344">344</a></span>
<span class="normal"><a href="#__codelineno-2-345">345</a></span>
<span class="normal"><a href="#__codelineno-2-346">346</a></span>
<span class="normal"><a href="#__codelineno-2-347">347</a></span>
<span class="normal"><a href="#__codelineno-2-348">348</a></span>
<span class="normal"><a href="#__codelineno-2-349">349</a></span>
<span class="normal"><a href="#__codelineno-2-350">350</a></span>
<span class="normal"><a href="#__codelineno-2-351">351</a></span>
<span class="normal"><a href="#__codelineno-2-352">352</a></span>
<span class="normal"><a href="#__codelineno-2-353">353</a></span>
<span class="normal"><a href="#__codelineno-2-354">354</a></span>
<span class="normal"><a href="#__codelineno-2-355">355</a></span>
<span class="normal"><a href="#__codelineno-2-356">356</a></span>
<span class="normal"><a href="#__codelineno-2-357">357</a></span>
<span class="normal"><a href="#__codelineno-2-358">358</a></span>
<span class="normal"><a href="#__codelineno-2-359">359</a></span>
<span class="normal"><a href="#__codelineno-2-360">360</a></span>
<span class="normal"><a href="#__codelineno-2-361">361</a></span>
<span class="normal"><a href="#__codelineno-2-362">362</a></span>
<span class="normal"><a href="#__codelineno-2-363">363</a></span>
<span class="normal"><a href="#__codelineno-2-364">364</a></span>
<span class="normal"><a href="#__codelineno-2-365">365</a></span>
<span class="normal"><a href="#__codelineno-2-366">366</a></span>
<span class="normal"><a href="#__codelineno-2-367">367</a></span>
<span class="normal"><a href="#__codelineno-2-368">368</a></span>
<span class="normal"><a href="#__codelineno-2-369">369</a></span>
<span class="normal"><a href="#__codelineno-2-370">370</a></span>
<span class="normal"><a href="#__codelineno-2-371">371</a></span>
<span class="normal"><a href="#__codelineno-2-372">372</a></span>
<span class="normal"><a href="#__codelineno-2-373">373</a></span>
<span class="normal"><a href="#__codelineno-2-374">374</a></span>
<span class="normal"><a href="#__codelineno-2-375">375</a></span>
<span class="normal"><a href="#__codelineno-2-376">376</a></span>
<span class="normal"><a href="#__codelineno-2-377">377</a></span>
<span class="normal"><a href="#__codelineno-2-378">378</a></span>
<span class="normal"><a href="#__codelineno-2-379">379</a></span>
<span class="normal"><a href="#__codelineno-2-380">380</a></span>
<span class="normal"><a href="#__codelineno-2-381">381</a></span>
<span class="normal"><a href="#__codelineno-2-382">382</a></span>
<span class="normal"><a href="#__codelineno-2-383">383</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nt">stages</span><span class="p">:</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prepare</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">  </span><span class="c1"># Default values - override in UI or with pipeline parameters</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">  </span><span class="nt">SCAN_NAMESPACE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="w">  </span><span class="c1"># Existing namespace where pods are deployed</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">  </span><span class="nt">TARGET_LABEL_SELECTOR</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;scan-target=true&quot;</span><span class="w">  </span><span class="c1"># Label to identify target pods</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">  </span><span class="nt">CINC_PROFILE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dev-sec/linux-baseline&quot;</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">  </span><span class="nt">THRESHOLD_VALUE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;70&quot;</span><span class="w">  </span><span class="c1"># Minimum passing score (0-100)</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">  </span><span class="nt">DURATION_MINUTES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;15&quot;</span><span class="w">  </span><span class="c1"># Token duration in minutes</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14"></a>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="c1"># Define workflow</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="nt">workflow</span><span class="p">:</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;web&quot;</span><span class="w">  </span><span class="c1"># Manual trigger from UI</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;schedule&quot;</span><span class="w">  </span><span class="c1"># Scheduled pipeline</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;trigger&quot;</span><span class="w">  </span><span class="c1"># API trigger with token</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21"></a>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="c1"># Find pods to scan in existing cluster</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="nt">prepare_scan</span><span class="p">:</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prepare</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/kubectl:latest</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="w">    </span><span class="c1"># Configure kubectl with cluster credentials</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30"></a>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="w">    </span><span class="c1"># Create a unique run ID for this pipeline</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RUN_ID=&quot;gl-$CI_PIPELINE_ID-$CI_JOB_ID&quot;</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;RUN_ID=${RUN_ID}&quot; &gt;&gt; prepare.env</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34"></a>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="w">    </span><span class="c1"># Verify the namespace exists</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl get namespace ${SCAN_NAMESPACE} || { echo &quot;Namespace ${SCAN_NAMESPACE} does not exist&quot;; exit 1; }</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37"></a>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="w">    </span><span class="c1"># Find target pods with specified label</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="w">      </span><span class="no">TARGET_PODS=$(kubectl get pods -n ${SCAN_NAMESPACE} -l ${TARGET_LABEL_SELECTOR} -o jsonpath=&#39;{.items[*].metadata.name}&#39;)</span>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="w">      </span><span class="no">if [ -z &quot;$TARGET_PODS&quot; ]; then</span>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42"></a><span class="w">        </span><span class="no">echo &quot;No pods found matching label: ${TARGET_LABEL_SELECTOR} in namespace ${SCAN_NAMESPACE}&quot;</span>
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="w">        </span><span class="no">exit 1</span>
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-2-45"><a id="__codelineno-2-45" name="__codelineno-2-45"></a>
</span><span id="__span-2-46"><a id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="w">      </span><span class="no"># Count and list found pods</span>
</span><span id="__span-2-47"><a id="__codelineno-2-47" name="__codelineno-2-47"></a><span class="w">      </span><span class="no">POD_COUNT=$(echo $TARGET_PODS | wc -w)</span>
</span><span id="__span-2-48"><a id="__codelineno-2-48" name="__codelineno-2-48"></a><span class="w">      </span><span class="no">echo &quot;Found ${POD_COUNT} pods to scan:&quot;</span>
</span><span id="__span-2-49"><a id="__codelineno-2-49" name="__codelineno-2-49"></a><span class="w">      </span><span class="no">kubectl get pods -n ${SCAN_NAMESPACE} -l ${TARGET_LABEL_SELECTOR} --show-labels</span>
</span><span id="__span-2-50"><a id="__codelineno-2-50" name="__codelineno-2-50"></a>
</span><span id="__span-2-51"><a id="__codelineno-2-51" name="__codelineno-2-51"></a><span class="w">      </span><span class="no"># Get the first pod as primary target</span>
</span><span id="__span-2-52"><a id="__codelineno-2-52" name="__codelineno-2-52"></a><span class="w">      </span><span class="no">PRIMARY_POD=$(echo $TARGET_PODS | cut -d&#39; &#39; -f1)</span>
</span><span id="__span-2-53"><a id="__codelineno-2-53" name="__codelineno-2-53"></a><span class="w">      </span><span class="no">echo &quot;Primary target pod: ${PRIMARY_POD}&quot;</span>
</span><span id="__span-2-54"><a id="__codelineno-2-54" name="__codelineno-2-54"></a><span class="w">      </span><span class="no">echo &quot;PRIMARY_POD=${PRIMARY_POD}&quot; &gt;&gt; prepare.env</span>
</span><span id="__span-2-55"><a id="__codelineno-2-55" name="__codelineno-2-55"></a>
</span><span id="__span-2-56"><a id="__codelineno-2-56" name="__codelineno-2-56"></a><span class="w">      </span><span class="no"># Get container name for the primary pod</span>
</span><span id="__span-2-57"><a id="__codelineno-2-57" name="__codelineno-2-57"></a><span class="w">      </span><span class="no">PRIMARY_CONTAINER=$(kubectl get pod ${PRIMARY_POD} -n ${SCAN_NAMESPACE} -o jsonpath=&#39;{.spec.containers[0].name}&#39;)</span>
</span><span id="__span-2-58"><a id="__codelineno-2-58" name="__codelineno-2-58"></a><span class="w">      </span><span class="no">echo &quot;Primary container: ${PRIMARY_CONTAINER}&quot;</span>
</span><span id="__span-2-59"><a id="__codelineno-2-59" name="__codelineno-2-59"></a><span class="w">      </span><span class="no">echo &quot;PRIMARY_CONTAINER=${PRIMARY_CONTAINER}&quot; &gt;&gt; prepare.env</span>
</span><span id="__span-2-60"><a id="__codelineno-2-60" name="__codelineno-2-60"></a>
</span><span id="__span-2-61"><a id="__codelineno-2-61" name="__codelineno-2-61"></a><span class="w">      </span><span class="no"># Check for custom profile annotation</span>
</span><span id="__span-2-62"><a id="__codelineno-2-62" name="__codelineno-2-62"></a><span class="w">      </span><span class="no">PROFILE_ANNOTATION=$(kubectl get pod ${PRIMARY_POD} -n ${SCAN_NAMESPACE} -o jsonpath=&#39;{.metadata.annotations.scan-profile}&#39; 2&gt;/dev/null || echo &quot;&quot;)</span>
</span><span id="__span-2-63"><a id="__codelineno-2-63" name="__codelineno-2-63"></a><span class="w">      </span><span class="no">if [ -n &quot;$PROFILE_ANNOTATION&quot; ]; then</span>
</span><span id="__span-2-64"><a id="__codelineno-2-64" name="__codelineno-2-64"></a><span class="w">        </span><span class="no">echo &quot;Found profile annotation: ${PROFILE_ANNOTATION}&quot;</span>
</span><span id="__span-2-65"><a id="__codelineno-2-65" name="__codelineno-2-65"></a><span class="w">        </span><span class="no">echo &quot;PROFILE=${PROFILE_ANNOTATION}&quot; &gt;&gt; prepare.env</span>
</span><span id="__span-2-66"><a id="__codelineno-2-66" name="__codelineno-2-66"></a><span class="w">      </span><span class="no">else</span>
</span><span id="__span-2-67"><a id="__codelineno-2-67" name="__codelineno-2-67"></a><span class="w">        </span><span class="no">echo &quot;Using default profile: ${CINC_PROFILE}&quot;</span>
</span><span id="__span-2-68"><a id="__codelineno-2-68" name="__codelineno-2-68"></a><span class="w">        </span><span class="no">echo &quot;PROFILE=${CINC_PROFILE}&quot; &gt;&gt; prepare.env</span>
</span><span id="__span-2-69"><a id="__codelineno-2-69" name="__codelineno-2-69"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-2-70"><a id="__codelineno-2-70" name="__codelineno-2-70"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-2-71"><a id="__codelineno-2-71" name="__codelineno-2-71"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-2-72"><a id="__codelineno-2-72" name="__codelineno-2-72"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prepare.env</span>
</span><span id="__span-2-73"><a id="__codelineno-2-73" name="__codelineno-2-73"></a>
</span><span id="__span-2-74"><a id="__codelineno-2-74" name="__codelineno-2-74"></a><span class="c1"># Create temporary RBAC for scanning</span>
</span><span id="__span-2-75"><a id="__codelineno-2-75" name="__codelineno-2-75"></a><span class="nt">create_rbac</span><span class="p">:</span>
</span><span id="__span-2-76"><a id="__codelineno-2-76" name="__codelineno-2-76"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prepare</span>
</span><span id="__span-2-77"><a id="__codelineno-2-77" name="__codelineno-2-77"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/kubectl:latest</span>
</span><span id="__span-2-78"><a id="__codelineno-2-78" name="__codelineno-2-78"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">prepare_scan</span><span class="p p-Indicator">]</span>
</span><span id="__span-2-79"><a id="__codelineno-2-79" name="__codelineno-2-79"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-2-80"><a id="__codelineno-2-80" name="__codelineno-2-80"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-2-81"><a id="__codelineno-2-81" name="__codelineno-2-81"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-2-82"><a id="__codelineno-2-82" name="__codelineno-2-82"></a>
</span><span id="__span-2-83"><a id="__codelineno-2-83" name="__codelineno-2-83"></a><span class="w">    </span><span class="c1"># Create service account for scanning</span>
</span><span id="__span-2-84"><a id="__codelineno-2-84" name="__codelineno-2-84"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-85"><a id="__codelineno-2-85" name="__codelineno-2-85"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-2-86"><a id="__codelineno-2-86" name="__codelineno-2-86"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-2-87"><a id="__codelineno-2-87" name="__codelineno-2-87"></a><span class="w">      </span><span class="no">kind: ServiceAccount</span>
</span><span id="__span-2-88"><a id="__codelineno-2-88" name="__codelineno-2-88"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-2-89"><a id="__codelineno-2-89" name="__codelineno-2-89"></a><span class="w">        </span><span class="no">name: scanner-${RUN_ID}</span>
</span><span id="__span-2-90"><a id="__codelineno-2-90" name="__codelineno-2-90"></a><span class="w">        </span><span class="no">namespace: ${SCAN_NAMESPACE}</span>
</span><span id="__span-2-91"><a id="__codelineno-2-91" name="__codelineno-2-91"></a><span class="w">        </span><span class="no">labels:</span>
</span><span id="__span-2-92"><a id="__codelineno-2-92" name="__codelineno-2-92"></a><span class="w">          </span><span class="no">app: security-scanner</span>
</span><span id="__span-2-93"><a id="__codelineno-2-93" name="__codelineno-2-93"></a><span class="w">          </span><span class="no">component: cinc-auditor</span>
</span><span id="__span-2-94"><a id="__codelineno-2-94" name="__codelineno-2-94"></a><span class="w">          </span><span class="no">pipeline: &quot;${CI_PIPELINE_ID}&quot;</span>
</span><span id="__span-2-95"><a id="__codelineno-2-95" name="__codelineno-2-95"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-2-96"><a id="__codelineno-2-96" name="__codelineno-2-96"></a>
</span><span id="__span-2-97"><a id="__codelineno-2-97" name="__codelineno-2-97"></a><span class="w">    </span><span class="c1"># Create role with least privilege</span>
</span><span id="__span-2-98"><a id="__codelineno-2-98" name="__codelineno-2-98"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-99"><a id="__codelineno-2-99" name="__codelineno-2-99"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-2-100"><a id="__codelineno-2-100" name="__codelineno-2-100"></a><span class="w">      </span><span class="no">apiVersion: rbac.authorization.k8s.io/v1</span>
</span><span id="__span-2-101"><a id="__codelineno-2-101" name="__codelineno-2-101"></a><span class="w">      </span><span class="no">kind: Role</span>
</span><span id="__span-2-102"><a id="__codelineno-2-102" name="__codelineno-2-102"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-2-103"><a id="__codelineno-2-103" name="__codelineno-2-103"></a><span class="w">        </span><span class="no">name: scanner-role-${RUN_ID}</span>
</span><span id="__span-2-104"><a id="__codelineno-2-104" name="__codelineno-2-104"></a><span class="w">        </span><span class="no">namespace: ${SCAN_NAMESPACE}</span>
</span><span id="__span-2-105"><a id="__codelineno-2-105" name="__codelineno-2-105"></a><span class="w">        </span><span class="no">labels:</span>
</span><span id="__span-2-106"><a id="__codelineno-2-106" name="__codelineno-2-106"></a><span class="w">          </span><span class="no">app: security-scanner</span>
</span><span id="__span-2-107"><a id="__codelineno-2-107" name="__codelineno-2-107"></a><span class="w">          </span><span class="no">component: cinc-auditor</span>
</span><span id="__span-2-108"><a id="__codelineno-2-108" name="__codelineno-2-108"></a><span class="w">          </span><span class="no">pipeline: &quot;${CI_PIPELINE_ID}&quot;</span>
</span><span id="__span-2-109"><a id="__codelineno-2-109" name="__codelineno-2-109"></a><span class="w">      </span><span class="no">rules:</span>
</span><span id="__span-2-110"><a id="__codelineno-2-110" name="__codelineno-2-110"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-2-111"><a id="__codelineno-2-111" name="__codelineno-2-111"></a><span class="w">        </span><span class="no">resources: [&quot;pods&quot;]</span>
</span><span id="__span-2-112"><a id="__codelineno-2-112" name="__codelineno-2-112"></a><span class="w">        </span><span class="no">verbs: [&quot;get&quot;, &quot;list&quot;]</span>
</span><span id="__span-2-113"><a id="__codelineno-2-113" name="__codelineno-2-113"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-2-114"><a id="__codelineno-2-114" name="__codelineno-2-114"></a><span class="w">        </span><span class="no">resources: [&quot;pods/exec&quot;]</span>
</span><span id="__span-2-115"><a id="__codelineno-2-115" name="__codelineno-2-115"></a><span class="w">        </span><span class="no">verbs: [&quot;create&quot;]</span>
</span><span id="__span-2-116"><a id="__codelineno-2-116" name="__codelineno-2-116"></a><span class="w">        </span><span class="no">resourceNames: [&quot;${PRIMARY_POD}&quot;]</span>
</span><span id="__span-2-117"><a id="__codelineno-2-117" name="__codelineno-2-117"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-2-118"><a id="__codelineno-2-118" name="__codelineno-2-118"></a><span class="w">        </span><span class="no">resources: [&quot;pods/log&quot;]</span>
</span><span id="__span-2-119"><a id="__codelineno-2-119" name="__codelineno-2-119"></a><span class="w">        </span><span class="no">verbs: [&quot;get&quot;]</span>
</span><span id="__span-2-120"><a id="__codelineno-2-120" name="__codelineno-2-120"></a><span class="w">        </span><span class="no">resourceNames: [&quot;${PRIMARY_POD}&quot;]</span>
</span><span id="__span-2-121"><a id="__codelineno-2-121" name="__codelineno-2-121"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-2-122"><a id="__codelineno-2-122" name="__codelineno-2-122"></a>
</span><span id="__span-2-123"><a id="__codelineno-2-123" name="__codelineno-2-123"></a><span class="w">    </span><span class="c1"># Create role binding</span>
</span><span id="__span-2-124"><a id="__codelineno-2-124" name="__codelineno-2-124"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-125"><a id="__codelineno-2-125" name="__codelineno-2-125"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-2-126"><a id="__codelineno-2-126" name="__codelineno-2-126"></a><span class="w">      </span><span class="no">apiVersion: rbac.authorization.k8s.io/v1</span>
</span><span id="__span-2-127"><a id="__codelineno-2-127" name="__codelineno-2-127"></a><span class="w">      </span><span class="no">kind: RoleBinding</span>
</span><span id="__span-2-128"><a id="__codelineno-2-128" name="__codelineno-2-128"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-2-129"><a id="__codelineno-2-129" name="__codelineno-2-129"></a><span class="w">        </span><span class="no">name: scanner-binding-${RUN_ID}</span>
</span><span id="__span-2-130"><a id="__codelineno-2-130" name="__codelineno-2-130"></a><span class="w">        </span><span class="no">namespace: ${SCAN_NAMESPACE}</span>
</span><span id="__span-2-131"><a id="__codelineno-2-131" name="__codelineno-2-131"></a><span class="w">        </span><span class="no">labels:</span>
</span><span id="__span-2-132"><a id="__codelineno-2-132" name="__codelineno-2-132"></a><span class="w">          </span><span class="no">app: security-scanner</span>
</span><span id="__span-2-133"><a id="__codelineno-2-133" name="__codelineno-2-133"></a><span class="w">          </span><span class="no">component: cinc-auditor</span>
</span><span id="__span-2-134"><a id="__codelineno-2-134" name="__codelineno-2-134"></a><span class="w">          </span><span class="no">pipeline: &quot;${CI_PIPELINE_ID}&quot;</span>
</span><span id="__span-2-135"><a id="__codelineno-2-135" name="__codelineno-2-135"></a><span class="w">      </span><span class="no">subjects:</span>
</span><span id="__span-2-136"><a id="__codelineno-2-136" name="__codelineno-2-136"></a><span class="w">      </span><span class="no">- kind: ServiceAccount</span>
</span><span id="__span-2-137"><a id="__codelineno-2-137" name="__codelineno-2-137"></a><span class="w">        </span><span class="no">name: scanner-${RUN_ID}</span>
</span><span id="__span-2-138"><a id="__codelineno-2-138" name="__codelineno-2-138"></a><span class="w">        </span><span class="no">namespace: ${SCAN_NAMESPACE}</span>
</span><span id="__span-2-139"><a id="__codelineno-2-139" name="__codelineno-2-139"></a><span class="w">      </span><span class="no">roleRef:</span>
</span><span id="__span-2-140"><a id="__codelineno-2-140" name="__codelineno-2-140"></a><span class="w">        </span><span class="no">kind: Role</span>
</span><span id="__span-2-141"><a id="__codelineno-2-141" name="__codelineno-2-141"></a><span class="w">        </span><span class="no">name: scanner-role-${RUN_ID}</span>
</span><span id="__span-2-142"><a id="__codelineno-2-142" name="__codelineno-2-142"></a><span class="w">        </span><span class="no">apiGroup: rbac.authorization.k8s.io</span>
</span><span id="__span-2-143"><a id="__codelineno-2-143" name="__codelineno-2-143"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-2-144"><a id="__codelineno-2-144" name="__codelineno-2-144"></a>
</span><span id="__span-2-145"><a id="__codelineno-2-145" name="__codelineno-2-145"></a><span class="w">    </span><span class="c1"># Generate token for service account</span>
</span><span id="__span-2-146"><a id="__codelineno-2-146" name="__codelineno-2-146"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-147"><a id="__codelineno-2-147" name="__codelineno-2-147"></a><span class="w">      </span><span class="no">TOKEN=$(kubectl create token scanner-${RUN_ID} -n ${SCAN_NAMESPACE} --duration=${DURATION_MINUTES}m)</span>
</span><span id="__span-2-148"><a id="__codelineno-2-148" name="__codelineno-2-148"></a><span class="w">      </span><span class="no">SERVER=$(kubectl config view --minify --output=jsonpath=&#39;{.clusters[0].cluster.server}&#39;)</span>
</span><span id="__span-2-149"><a id="__codelineno-2-149" name="__codelineno-2-149"></a><span class="w">      </span><span class="no">CA_DATA=$(kubectl config view --raw --minify --flatten -o jsonpath=&#39;{.clusters[].cluster.certificate-authority-data}&#39;)</span>
</span><span id="__span-2-150"><a id="__codelineno-2-150" name="__codelineno-2-150"></a>
</span><span id="__span-2-151"><a id="__codelineno-2-151" name="__codelineno-2-151"></a><span class="w">      </span><span class="no"># Save token and cluster info for later stages</span>
</span><span id="__span-2-152"><a id="__codelineno-2-152" name="__codelineno-2-152"></a><span class="w">      </span><span class="no">echo &quot;SCANNER_TOKEN=${TOKEN}&quot; &gt;&gt; rbac.env</span>
</span><span id="__span-2-153"><a id="__codelineno-2-153" name="__codelineno-2-153"></a><span class="w">      </span><span class="no">echo &quot;CLUSTER_SERVER=${SERVER}&quot; &gt;&gt; rbac.env</span>
</span><span id="__span-2-154"><a id="__codelineno-2-154" name="__codelineno-2-154"></a><span class="w">      </span><span class="no">echo &quot;CLUSTER_CA_DATA=${CA_DATA}&quot; &gt;&gt; rbac.env</span>
</span><span id="__span-2-155"><a id="__codelineno-2-155" name="__codelineno-2-155"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-2-156"><a id="__codelineno-2-156" name="__codelineno-2-156"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-2-157"><a id="__codelineno-2-157" name="__codelineno-2-157"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.env</span>
</span><span id="__span-2-158"><a id="__codelineno-2-158" name="__codelineno-2-158"></a>
</span><span id="__span-2-159"><a id="__codelineno-2-159" name="__codelineno-2-159"></a><span class="c1"># Run the security scan with restricted access</span>
</span><span id="__span-2-160"><a id="__codelineno-2-160" name="__codelineno-2-160"></a><span class="nt">run_security_scan</span><span class="p">:</span>
</span><span id="__span-2-161"><a id="__codelineno-2-161" name="__codelineno-2-161"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-2-162"><a id="__codelineno-2-162" name="__codelineno-2-162"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.gitlab.com/gitlab-org/security-products/analyzers/container-scanning:5</span>
</span><span id="__span-2-163"><a id="__codelineno-2-163" name="__codelineno-2-163"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">prepare_scan</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">create_rbac</span><span class="p p-Indicator">]</span>
</span><span id="__span-2-164"><a id="__codelineno-2-164" name="__codelineno-2-164"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-2-165"><a id="__codelineno-2-165" name="__codelineno-2-165"></a><span class="w">    </span><span class="c1"># Create restricted kubeconfig</span>
</span><span id="__span-2-166"><a id="__codelineno-2-166" name="__codelineno-2-166"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-167"><a id="__codelineno-2-167" name="__codelineno-2-167"></a><span class="w">      </span><span class="no">cat &gt; scanner-kubeconfig.yaml &lt;&lt; EOF</span>
</span><span id="__span-2-168"><a id="__codelineno-2-168" name="__codelineno-2-168"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-2-169"><a id="__codelineno-2-169" name="__codelineno-2-169"></a><span class="w">      </span><span class="no">kind: Config</span>
</span><span id="__span-2-170"><a id="__codelineno-2-170" name="__codelineno-2-170"></a><span class="w">      </span><span class="no">preferences: {}</span>
</span><span id="__span-2-171"><a id="__codelineno-2-171" name="__codelineno-2-171"></a><span class="w">      </span><span class="no">clusters:</span>
</span><span id="__span-2-172"><a id="__codelineno-2-172" name="__codelineno-2-172"></a><span class="w">      </span><span class="no">- cluster:</span>
</span><span id="__span-2-173"><a id="__codelineno-2-173" name="__codelineno-2-173"></a><span class="w">          </span><span class="no">server: ${CLUSTER_SERVER}</span>
</span><span id="__span-2-174"><a id="__codelineno-2-174" name="__codelineno-2-174"></a><span class="w">          </span><span class="no">certificate-authority-data: ${CLUSTER_CA_DATA}</span>
</span><span id="__span-2-175"><a id="__codelineno-2-175" name="__codelineno-2-175"></a><span class="w">        </span><span class="no">name: scanner-cluster</span>
</span><span id="__span-2-176"><a id="__codelineno-2-176" name="__codelineno-2-176"></a><span class="w">      </span><span class="no">contexts:</span>
</span><span id="__span-2-177"><a id="__codelineno-2-177" name="__codelineno-2-177"></a><span class="w">      </span><span class="no">- context:</span>
</span><span id="__span-2-178"><a id="__codelineno-2-178" name="__codelineno-2-178"></a><span class="w">          </span><span class="no">cluster: scanner-cluster</span>
</span><span id="__span-2-179"><a id="__codelineno-2-179" name="__codelineno-2-179"></a><span class="w">          </span><span class="no">namespace: ${SCAN_NAMESPACE}</span>
</span><span id="__span-2-180"><a id="__codelineno-2-180" name="__codelineno-2-180"></a><span class="w">          </span><span class="no">user: scanner-user</span>
</span><span id="__span-2-181"><a id="__codelineno-2-181" name="__codelineno-2-181"></a><span class="w">        </span><span class="no">name: scanner-context</span>
</span><span id="__span-2-182"><a id="__codelineno-2-182" name="__codelineno-2-182"></a><span class="w">      </span><span class="no">current-context: scanner-context</span>
</span><span id="__span-2-183"><a id="__codelineno-2-183" name="__codelineno-2-183"></a><span class="w">      </span><span class="no">users:</span>
</span><span id="__span-2-184"><a id="__codelineno-2-184" name="__codelineno-2-184"></a><span class="w">      </span><span class="no">- name: scanner-user</span>
</span><span id="__span-2-185"><a id="__codelineno-2-185" name="__codelineno-2-185"></a><span class="w">        </span><span class="no">user:</span>
</span><span id="__span-2-186"><a id="__codelineno-2-186" name="__codelineno-2-186"></a><span class="w">          </span><span class="no">token: ${SCANNER_TOKEN}</span>
</span><span id="__span-2-187"><a id="__codelineno-2-187" name="__codelineno-2-187"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-2-188"><a id="__codelineno-2-188" name="__codelineno-2-188"></a><span class="w">      </span><span class="no">chmod 600 scanner-kubeconfig.yaml</span>
</span><span id="__span-2-189"><a id="__codelineno-2-189" name="__codelineno-2-189"></a>
</span><span id="__span-2-190"><a id="__codelineno-2-190" name="__codelineno-2-190"></a><span class="w">    </span><span class="c1"># Install CINC Auditor and plugins</span>
</span><span id="__span-2-191"><a id="__codelineno-2-191" name="__codelineno-2-191"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl -L https://omnitruck.cinc.sh/install.sh | bash -s -- -P cinc-auditor</span>
</span><span id="__span-2-192"><a id="__codelineno-2-192" name="__codelineno-2-192"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cinc-auditor plugin install train-k8s-container</span>
</span><span id="__span-2-193"><a id="__codelineno-2-193" name="__codelineno-2-193"></a>
</span><span id="__span-2-194"><a id="__codelineno-2-194" name="__codelineno-2-194"></a><span class="w">    </span><span class="c1"># Install SAF CLI</span>
</span><span id="__span-2-195"><a id="__codelineno-2-195" name="__codelineno-2-195"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apt-get update &amp;&amp; apt-get install -y npm</span>
</span><span id="__span-2-196"><a id="__codelineno-2-196" name="__codelineno-2-196"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm install -g @mitre/saf</span>
</span><span id="__span-2-197"><a id="__codelineno-2-197" name="__codelineno-2-197"></a>
</span><span id="__span-2-198"><a id="__codelineno-2-198" name="__codelineno-2-198"></a><span class="w">    </span><span class="c1"># Test restricted access</span>
</span><span id="__span-2-199"><a id="__codelineno-2-199" name="__codelineno-2-199"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-200"><a id="__codelineno-2-200" name="__codelineno-2-200"></a><span class="w">      </span><span class="no">echo &quot;Testing restricted access:&quot;</span>
</span><span id="__span-2-201"><a id="__codelineno-2-201" name="__codelineno-2-201"></a><span class="w">      </span><span class="no">export KUBECONFIG=scanner-kubeconfig.yaml</span>
</span><span id="__span-2-202"><a id="__codelineno-2-202" name="__codelineno-2-202"></a><span class="w">      </span><span class="no">kubectl get pods -n ${SCAN_NAMESPACE} -l ${TARGET_LABEL_SELECTOR}</span>
</span><span id="__span-2-203"><a id="__codelineno-2-203" name="__codelineno-2-203"></a>
</span><span id="__span-2-204"><a id="__codelineno-2-204" name="__codelineno-2-204"></a><span class="w">      </span><span class="no">echo &quot;Verifying target pod access:&quot;</span>
</span><span id="__span-2-205"><a id="__codelineno-2-205" name="__codelineno-2-205"></a><span class="w">      </span><span class="no">kubectl get pod ${PRIMARY_POD} -n ${SCAN_NAMESPACE} -o name || { echo &quot;Cannot access target pod with restricted token&quot;; exit 1; }</span>
</span><span id="__span-2-206"><a id="__codelineno-2-206" name="__codelineno-2-206"></a>
</span><span id="__span-2-207"><a id="__codelineno-2-207" name="__codelineno-2-207"></a><span class="w">    </span><span class="c1"># Run the scan</span>
</span><span id="__span-2-208"><a id="__codelineno-2-208" name="__codelineno-2-208"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-209"><a id="__codelineno-2-209" name="__codelineno-2-209"></a><span class="w">      </span><span class="no">echo &quot;Running CINC Auditor scan on ${SCAN_NAMESPACE}/${PRIMARY_POD}/${PRIMARY_CONTAINER}&quot;</span>
</span><span id="__span-2-210"><a id="__codelineno-2-210" name="__codelineno-2-210"></a><span class="w">      </span><span class="no">KUBECONFIG=scanner-kubeconfig.yaml cinc-auditor exec ${PROFILE} \</span>
</span><span id="__span-2-211"><a id="__codelineno-2-211" name="__codelineno-2-211"></a><span class="w">        </span><span class="no">-t k8s-container://${SCAN_NAMESPACE}/${PRIMARY_POD}/${PRIMARY_CONTAINER} \</span>
</span><span id="__span-2-212"><a id="__codelineno-2-212" name="__codelineno-2-212"></a><span class="w">        </span><span class="no">--reporter cli json:scan-results.json</span>
</span><span id="__span-2-213"><a id="__codelineno-2-213" name="__codelineno-2-213"></a>
</span><span id="__span-2-214"><a id="__codelineno-2-214" name="__codelineno-2-214"></a><span class="w">      </span><span class="no"># Save scan exit code</span>
</span><span id="__span-2-215"><a id="__codelineno-2-215" name="__codelineno-2-215"></a><span class="w">      </span><span class="no">SCAN_EXIT_CODE=$?</span>
</span><span id="__span-2-216"><a id="__codelineno-2-216" name="__codelineno-2-216"></a><span class="w">      </span><span class="no">echo &quot;SCAN_EXIT_CODE=${SCAN_EXIT_CODE}&quot; &gt;&gt; scan.env</span>
</span><span id="__span-2-217"><a id="__codelineno-2-217" name="__codelineno-2-217"></a><span class="w">      </span><span class="no">echo &quot;Scan completed with exit code: ${SCAN_EXIT_CODE}&quot;</span>
</span><span id="__span-2-218"><a id="__codelineno-2-218" name="__codelineno-2-218"></a>
</span><span id="__span-2-219"><a id="__codelineno-2-219" name="__codelineno-2-219"></a><span class="w">    </span><span class="c1"># Process results with SAF-CLI</span>
</span><span id="__span-2-220"><a id="__codelineno-2-220" name="__codelineno-2-220"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-221"><a id="__codelineno-2-221" name="__codelineno-2-221"></a><span class="w">      </span><span class="no">echo &quot;Generating scan summary with SAF-CLI:&quot;</span>
</span><span id="__span-2-222"><a id="__codelineno-2-222" name="__codelineno-2-222"></a><span class="w">      </span><span class="no">saf summary --input scan-results.json --output-md scan-summary.md</span>
</span><span id="__span-2-223"><a id="__codelineno-2-223" name="__codelineno-2-223"></a>
</span><span id="__span-2-224"><a id="__codelineno-2-224" name="__codelineno-2-224"></a><span class="w">      </span><span class="no"># Display the summary in the logs</span>
</span><span id="__span-2-225"><a id="__codelineno-2-225" name="__codelineno-2-225"></a><span class="w">      </span><span class="no">cat scan-summary.md</span>
</span><span id="__span-2-226"><a id="__codelineno-2-226" name="__codelineno-2-226"></a>
</span><span id="__span-2-227"><a id="__codelineno-2-227" name="__codelineno-2-227"></a><span class="w">      </span><span class="no"># Create a threshold file</span>
</span><span id="__span-2-228"><a id="__codelineno-2-228" name="__codelineno-2-228"></a><span class="w">      </span><span class="no">cat &gt; threshold.yml &lt;&lt; EOF</span>
</span><span id="__span-2-229"><a id="__codelineno-2-229" name="__codelineno-2-229"></a><span class="w">      </span><span class="no">compliance:</span>
</span><span id="__span-2-230"><a id="__codelineno-2-230" name="__codelineno-2-230"></a><span class="w">        </span><span class="no">min: ${THRESHOLD_VALUE}</span>
</span><span id="__span-2-231"><a id="__codelineno-2-231" name="__codelineno-2-231"></a><span class="w">      </span><span class="no">failed:</span>
</span><span id="__span-2-232"><a id="__codelineno-2-232" name="__codelineno-2-232"></a><span class="w">        </span><span class="no">critical:</span>
</span><span id="__span-2-233"><a id="__codelineno-2-233" name="__codelineno-2-233"></a><span class="w">          </span><span class="no">max: 0  # No critical failures allowed</span>
</span><span id="__span-2-234"><a id="__codelineno-2-234" name="__codelineno-2-234"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-2-235"><a id="__codelineno-2-235" name="__codelineno-2-235"></a>
</span><span id="__span-2-236"><a id="__codelineno-2-236" name="__codelineno-2-236"></a><span class="w">      </span><span class="no"># Apply threshold check</span>
</span><span id="__span-2-237"><a id="__codelineno-2-237" name="__codelineno-2-237"></a><span class="w">      </span><span class="no">echo &quot;Checking against threshold with min compliance of ${THRESHOLD_VALUE}%:&quot;</span>
</span><span id="__span-2-238"><a id="__codelineno-2-238" name="__codelineno-2-238"></a><span class="w">      </span><span class="no">saf threshold -i scan-results.json -t threshold.yml</span>
</span><span id="__span-2-239"><a id="__codelineno-2-239" name="__codelineno-2-239"></a><span class="w">      </span><span class="no">THRESHOLD_RESULT=$?</span>
</span><span id="__span-2-240"><a id="__codelineno-2-240" name="__codelineno-2-240"></a><span class="w">      </span><span class="no">echo &quot;THRESHOLD_RESULT=${THRESHOLD_RESULT}&quot; &gt;&gt; scan.env</span>
</span><span id="__span-2-241"><a id="__codelineno-2-241" name="__codelineno-2-241"></a>
</span><span id="__span-2-242"><a id="__codelineno-2-242" name="__codelineno-2-242"></a><span class="w">      </span><span class="no">if [ $THRESHOLD_RESULT -eq 0 ]; then</span>
</span><span id="__span-2-243"><a id="__codelineno-2-243" name="__codelineno-2-243"></a><span class="w">        </span><span class="no">echo &quot; Security scan passed threshold requirements&quot;</span>
</span><span id="__span-2-244"><a id="__codelineno-2-244" name="__codelineno-2-244"></a><span class="w">      </span><span class="no">else</span>
</span><span id="__span-2-245"><a id="__codelineno-2-245" name="__codelineno-2-245"></a><span class="w">        </span><span class="no">echo &quot; Security scan failed to meet threshold requirements&quot;</span>
</span><span id="__span-2-246"><a id="__codelineno-2-246" name="__codelineno-2-246"></a><span class="w">        </span><span class="no"># Uncomment to enforce the threshold as a quality gate</span>
</span><span id="__span-2-247"><a id="__codelineno-2-247" name="__codelineno-2-247"></a><span class="w">        </span><span class="no"># exit $THRESHOLD_RESULT</span>
</span><span id="__span-2-248"><a id="__codelineno-2-248" name="__codelineno-2-248"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-2-249"><a id="__codelineno-2-249" name="__codelineno-2-249"></a>
</span><span id="__span-2-250"><a id="__codelineno-2-250" name="__codelineno-2-250"></a><span class="w">      </span><span class="no"># Generate HTML report</span>
</span><span id="__span-2-251"><a id="__codelineno-2-251" name="__codelineno-2-251"></a><span class="w">      </span><span class="no">saf view -i scan-results.json --output scan-report.html</span>
</span><span id="__span-2-252"><a id="__codelineno-2-252" name="__codelineno-2-252"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-2-253"><a id="__codelineno-2-253" name="__codelineno-2-253"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-2-254"><a id="__codelineno-2-254" name="__codelineno-2-254"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-results.json</span>
</span><span id="__span-2-255"><a id="__codelineno-2-255" name="__codelineno-2-255"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-summary.md</span>
</span><span id="__span-2-256"><a id="__codelineno-2-256" name="__codelineno-2-256"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-report.html</span>
</span><span id="__span-2-257"><a id="__codelineno-2-257" name="__codelineno-2-257"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">threshold.yml</span>
</span><span id="__span-2-258"><a id="__codelineno-2-258" name="__codelineno-2-258"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-2-259"><a id="__codelineno-2-259" name="__codelineno-2-259"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan.env</span>
</span><span id="__span-2-260"><a id="__codelineno-2-260" name="__codelineno-2-260"></a>
</span><span id="__span-2-261"><a id="__codelineno-2-261" name="__codelineno-2-261"></a><span class="c1"># Verify RBAC permissions are properly restricted</span>
</span><span id="__span-2-262"><a id="__codelineno-2-262" name="__codelineno-2-262"></a><span class="nt">verify_rbac</span><span class="p">:</span>
</span><span id="__span-2-263"><a id="__codelineno-2-263" name="__codelineno-2-263"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify</span>
</span><span id="__span-2-264"><a id="__codelineno-2-264" name="__codelineno-2-264"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/kubectl:latest</span>
</span><span id="__span-2-265"><a id="__codelineno-2-265" name="__codelineno-2-265"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">prepare_scan</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">create_rbac</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">run_security_scan</span><span class="p p-Indicator">]</span>
</span><span id="__span-2-266"><a id="__codelineno-2-266" name="__codelineno-2-266"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-2-267"><a id="__codelineno-2-267" name="__codelineno-2-267"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-2-268"><a id="__codelineno-2-268" name="__codelineno-2-268"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-2-269"><a id="__codelineno-2-269" name="__codelineno-2-269"></a>
</span><span id="__span-2-270"><a id="__codelineno-2-270" name="__codelineno-2-270"></a><span class="w">    </span><span class="c1"># Create restricted kubeconfig for testing</span>
</span><span id="__span-2-271"><a id="__codelineno-2-271" name="__codelineno-2-271"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-272"><a id="__codelineno-2-272" name="__codelineno-2-272"></a><span class="w">      </span><span class="no">cat &gt; scanner-kubeconfig.yaml &lt;&lt; EOF</span>
</span><span id="__span-2-273"><a id="__codelineno-2-273" name="__codelineno-2-273"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-2-274"><a id="__codelineno-2-274" name="__codelineno-2-274"></a><span class="w">      </span><span class="no">kind: Config</span>
</span><span id="__span-2-275"><a id="__codelineno-2-275" name="__codelineno-2-275"></a><span class="w">      </span><span class="no">preferences: {}</span>
</span><span id="__span-2-276"><a id="__codelineno-2-276" name="__codelineno-2-276"></a><span class="w">      </span><span class="no">clusters:</span>
</span><span id="__span-2-277"><a id="__codelineno-2-277" name="__codelineno-2-277"></a><span class="w">      </span><span class="no">- cluster:</span>
</span><span id="__span-2-278"><a id="__codelineno-2-278" name="__codelineno-2-278"></a><span class="w">          </span><span class="no">server: ${CLUSTER_SERVER}</span>
</span><span id="__span-2-279"><a id="__codelineno-2-279" name="__codelineno-2-279"></a><span class="w">          </span><span class="no">certificate-authority-data: ${CLUSTER_CA_DATA}</span>
</span><span id="__span-2-280"><a id="__codelineno-2-280" name="__codelineno-2-280"></a><span class="w">        </span><span class="no">name: scanner-cluster</span>
</span><span id="__span-2-281"><a id="__codelineno-2-281" name="__codelineno-2-281"></a><span class="w">      </span><span class="no">contexts:</span>
</span><span id="__span-2-282"><a id="__codelineno-2-282" name="__codelineno-2-282"></a><span class="w">      </span><span class="no">- context:</span>
</span><span id="__span-2-283"><a id="__codelineno-2-283" name="__codelineno-2-283"></a><span class="w">          </span><span class="no">cluster: scanner-cluster</span>
</span><span id="__span-2-284"><a id="__codelineno-2-284" name="__codelineno-2-284"></a><span class="w">          </span><span class="no">namespace: ${SCAN_NAMESPACE}</span>
</span><span id="__span-2-285"><a id="__codelineno-2-285" name="__codelineno-2-285"></a><span class="w">          </span><span class="no">user: scanner-user</span>
</span><span id="__span-2-286"><a id="__codelineno-2-286" name="__codelineno-2-286"></a><span class="w">        </span><span class="no">name: scanner-context</span>
</span><span id="__span-2-287"><a id="__codelineno-2-287" name="__codelineno-2-287"></a><span class="w">      </span><span class="no">current-context: scanner-context</span>
</span><span id="__span-2-288"><a id="__codelineno-2-288" name="__codelineno-2-288"></a><span class="w">      </span><span class="no">users:</span>
</span><span id="__span-2-289"><a id="__codelineno-2-289" name="__codelineno-2-289"></a><span class="w">      </span><span class="no">- name: scanner-user</span>
</span><span id="__span-2-290"><a id="__codelineno-2-290" name="__codelineno-2-290"></a><span class="w">        </span><span class="no">user:</span>
</span><span id="__span-2-291"><a id="__codelineno-2-291" name="__codelineno-2-291"></a><span class="w">          </span><span class="no">token: ${SCANNER_TOKEN}</span>
</span><span id="__span-2-292"><a id="__codelineno-2-292" name="__codelineno-2-292"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-2-293"><a id="__codelineno-2-293" name="__codelineno-2-293"></a><span class="w">      </span><span class="no">chmod 600 scanner-kubeconfig.yaml</span>
</span><span id="__span-2-294"><a id="__codelineno-2-294" name="__codelineno-2-294"></a>
</span><span id="__span-2-295"><a id="__codelineno-2-295" name="__codelineno-2-295"></a><span class="w">    </span><span class="c1"># Check what we CAN do</span>
</span><span id="__span-2-296"><a id="__codelineno-2-296" name="__codelineno-2-296"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-297"><a id="__codelineno-2-297" name="__codelineno-2-297"></a><span class="w">      </span><span class="no">echo &quot;Verifying what we CAN do with restricted RBAC:&quot;</span>
</span><span id="__span-2-298"><a id="__codelineno-2-298" name="__codelineno-2-298"></a><span class="w">      </span><span class="no">echo &quot;Can list pods:&quot;</span>
</span><span id="__span-2-299"><a id="__codelineno-2-299" name="__codelineno-2-299"></a><span class="w">      </span><span class="no">KUBECONFIG=scanner-kubeconfig.yaml kubectl get pods -n ${SCAN_NAMESPACE} &gt; /dev/null &amp;&amp; </span>
</span><span id="__span-2-300"><a id="__codelineno-2-300" name="__codelineno-2-300"></a><span class="w">        </span><span class="no">echo &quot; Can list pods&quot; || </span>
</span><span id="__span-2-301"><a id="__codelineno-2-301" name="__codelineno-2-301"></a><span class="w">        </span><span class="no">echo &quot; Cannot list pods&quot;</span>
</span><span id="__span-2-302"><a id="__codelineno-2-302" name="__codelineno-2-302"></a>
</span><span id="__span-2-303"><a id="__codelineno-2-303" name="__codelineno-2-303"></a><span class="w">      </span><span class="no">echo &quot;Can exec into target pod:&quot;</span>
</span><span id="__span-2-304"><a id="__codelineno-2-304" name="__codelineno-2-304"></a><span class="w">      </span><span class="no">KUBECONFIG=scanner-kubeconfig.yaml kubectl auth can-i create pods/exec --subresource=exec -n ${SCAN_NAMESPACE} --resource-name=${PRIMARY_POD} &amp;&amp;</span>
</span><span id="__span-2-305"><a id="__codelineno-2-305" name="__codelineno-2-305"></a><span class="w">        </span><span class="no">echo &quot; Can exec into target pod&quot; || </span>
</span><span id="__span-2-306"><a id="__codelineno-2-306" name="__codelineno-2-306"></a><span class="w">        </span><span class="no">echo &quot; Cannot exec into target pod&quot;</span>
</span><span id="__span-2-307"><a id="__codelineno-2-307" name="__codelineno-2-307"></a>
</span><span id="__span-2-308"><a id="__codelineno-2-308" name="__codelineno-2-308"></a><span class="w">    </span><span class="c1"># Check what we CANNOT do</span>
</span><span id="__span-2-309"><a id="__codelineno-2-309" name="__codelineno-2-309"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-310"><a id="__codelineno-2-310" name="__codelineno-2-310"></a><span class="w">      </span><span class="no">echo &quot;Verifying what we CANNOT do with restricted RBAC:&quot;</span>
</span><span id="__span-2-311"><a id="__codelineno-2-311" name="__codelineno-2-311"></a>
</span><span id="__span-2-312"><a id="__codelineno-2-312" name="__codelineno-2-312"></a><span class="w">      </span><span class="no">echo &quot;Cannot create pods:&quot;</span>
</span><span id="__span-2-313"><a id="__codelineno-2-313" name="__codelineno-2-313"></a><span class="w">      </span><span class="no">KUBECONFIG=scanner-kubeconfig.yaml kubectl auth can-i create pods -n ${SCAN_NAMESPACE} &amp;&amp; </span>
</span><span id="__span-2-314"><a id="__codelineno-2-314" name="__codelineno-2-314"></a><span class="w">        </span><span class="no">echo &quot; Security issue: Can create pods&quot; || </span>
</span><span id="__span-2-315"><a id="__codelineno-2-315" name="__codelineno-2-315"></a><span class="w">        </span><span class="no">echo &quot; Cannot create pods (expected)&quot;</span>
</span><span id="__span-2-316"><a id="__codelineno-2-316" name="__codelineno-2-316"></a>
</span><span id="__span-2-317"><a id="__codelineno-2-317" name="__codelineno-2-317"></a><span class="w">      </span><span class="no">echo &quot;Cannot delete pods:&quot;</span>
</span><span id="__span-2-318"><a id="__codelineno-2-318" name="__codelineno-2-318"></a><span class="w">      </span><span class="no">KUBECONFIG=scanner-kubeconfig.yaml kubectl auth can-i delete pods -n ${SCAN_NAMESPACE} &amp;&amp; </span>
</span><span id="__span-2-319"><a id="__codelineno-2-319" name="__codelineno-2-319"></a><span class="w">        </span><span class="no">echo &quot; Security issue: Can delete pods&quot; || </span>
</span><span id="__span-2-320"><a id="__codelineno-2-320" name="__codelineno-2-320"></a><span class="w">        </span><span class="no">echo &quot; Cannot delete pods (expected)&quot;</span>
</span><span id="__span-2-321"><a id="__codelineno-2-321" name="__codelineno-2-321"></a>
</span><span id="__span-2-322"><a id="__codelineno-2-322" name="__codelineno-2-322"></a><span class="w">      </span><span class="no"># Find non-target pod for testing</span>
</span><span id="__span-2-323"><a id="__codelineno-2-323" name="__codelineno-2-323"></a><span class="w">      </span><span class="no">OTHER_POD=$(kubectl get pods -n ${SCAN_NAMESPACE} -l app!=scan-target -o jsonpath=&#39;{.items[0].metadata.name}&#39; 2&gt;/dev/null || echo &quot;&quot;)</span>
</span><span id="__span-2-324"><a id="__codelineno-2-324" name="__codelineno-2-324"></a><span class="w">      </span><span class="no">if [ -n &quot;$OTHER_POD&quot; ] &amp;&amp; [ &quot;$OTHER_POD&quot; != &quot;$PRIMARY_POD&quot; ]; then</span>
</span><span id="__span-2-325"><a id="__codelineno-2-325" name="__codelineno-2-325"></a><span class="w">        </span><span class="no">echo &quot;Cannot exec into non-target pod:&quot;</span>
</span><span id="__span-2-326"><a id="__codelineno-2-326" name="__codelineno-2-326"></a><span class="w">        </span><span class="no">KUBECONFIG=scanner-kubeconfig.yaml kubectl auth can-i create pods/exec --subresource=exec -n ${SCAN_NAMESPACE} --resource-name=${OTHER_POD} &amp;&amp; </span>
</span><span id="__span-2-327"><a id="__codelineno-2-327" name="__codelineno-2-327"></a><span class="w">          </span><span class="no">echo &quot; Security issue: Can exec into non-target pod&quot; || </span>
</span><span id="__span-2-328"><a id="__codelineno-2-328" name="__codelineno-2-328"></a><span class="w">          </span><span class="no">echo &quot; Cannot exec into non-target pod (expected)&quot;</span>
</span><span id="__span-2-329"><a id="__codelineno-2-329" name="__codelineno-2-329"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-2-330"><a id="__codelineno-2-330" name="__codelineno-2-330"></a>
</span><span id="__span-2-331"><a id="__codelineno-2-331" name="__codelineno-2-331"></a><span class="w">    </span><span class="c1"># Create security report</span>
</span><span id="__span-2-332"><a id="__codelineno-2-332" name="__codelineno-2-332"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-2-333"><a id="__codelineno-2-333" name="__codelineno-2-333"></a><span class="w">      </span><span class="no">cat &gt; security-report.md &lt;&lt; EOF</span>
</span><span id="__span-2-334"><a id="__codelineno-2-334" name="__codelineno-2-334"></a><span class="w">      </span><span class="no"># Container Security Scan Report</span>
</span><span id="__span-2-335"><a id="__codelineno-2-335" name="__codelineno-2-335"></a>
</span><span id="__span-2-336"><a id="__codelineno-2-336" name="__codelineno-2-336"></a><span class="w">      </span><span class="no">## Scan Details</span>
</span><span id="__span-2-337"><a id="__codelineno-2-337" name="__codelineno-2-337"></a>
</span><span id="__span-2-338"><a id="__codelineno-2-338" name="__codelineno-2-338"></a><span class="w">      </span><span class="no">- **Pipeline:** ${CI_PIPELINE_ID}</span>
</span><span id="__span-2-339"><a id="__codelineno-2-339" name="__codelineno-2-339"></a><span class="w">      </span><span class="no">- **Target Namespace:** ${SCAN_NAMESPACE}</span>
</span><span id="__span-2-340"><a id="__codelineno-2-340" name="__codelineno-2-340"></a><span class="w">      </span><span class="no">- **Target Pod:** ${PRIMARY_POD}</span>
</span><span id="__span-2-341"><a id="__codelineno-2-341" name="__codelineno-2-341"></a><span class="w">      </span><span class="no">- **Target Container:** ${PRIMARY_CONTAINER}</span>
</span><span id="__span-2-342"><a id="__codelineno-2-342" name="__codelineno-2-342"></a><span class="w">      </span><span class="no">- **CINC Profile:** ${PROFILE}</span>
</span><span id="__span-2-343"><a id="__codelineno-2-343" name="__codelineno-2-343"></a><span class="w">      </span><span class="no">- **Compliance Threshold:** ${THRESHOLD_VALUE}%</span>
</span><span id="__span-2-344"><a id="__codelineno-2-344" name="__codelineno-2-344"></a>
</span><span id="__span-2-345"><a id="__codelineno-2-345" name="__codelineno-2-345"></a><span class="w">      </span><span class="no">## RBAC Security Verification</span>
</span><span id="__span-2-346"><a id="__codelineno-2-346" name="__codelineno-2-346"></a>
</span><span id="__span-2-347"><a id="__codelineno-2-347" name="__codelineno-2-347"></a><span class="w">      </span><span class="no">The scanner service account has properly restricted access:</span>
</span><span id="__span-2-348"><a id="__codelineno-2-348" name="__codelineno-2-348"></a><span class="w">      </span><span class="no">-  Can list pods in the namespace</span>
</span><span id="__span-2-349"><a id="__codelineno-2-349" name="__codelineno-2-349"></a><span class="w">      </span><span class="no">-  Can exec into target pods for scanning</span>
</span><span id="__span-2-350"><a id="__codelineno-2-350" name="__codelineno-2-350"></a><span class="w">      </span><span class="no">-  Cannot create or delete pods</span>
</span><span id="__span-2-351"><a id="__codelineno-2-351" name="__codelineno-2-351"></a><span class="w">      </span><span class="no">-  Cannot exec into non-target pods</span>
</span><span id="__span-2-352"><a id="__codelineno-2-352" name="__codelineno-2-352"></a><span class="w">      </span><span class="no">-  Cannot access cluster-wide resources</span>
</span><span id="__span-2-353"><a id="__codelineno-2-353" name="__codelineno-2-353"></a>
</span><span id="__span-2-354"><a id="__codelineno-2-354" name="__codelineno-2-354"></a><span class="w">      </span><span class="no">## Scan Results</span>
</span><span id="__span-2-355"><a id="__codelineno-2-355" name="__codelineno-2-355"></a>
</span><span id="__span-2-356"><a id="__codelineno-2-356" name="__codelineno-2-356"></a><span class="w">      </span><span class="no">$([[ &quot;${THRESHOLD_RESULT}&quot; -eq 0 ]] &amp;&amp; echo &quot; **PASSED**&quot; || echo &quot; **FAILED**&quot;)</span>
</span><span id="__span-2-357"><a id="__codelineno-2-357" name="__codelineno-2-357"></a>
</span><span id="__span-2-358"><a id="__codelineno-2-358" name="__codelineno-2-358"></a><span class="w">      </span><span class="no">See scan artifacts for detailed compliance results.</span>
</span><span id="__span-2-359"><a id="__codelineno-2-359" name="__codelineno-2-359"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-2-360"><a id="__codelineno-2-360" name="__codelineno-2-360"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-2-361"><a id="__codelineno-2-361" name="__codelineno-2-361"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-2-362"><a id="__codelineno-2-362" name="__codelineno-2-362"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security-report.md</span>
</span><span id="__span-2-363"><a id="__codelineno-2-363" name="__codelineno-2-363"></a>
</span><span id="__span-2-364"><a id="__codelineno-2-364" name="__codelineno-2-364"></a><span class="c1"># Always clean up RBAC resources</span>
</span><span id="__span-2-365"><a id="__codelineno-2-365" name="__codelineno-2-365"></a><span class="nt">cleanup_rbac</span><span class="p">:</span>
</span><span id="__span-2-366"><a id="__codelineno-2-366" name="__codelineno-2-366"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-2-367"><a id="__codelineno-2-367" name="__codelineno-2-367"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/kubectl:latest</span>
</span><span id="__span-2-368"><a id="__codelineno-2-368" name="__codelineno-2-368"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">prepare_scan</span><span class="p p-Indicator">]</span>
</span><span id="__span-2-369"><a id="__codelineno-2-369" name="__codelineno-2-369"></a><span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
</span><span id="__span-2-370"><a id="__codelineno-2-370" name="__codelineno-2-370"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-2-371"><a id="__codelineno-2-371" name="__codelineno-2-371"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-2-372"><a id="__codelineno-2-372" name="__codelineno-2-372"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-2-373"><a id="__codelineno-2-373" name="__codelineno-2-373"></a>
</span><span id="__span-2-374"><a id="__codelineno-2-374" name="__codelineno-2-374"></a><span class="w">    </span><span class="c1"># Delete role binding</span>
</span><span id="__span-2-375"><a id="__codelineno-2-375" name="__codelineno-2-375"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl delete rolebinding scanner-binding-${RUN_ID} -n ${SCAN_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-2-376"><a id="__codelineno-2-376" name="__codelineno-2-376"></a>
</span><span id="__span-2-377"><a id="__codelineno-2-377" name="__codelineno-2-377"></a><span class="w">    </span><span class="c1"># Delete role</span>
</span><span id="__span-2-378"><a id="__codelineno-2-378" name="__codelineno-2-378"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl delete role scanner-role-${RUN_ID} -n ${SCAN_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-2-379"><a id="__codelineno-2-379" name="__codelineno-2-379"></a>
</span><span id="__span-2-380"><a id="__codelineno-2-380" name="__codelineno-2-380"></a><span class="w">    </span><span class="c1"># Delete service account</span>
</span><span id="__span-2-381"><a id="__codelineno-2-381" name="__codelineno-2-381"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl delete serviceaccount scanner-${RUN_ID} -n ${SCAN_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-2-382"><a id="__codelineno-2-382" name="__codelineno-2-382"></a>
</span><span id="__span-2-383"><a id="__codelineno-2-383" name="__codelineno-2-383"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;RBAC resources cleaned up&quot;</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="gitlab-ci-with-services-pipeline">GitLab CI with Services Pipeline<a class="headerlink" href="#gitlab-ci-with-services-pipeline" title="Permanent link">&para;</a></h2>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">  1</a></span>
<span class="normal"><a href="#__codelineno-3-2">  2</a></span>
<span class="normal"><a href="#__codelineno-3-3">  3</a></span>
<span class="normal"><a href="#__codelineno-3-4">  4</a></span>
<span class="normal"><a href="#__codelineno-3-5">  5</a></span>
<span class="normal"><a href="#__codelineno-3-6">  6</a></span>
<span class="normal"><a href="#__codelineno-3-7">  7</a></span>
<span class="normal"><a href="#__codelineno-3-8">  8</a></span>
<span class="normal"><a href="#__codelineno-3-9">  9</a></span>
<span class="normal"><a href="#__codelineno-3-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-3-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-3-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-3-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-3-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-3-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-3-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-3-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-3-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-3-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-3-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-3-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-3-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-3-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-3-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-3-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-3-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-3-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-3-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-3-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-3-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-3-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-3-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-3-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-3-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-3-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-3-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-3-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-3-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-3-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-3-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-3-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-3-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-3-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-3-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-3-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-3-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-3-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-3-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-3-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-3-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-3-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-3-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-3-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-3-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-3-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-3-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-3-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-3-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-3-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-3-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-3-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-3-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-3-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-3-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-3-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-3-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-3-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-3-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-3-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-3-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-3-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-3-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-3-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-3-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-3-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-3-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-3-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-3-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-3-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-3-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-3-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-3-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-3-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-3-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-3-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-3-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-3-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-3-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-3-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-3-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-3-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-3-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-3-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-3-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-3-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-3-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-3-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-3-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-3-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-3-100">100</a></span>
<span class="normal"><a href="#__codelineno-3-101">101</a></span>
<span class="normal"><a href="#__codelineno-3-102">102</a></span>
<span class="normal"><a href="#__codelineno-3-103">103</a></span>
<span class="normal"><a href="#__codelineno-3-104">104</a></span>
<span class="normal"><a href="#__codelineno-3-105">105</a></span>
<span class="normal"><a href="#__codelineno-3-106">106</a></span>
<span class="normal"><a href="#__codelineno-3-107">107</a></span>
<span class="normal"><a href="#__codelineno-3-108">108</a></span>
<span class="normal"><a href="#__codelineno-3-109">109</a></span>
<span class="normal"><a href="#__codelineno-3-110">110</a></span>
<span class="normal"><a href="#__codelineno-3-111">111</a></span>
<span class="normal"><a href="#__codelineno-3-112">112</a></span>
<span class="normal"><a href="#__codelineno-3-113">113</a></span>
<span class="normal"><a href="#__codelineno-3-114">114</a></span>
<span class="normal"><a href="#__codelineno-3-115">115</a></span>
<span class="normal"><a href="#__codelineno-3-116">116</a></span>
<span class="normal"><a href="#__codelineno-3-117">117</a></span>
<span class="normal"><a href="#__codelineno-3-118">118</a></span>
<span class="normal"><a href="#__codelineno-3-119">119</a></span>
<span class="normal"><a href="#__codelineno-3-120">120</a></span>
<span class="normal"><a href="#__codelineno-3-121">121</a></span>
<span class="normal"><a href="#__codelineno-3-122">122</a></span>
<span class="normal"><a href="#__codelineno-3-123">123</a></span>
<span class="normal"><a href="#__codelineno-3-124">124</a></span>
<span class="normal"><a href="#__codelineno-3-125">125</a></span>
<span class="normal"><a href="#__codelineno-3-126">126</a></span>
<span class="normal"><a href="#__codelineno-3-127">127</a></span>
<span class="normal"><a href="#__codelineno-3-128">128</a></span>
<span class="normal"><a href="#__codelineno-3-129">129</a></span>
<span class="normal"><a href="#__codelineno-3-130">130</a></span>
<span class="normal"><a href="#__codelineno-3-131">131</a></span>
<span class="normal"><a href="#__codelineno-3-132">132</a></span>
<span class="normal"><a href="#__codelineno-3-133">133</a></span>
<span class="normal"><a href="#__codelineno-3-134">134</a></span>
<span class="normal"><a href="#__codelineno-3-135">135</a></span>
<span class="normal"><a href="#__codelineno-3-136">136</a></span>
<span class="normal"><a href="#__codelineno-3-137">137</a></span>
<span class="normal"><a href="#__codelineno-3-138">138</a></span>
<span class="normal"><a href="#__codelineno-3-139">139</a></span>
<span class="normal"><a href="#__codelineno-3-140">140</a></span>
<span class="normal"><a href="#__codelineno-3-141">141</a></span>
<span class="normal"><a href="#__codelineno-3-142">142</a></span>
<span class="normal"><a href="#__codelineno-3-143">143</a></span>
<span class="normal"><a href="#__codelineno-3-144">144</a></span>
<span class="normal"><a href="#__codelineno-3-145">145</a></span>
<span class="normal"><a href="#__codelineno-3-146">146</a></span>
<span class="normal"><a href="#__codelineno-3-147">147</a></span>
<span class="normal"><a href="#__codelineno-3-148">148</a></span>
<span class="normal"><a href="#__codelineno-3-149">149</a></span>
<span class="normal"><a href="#__codelineno-3-150">150</a></span>
<span class="normal"><a href="#__codelineno-3-151">151</a></span>
<span class="normal"><a href="#__codelineno-3-152">152</a></span>
<span class="normal"><a href="#__codelineno-3-153">153</a></span>
<span class="normal"><a href="#__codelineno-3-154">154</a></span>
<span class="normal"><a href="#__codelineno-3-155">155</a></span>
<span class="normal"><a href="#__codelineno-3-156">156</a></span>
<span class="normal"><a href="#__codelineno-3-157">157</a></span>
<span class="normal"><a href="#__codelineno-3-158">158</a></span>
<span class="normal"><a href="#__codelineno-3-159">159</a></span>
<span class="normal"><a href="#__codelineno-3-160">160</a></span>
<span class="normal"><a href="#__codelineno-3-161">161</a></span>
<span class="normal"><a href="#__codelineno-3-162">162</a></span>
<span class="normal"><a href="#__codelineno-3-163">163</a></span>
<span class="normal"><a href="#__codelineno-3-164">164</a></span>
<span class="normal"><a href="#__codelineno-3-165">165</a></span>
<span class="normal"><a href="#__codelineno-3-166">166</a></span>
<span class="normal"><a href="#__codelineno-3-167">167</a></span>
<span class="normal"><a href="#__codelineno-3-168">168</a></span>
<span class="normal"><a href="#__codelineno-3-169">169</a></span>
<span class="normal"><a href="#__codelineno-3-170">170</a></span>
<span class="normal"><a href="#__codelineno-3-171">171</a></span>
<span class="normal"><a href="#__codelineno-3-172">172</a></span>
<span class="normal"><a href="#__codelineno-3-173">173</a></span>
<span class="normal"><a href="#__codelineno-3-174">174</a></span>
<span class="normal"><a href="#__codelineno-3-175">175</a></span>
<span class="normal"><a href="#__codelineno-3-176">176</a></span>
<span class="normal"><a href="#__codelineno-3-177">177</a></span>
<span class="normal"><a href="#__codelineno-3-178">178</a></span>
<span class="normal"><a href="#__codelineno-3-179">179</a></span>
<span class="normal"><a href="#__codelineno-3-180">180</a></span>
<span class="normal"><a href="#__codelineno-3-181">181</a></span>
<span class="normal"><a href="#__codelineno-3-182">182</a></span>
<span class="normal"><a href="#__codelineno-3-183">183</a></span>
<span class="normal"><a href="#__codelineno-3-184">184</a></span>
<span class="normal"><a href="#__codelineno-3-185">185</a></span>
<span class="normal"><a href="#__codelineno-3-186">186</a></span>
<span class="normal"><a href="#__codelineno-3-187">187</a></span>
<span class="normal"><a href="#__codelineno-3-188">188</a></span>
<span class="normal"><a href="#__codelineno-3-189">189</a></span>
<span class="normal"><a href="#__codelineno-3-190">190</a></span>
<span class="normal"><a href="#__codelineno-3-191">191</a></span>
<span class="normal"><a href="#__codelineno-3-192">192</a></span>
<span class="normal"><a href="#__codelineno-3-193">193</a></span>
<span class="normal"><a href="#__codelineno-3-194">194</a></span>
<span class="normal"><a href="#__codelineno-3-195">195</a></span>
<span class="normal"><a href="#__codelineno-3-196">196</a></span>
<span class="normal"><a href="#__codelineno-3-197">197</a></span>
<span class="normal"><a href="#__codelineno-3-198">198</a></span>
<span class="normal"><a href="#__codelineno-3-199">199</a></span>
<span class="normal"><a href="#__codelineno-3-200">200</a></span>
<span class="normal"><a href="#__codelineno-3-201">201</a></span>
<span class="normal"><a href="#__codelineno-3-202">202</a></span>
<span class="normal"><a href="#__codelineno-3-203">203</a></span>
<span class="normal"><a href="#__codelineno-3-204">204</a></span>
<span class="normal"><a href="#__codelineno-3-205">205</a></span>
<span class="normal"><a href="#__codelineno-3-206">206</a></span>
<span class="normal"><a href="#__codelineno-3-207">207</a></span>
<span class="normal"><a href="#__codelineno-3-208">208</a></span>
<span class="normal"><a href="#__codelineno-3-209">209</a></span>
<span class="normal"><a href="#__codelineno-3-210">210</a></span>
<span class="normal"><a href="#__codelineno-3-211">211</a></span>
<span class="normal"><a href="#__codelineno-3-212">212</a></span>
<span class="normal"><a href="#__codelineno-3-213">213</a></span>
<span class="normal"><a href="#__codelineno-3-214">214</a></span>
<span class="normal"><a href="#__codelineno-3-215">215</a></span>
<span class="normal"><a href="#__codelineno-3-216">216</a></span>
<span class="normal"><a href="#__codelineno-3-217">217</a></span>
<span class="normal"><a href="#__codelineno-3-218">218</a></span>
<span class="normal"><a href="#__codelineno-3-219">219</a></span>
<span class="normal"><a href="#__codelineno-3-220">220</a></span>
<span class="normal"><a href="#__codelineno-3-221">221</a></span>
<span class="normal"><a href="#__codelineno-3-222">222</a></span>
<span class="normal"><a href="#__codelineno-3-223">223</a></span>
<span class="normal"><a href="#__codelineno-3-224">224</a></span>
<span class="normal"><a href="#__codelineno-3-225">225</a></span>
<span class="normal"><a href="#__codelineno-3-226">226</a></span>
<span class="normal"><a href="#__codelineno-3-227">227</a></span>
<span class="normal"><a href="#__codelineno-3-228">228</a></span>
<span class="normal"><a href="#__codelineno-3-229">229</a></span>
<span class="normal"><a href="#__codelineno-3-230">230</a></span>
<span class="normal"><a href="#__codelineno-3-231">231</a></span>
<span class="normal"><a href="#__codelineno-3-232">232</a></span>
<span class="normal"><a href="#__codelineno-3-233">233</a></span>
<span class="normal"><a href="#__codelineno-3-234">234</a></span>
<span class="normal"><a href="#__codelineno-3-235">235</a></span>
<span class="normal"><a href="#__codelineno-3-236">236</a></span>
<span class="normal"><a href="#__codelineno-3-237">237</a></span>
<span class="normal"><a href="#__codelineno-3-238">238</a></span>
<span class="normal"><a href="#__codelineno-3-239">239</a></span>
<span class="normal"><a href="#__codelineno-3-240">240</a></span>
<span class="normal"><a href="#__codelineno-3-241">241</a></span>
<span class="normal"><a href="#__codelineno-3-242">242</a></span>
<span class="normal"><a href="#__codelineno-3-243">243</a></span>
<span class="normal"><a href="#__codelineno-3-244">244</a></span>
<span class="normal"><a href="#__codelineno-3-245">245</a></span>
<span class="normal"><a href="#__codelineno-3-246">246</a></span>
<span class="normal"><a href="#__codelineno-3-247">247</a></span>
<span class="normal"><a href="#__codelineno-3-248">248</a></span>
<span class="normal"><a href="#__codelineno-3-249">249</a></span>
<span class="normal"><a href="#__codelineno-3-250">250</a></span>
<span class="normal"><a href="#__codelineno-3-251">251</a></span>
<span class="normal"><a href="#__codelineno-3-252">252</a></span>
<span class="normal"><a href="#__codelineno-3-253">253</a></span>
<span class="normal"><a href="#__codelineno-3-254">254</a></span>
<span class="normal"><a href="#__codelineno-3-255">255</a></span>
<span class="normal"><a href="#__codelineno-3-256">256</a></span>
<span class="normal"><a href="#__codelineno-3-257">257</a></span>
<span class="normal"><a href="#__codelineno-3-258">258</a></span>
<span class="normal"><a href="#__codelineno-3-259">259</a></span>
<span class="normal"><a href="#__codelineno-3-260">260</a></span>
<span class="normal"><a href="#__codelineno-3-261">261</a></span>
<span class="normal"><a href="#__codelineno-3-262">262</a></span>
<span class="normal"><a href="#__codelineno-3-263">263</a></span>
<span class="normal"><a href="#__codelineno-3-264">264</a></span>
<span class="normal"><a href="#__codelineno-3-265">265</a></span>
<span class="normal"><a href="#__codelineno-3-266">266</a></span>
<span class="normal"><a href="#__codelineno-3-267">267</a></span>
<span class="normal"><a href="#__codelineno-3-268">268</a></span>
<span class="normal"><a href="#__codelineno-3-269">269</a></span>
<span class="normal"><a href="#__codelineno-3-270">270</a></span>
<span class="normal"><a href="#__codelineno-3-271">271</a></span>
<span class="normal"><a href="#__codelineno-3-272">272</a></span>
<span class="normal"><a href="#__codelineno-3-273">273</a></span>
<span class="normal"><a href="#__codelineno-3-274">274</a></span>
<span class="normal"><a href="#__codelineno-3-275">275</a></span>
<span class="normal"><a href="#__codelineno-3-276">276</a></span>
<span class="normal"><a href="#__codelineno-3-277">277</a></span>
<span class="normal"><a href="#__codelineno-3-278">278</a></span>
<span class="normal"><a href="#__codelineno-3-279">279</a></span>
<span class="normal"><a href="#__codelineno-3-280">280</a></span>
<span class="normal"><a href="#__codelineno-3-281">281</a></span>
<span class="normal"><a href="#__codelineno-3-282">282</a></span>
<span class="normal"><a href="#__codelineno-3-283">283</a></span>
<span class="normal"><a href="#__codelineno-3-284">284</a></span>
<span class="normal"><a href="#__codelineno-3-285">285</a></span>
<span class="normal"><a href="#__codelineno-3-286">286</a></span>
<span class="normal"><a href="#__codelineno-3-287">287</a></span>
<span class="normal"><a href="#__codelineno-3-288">288</a></span>
<span class="normal"><a href="#__codelineno-3-289">289</a></span>
<span class="normal"><a href="#__codelineno-3-290">290</a></span>
<span class="normal"><a href="#__codelineno-3-291">291</a></span>
<span class="normal"><a href="#__codelineno-3-292">292</a></span>
<span class="normal"><a href="#__codelineno-3-293">293</a></span>
<span class="normal"><a href="#__codelineno-3-294">294</a></span>
<span class="normal"><a href="#__codelineno-3-295">295</a></span>
<span class="normal"><a href="#__codelineno-3-296">296</a></span>
<span class="normal"><a href="#__codelineno-3-297">297</a></span>
<span class="normal"><a href="#__codelineno-3-298">298</a></span>
<span class="normal"><a href="#__codelineno-3-299">299</a></span>
<span class="normal"><a href="#__codelineno-3-300">300</a></span>
<span class="normal"><a href="#__codelineno-3-301">301</a></span>
<span class="normal"><a href="#__codelineno-3-302">302</a></span>
<span class="normal"><a href="#__codelineno-3-303">303</a></span>
<span class="normal"><a href="#__codelineno-3-304">304</a></span>
<span class="normal"><a href="#__codelineno-3-305">305</a></span>
<span class="normal"><a href="#__codelineno-3-306">306</a></span>
<span class="normal"><a href="#__codelineno-3-307">307</a></span>
<span class="normal"><a href="#__codelineno-3-308">308</a></span>
<span class="normal"><a href="#__codelineno-3-309">309</a></span>
<span class="normal"><a href="#__codelineno-3-310">310</a></span>
<span class="normal"><a href="#__codelineno-3-311">311</a></span>
<span class="normal"><a href="#__codelineno-3-312">312</a></span>
<span class="normal"><a href="#__codelineno-3-313">313</a></span>
<span class="normal"><a href="#__codelineno-3-314">314</a></span>
<span class="normal"><a href="#__codelineno-3-315">315</a></span>
<span class="normal"><a href="#__codelineno-3-316">316</a></span>
<span class="normal"><a href="#__codelineno-3-317">317</a></span>
<span class="normal"><a href="#__codelineno-3-318">318</a></span>
<span class="normal"><a href="#__codelineno-3-319">319</a></span>
<span class="normal"><a href="#__codelineno-3-320">320</a></span>
<span class="normal"><a href="#__codelineno-3-321">321</a></span>
<span class="normal"><a href="#__codelineno-3-322">322</a></span>
<span class="normal"><a href="#__codelineno-3-323">323</a></span>
<span class="normal"><a href="#__codelineno-3-324">324</a></span>
<span class="normal"><a href="#__codelineno-3-325">325</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nt">stages</span><span class="p">:</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">report</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">  </span><span class="nt">SCANNER_NAMESPACE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;inspec-test&quot;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">  </span><span class="nt">TARGET_LABEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app=target-app&quot;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">  </span><span class="nt">THRESHOLD_VALUE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;70&quot;</span><span class="w">  </span><span class="c1"># Minimum passing score (0-100)</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="c1"># Define a custom service image for CINC Auditor</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.example.com/cinc-auditor-scanner:latest</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">    </span><span class="nt">alias</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cinc-scanner</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="w">    </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;infinity&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="nt">deploy_container</span><span class="p">:</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="w">      </span><span class="no">kind: Pod</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="w">        </span><span class="no">name: scan-target-${CI_PIPELINE_ID}</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="w">        </span><span class="no">labels:</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="w">          </span><span class="no">app: target-app</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="w">          </span><span class="no">pipeline: &quot;${CI_PIPELINE_ID}&quot;</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33"></a><span class="w">      </span><span class="no">spec:</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="w">        </span><span class="no">containers:</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="w">        </span><span class="no">- name: target</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36"></a><span class="w">          </span><span class="no">image: registry.example.com/my-image:latest</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="w">          </span><span class="no">command: [&quot;sleep&quot;, &quot;1h&quot;]</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="w">      </span><span class="no"># Wait for pod to be ready</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41"></a><span class="w">      </span><span class="no">kubectl wait --for=condition=ready pod/scan-target-${CI_PIPELINE_ID} \</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="w">        </span><span class="no">-n ${SCANNER_NAMESPACE} --timeout=120s</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44"></a><span class="w">      </span><span class="no"># Save target info for later stages</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45"></a><span class="w">      </span><span class="no">echo &quot;TARGET_POD=scan-target-${CI_PIPELINE_ID}&quot; &gt;&gt; deploy.env</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46"></a><span class="w">      </span><span class="no">echo &quot;TARGET_CONTAINER=target&quot; &gt;&gt; deploy.env</span>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy.env</span>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50"></a>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51"></a><span class="nt">create_access</span><span class="p">:</span>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">deploy_container</span><span class="p p-Indicator">]</span>
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-3-55"><a id="__codelineno-3-55" name="__codelineno-3-55"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-3-56"><a id="__codelineno-3-56" name="__codelineno-3-56"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-3-57"><a id="__codelineno-3-57" name="__codelineno-3-57"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-58"><a id="__codelineno-3-58" name="__codelineno-3-58"></a><span class="w">      </span><span class="no"># Create the role for this specific pod</span>
</span><span id="__span-3-59"><a id="__codelineno-3-59" name="__codelineno-3-59"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-3-60"><a id="__codelineno-3-60" name="__codelineno-3-60"></a><span class="w">      </span><span class="no">apiVersion: rbac.authorization.k8s.io/v1</span>
</span><span id="__span-3-61"><a id="__codelineno-3-61" name="__codelineno-3-61"></a><span class="w">      </span><span class="no">kind: Role</span>
</span><span id="__span-3-62"><a id="__codelineno-3-62" name="__codelineno-3-62"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-3-63"><a id="__codelineno-3-63" name="__codelineno-3-63"></a><span class="w">        </span><span class="no">name: scanner-role-${CI_PIPELINE_ID}</span>
</span><span id="__span-3-64"><a id="__codelineno-3-64" name="__codelineno-3-64"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-3-65"><a id="__codelineno-3-65" name="__codelineno-3-65"></a><span class="w">      </span><span class="no">rules:</span>
</span><span id="__span-3-66"><a id="__codelineno-3-66" name="__codelineno-3-66"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-3-67"><a id="__codelineno-3-67" name="__codelineno-3-67"></a><span class="w">        </span><span class="no">resources: [&quot;pods&quot;]</span>
</span><span id="__span-3-68"><a id="__codelineno-3-68" name="__codelineno-3-68"></a><span class="w">        </span><span class="no">verbs: [&quot;get&quot;, &quot;list&quot;]</span>
</span><span id="__span-3-69"><a id="__codelineno-3-69" name="__codelineno-3-69"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-3-70"><a id="__codelineno-3-70" name="__codelineno-3-70"></a><span class="w">        </span><span class="no">resources: [&quot;pods/exec&quot;]</span>
</span><span id="__span-3-71"><a id="__codelineno-3-71" name="__codelineno-3-71"></a><span class="w">        </span><span class="no">verbs: [&quot;create&quot;]</span>
</span><span id="__span-3-72"><a id="__codelineno-3-72" name="__codelineno-3-72"></a><span class="w">        </span><span class="no">resourceNames: [&quot;${TARGET_POD}&quot;]</span>
</span><span id="__span-3-73"><a id="__codelineno-3-73" name="__codelineno-3-73"></a><span class="w">      </span><span class="no">- apiGroups: [&quot;&quot;]</span>
</span><span id="__span-3-74"><a id="__codelineno-3-74" name="__codelineno-3-74"></a><span class="w">        </span><span class="no">resources: [&quot;pods/log&quot;]</span>
</span><span id="__span-3-75"><a id="__codelineno-3-75" name="__codelineno-3-75"></a><span class="w">        </span><span class="no">verbs: [&quot;get&quot;]</span>
</span><span id="__span-3-76"><a id="__codelineno-3-76" name="__codelineno-3-76"></a><span class="w">        </span><span class="no">resourceNames: [&quot;${TARGET_POD}&quot;]</span>
</span><span id="__span-3-77"><a id="__codelineno-3-77" name="__codelineno-3-77"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-3-78"><a id="__codelineno-3-78" name="__codelineno-3-78"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-79"><a id="__codelineno-3-79" name="__codelineno-3-79"></a><span class="w">      </span><span class="no"># Create service account</span>
</span><span id="__span-3-80"><a id="__codelineno-3-80" name="__codelineno-3-80"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-3-81"><a id="__codelineno-3-81" name="__codelineno-3-81"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-3-82"><a id="__codelineno-3-82" name="__codelineno-3-82"></a><span class="w">      </span><span class="no">kind: ServiceAccount</span>
</span><span id="__span-3-83"><a id="__codelineno-3-83" name="__codelineno-3-83"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-3-84"><a id="__codelineno-3-84" name="__codelineno-3-84"></a><span class="w">        </span><span class="no">name: scanner-sa-${CI_PIPELINE_ID}</span>
</span><span id="__span-3-85"><a id="__codelineno-3-85" name="__codelineno-3-85"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-3-86"><a id="__codelineno-3-86" name="__codelineno-3-86"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-3-87"><a id="__codelineno-3-87" name="__codelineno-3-87"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-88"><a id="__codelineno-3-88" name="__codelineno-3-88"></a><span class="w">      </span><span class="no"># Create role binding</span>
</span><span id="__span-3-89"><a id="__codelineno-3-89" name="__codelineno-3-89"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-3-90"><a id="__codelineno-3-90" name="__codelineno-3-90"></a><span class="w">      </span><span class="no">apiVersion: rbac.authorization.k8s.io/v1</span>
</span><span id="__span-3-91"><a id="__codelineno-3-91" name="__codelineno-3-91"></a><span class="w">      </span><span class="no">kind: RoleBinding</span>
</span><span id="__span-3-92"><a id="__codelineno-3-92" name="__codelineno-3-92"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-3-93"><a id="__codelineno-3-93" name="__codelineno-3-93"></a><span class="w">        </span><span class="no">name: scanner-binding-${CI_PIPELINE_ID}</span>
</span><span id="__span-3-94"><a id="__codelineno-3-94" name="__codelineno-3-94"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-3-95"><a id="__codelineno-3-95" name="__codelineno-3-95"></a><span class="w">      </span><span class="no">subjects:</span>
</span><span id="__span-3-96"><a id="__codelineno-3-96" name="__codelineno-3-96"></a><span class="w">      </span><span class="no">- kind: ServiceAccount</span>
</span><span id="__span-3-97"><a id="__codelineno-3-97" name="__codelineno-3-97"></a><span class="w">        </span><span class="no">name: scanner-sa-${CI_PIPELINE_ID}</span>
</span><span id="__span-3-98"><a id="__codelineno-3-98" name="__codelineno-3-98"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-3-99"><a id="__codelineno-3-99" name="__codelineno-3-99"></a><span class="w">      </span><span class="no">roleRef:</span>
</span><span id="__span-3-100"><a id="__codelineno-3-100" name="__codelineno-3-100"></a><span class="w">        </span><span class="no">kind: Role</span>
</span><span id="__span-3-101"><a id="__codelineno-3-101" name="__codelineno-3-101"></a><span class="w">        </span><span class="no">name: scanner-role-${CI_PIPELINE_ID}</span>
</span><span id="__span-3-102"><a id="__codelineno-3-102" name="__codelineno-3-102"></a><span class="w">        </span><span class="no">apiGroup: rbac.authorization.k8s.io</span>
</span><span id="__span-3-103"><a id="__codelineno-3-103" name="__codelineno-3-103"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-3-104"><a id="__codelineno-3-104" name="__codelineno-3-104"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-105"><a id="__codelineno-3-105" name="__codelineno-3-105"></a><span class="w">      </span><span class="no"># Generate token</span>
</span><span id="__span-3-106"><a id="__codelineno-3-106" name="__codelineno-3-106"></a><span class="w">      </span><span class="no">TOKEN=$(kubectl create token scanner-sa-${CI_PIPELINE_ID} \</span>
</span><span id="__span-3-107"><a id="__codelineno-3-107" name="__codelineno-3-107"></a><span class="w">        </span><span class="no">-n ${SCANNER_NAMESPACE} --duration=30m)</span>
</span><span id="__span-3-108"><a id="__codelineno-3-108" name="__codelineno-3-108"></a><span class="w">      </span><span class="no">echo &quot;SCANNER_TOKEN=${TOKEN}&quot; &gt;&gt; scanner.env</span>
</span><span id="__span-3-109"><a id="__codelineno-3-109" name="__codelineno-3-109"></a>
</span><span id="__span-3-110"><a id="__codelineno-3-110" name="__codelineno-3-110"></a><span class="w">      </span><span class="no"># Save cluster info</span>
</span><span id="__span-3-111"><a id="__codelineno-3-111" name="__codelineno-3-111"></a><span class="w">      </span><span class="no">SERVER=$(kubectl config view --minify -o jsonpath=&#39;{.clusters[0].cluster.server}&#39;)</span>
</span><span id="__span-3-112"><a id="__codelineno-3-112" name="__codelineno-3-112"></a><span class="w">      </span><span class="no">CA_DATA=$(kubectl config view --raw --minify --flatten \</span>
</span><span id="__span-3-113"><a id="__codelineno-3-113" name="__codelineno-3-113"></a><span class="w">        </span><span class="no">-o jsonpath=&#39;{.clusters[].cluster.certificate-authority-data}&#39;)</span>
</span><span id="__span-3-114"><a id="__codelineno-3-114" name="__codelineno-3-114"></a><span class="w">      </span><span class="no">echo &quot;CLUSTER_SERVER=${SERVER}&quot; &gt;&gt; scanner.env</span>
</span><span id="__span-3-115"><a id="__codelineno-3-115" name="__codelineno-3-115"></a><span class="w">      </span><span class="no">echo &quot;CLUSTER_CA_DATA=${CA_DATA}&quot; &gt;&gt; scanner.env</span>
</span><span id="__span-3-116"><a id="__codelineno-3-116" name="__codelineno-3-116"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-3-117"><a id="__codelineno-3-117" name="__codelineno-3-117"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-3-118"><a id="__codelineno-3-118" name="__codelineno-3-118"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scanner.env</span>
</span><span id="__span-3-119"><a id="__codelineno-3-119" name="__codelineno-3-119"></a>
</span><span id="__span-3-120"><a id="__codelineno-3-120" name="__codelineno-3-120"></a><span class="nt">run_scan</span><span class="p">:</span>
</span><span id="__span-3-121"><a id="__codelineno-3-121" name="__codelineno-3-121"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-3-122"><a id="__codelineno-3-122" name="__codelineno-3-122"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">deploy_container</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">create_access</span><span class="p p-Indicator">]</span>
</span><span id="__span-3-123"><a id="__codelineno-3-123" name="__codelineno-3-123"></a><span class="w">  </span><span class="c1"># This job uses the cinc-scanner service container</span>
</span><span id="__span-3-124"><a id="__codelineno-3-124" name="__codelineno-3-124"></a><span class="w">  </span><span class="c1"># The service container already has CINC Auditor and the SAF CLI installed</span>
</span><span id="__span-3-125"><a id="__codelineno-3-125" name="__codelineno-3-125"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-3-126"><a id="__codelineno-3-126" name="__codelineno-3-126"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-127"><a id="__codelineno-3-127" name="__codelineno-3-127"></a><span class="w">      </span><span class="no"># Create a kubeconfig file</span>
</span><span id="__span-3-128"><a id="__codelineno-3-128" name="__codelineno-3-128"></a><span class="w">      </span><span class="no">cat &gt; scan-kubeconfig.yaml &lt;&lt; EOF</span>
</span><span id="__span-3-129"><a id="__codelineno-3-129" name="__codelineno-3-129"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-3-130"><a id="__codelineno-3-130" name="__codelineno-3-130"></a><span class="w">      </span><span class="no">kind: Config</span>
</span><span id="__span-3-131"><a id="__codelineno-3-131" name="__codelineno-3-131"></a><span class="w">      </span><span class="no">preferences: {}</span>
</span><span id="__span-3-132"><a id="__codelineno-3-132" name="__codelineno-3-132"></a><span class="w">      </span><span class="no">clusters:</span>
</span><span id="__span-3-133"><a id="__codelineno-3-133" name="__codelineno-3-133"></a><span class="w">      </span><span class="no">- cluster:</span>
</span><span id="__span-3-134"><a id="__codelineno-3-134" name="__codelineno-3-134"></a><span class="w">          </span><span class="no">server: ${CLUSTER_SERVER}</span>
</span><span id="__span-3-135"><a id="__codelineno-3-135" name="__codelineno-3-135"></a><span class="w">          </span><span class="no">certificate-authority-data: ${CLUSTER_CA_DATA}</span>
</span><span id="__span-3-136"><a id="__codelineno-3-136" name="__codelineno-3-136"></a><span class="w">        </span><span class="no">name: scanner-cluster</span>
</span><span id="__span-3-137"><a id="__codelineno-3-137" name="__codelineno-3-137"></a><span class="w">      </span><span class="no">contexts:</span>
</span><span id="__span-3-138"><a id="__codelineno-3-138" name="__codelineno-3-138"></a><span class="w">      </span><span class="no">- context:</span>
</span><span id="__span-3-139"><a id="__codelineno-3-139" name="__codelineno-3-139"></a><span class="w">          </span><span class="no">cluster: scanner-cluster</span>
</span><span id="__span-3-140"><a id="__codelineno-3-140" name="__codelineno-3-140"></a><span class="w">          </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-3-141"><a id="__codelineno-3-141" name="__codelineno-3-141"></a><span class="w">          </span><span class="no">user: scanner-user</span>
</span><span id="__span-3-142"><a id="__codelineno-3-142" name="__codelineno-3-142"></a><span class="w">        </span><span class="no">name: scanner-context</span>
</span><span id="__span-3-143"><a id="__codelineno-3-143" name="__codelineno-3-143"></a><span class="w">      </span><span class="no">current-context: scanner-context</span>
</span><span id="__span-3-144"><a id="__codelineno-3-144" name="__codelineno-3-144"></a><span class="w">      </span><span class="no">users:</span>
</span><span id="__span-3-145"><a id="__codelineno-3-145" name="__codelineno-3-145"></a><span class="w">      </span><span class="no">- name: scanner-user</span>
</span><span id="__span-3-146"><a id="__codelineno-3-146" name="__codelineno-3-146"></a><span class="w">        </span><span class="no">user:</span>
</span><span id="__span-3-147"><a id="__codelineno-3-147" name="__codelineno-3-147"></a><span class="w">          </span><span class="no">token: ${SCANNER_TOKEN}</span>
</span><span id="__span-3-148"><a id="__codelineno-3-148" name="__codelineno-3-148"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-3-149"><a id="__codelineno-3-149" name="__codelineno-3-149"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-150"><a id="__codelineno-3-150" name="__codelineno-3-150"></a><span class="w">      </span><span class="no"># Copy kubeconfig and profiles to service container</span>
</span><span id="__span-3-151"><a id="__codelineno-3-151" name="__codelineno-3-151"></a><span class="w">      </span><span class="no">docker cp scan-kubeconfig.yaml cinc-scanner:/tmp/</span>
</span><span id="__span-3-152"><a id="__codelineno-3-152" name="__codelineno-3-152"></a><span class="w">      </span><span class="no">docker cp ${CINC_PROFILE_PATH} cinc-scanner:/tmp/profile</span>
</span><span id="__span-3-153"><a id="__codelineno-3-153" name="__codelineno-3-153"></a>
</span><span id="__span-3-154"><a id="__codelineno-3-154" name="__codelineno-3-154"></a><span class="w">      </span><span class="no"># Run scan in service container</span>
</span><span id="__span-3-155"><a id="__codelineno-3-155" name="__codelineno-3-155"></a><span class="w">      </span><span class="no">docker exec cinc-scanner bash -c &quot;</span>
</span><span id="__span-3-156"><a id="__codelineno-3-156" name="__codelineno-3-156"></a><span class="w">        </span><span class="no">KUBECONFIG=/tmp/scan-kubeconfig.yaml \</span>
</span><span id="__span-3-157"><a id="__codelineno-3-157" name="__codelineno-3-157"></a><span class="w">        </span><span class="no">cinc-auditor exec /tmp/profile \</span>
</span><span id="__span-3-158"><a id="__codelineno-3-158" name="__codelineno-3-158"></a><span class="w">        </span><span class="no">-t k8s-container://${SCANNER_NAMESPACE}/${TARGET_POD}/${TARGET_CONTAINER} \</span>
</span><span id="__span-3-159"><a id="__codelineno-3-159" name="__codelineno-3-159"></a><span class="w">        </span><span class="no">--reporter json:/tmp/scan-results.json</span>
</span><span id="__span-3-160"><a id="__codelineno-3-160" name="__codelineno-3-160"></a>
</span><span id="__span-3-161"><a id="__codelineno-3-161" name="__codelineno-3-161"></a><span class="w">        </span><span class="no"># Generate scan summary using SAF CLI</span>
</span><span id="__span-3-162"><a id="__codelineno-3-162" name="__codelineno-3-162"></a><span class="w">        </span><span class="no">saf summary --input /tmp/scan-results.json --output-md /tmp/scan-summary.md</span>
</span><span id="__span-3-163"><a id="__codelineno-3-163" name="__codelineno-3-163"></a>
</span><span id="__span-3-164"><a id="__codelineno-3-164" name="__codelineno-3-164"></a><span class="w">        </span><span class="no"># Check scan against threshold</span>
</span><span id="__span-3-165"><a id="__codelineno-3-165" name="__codelineno-3-165"></a><span class="w">        </span><span class="no">saf threshold -i /tmp/scan-results.json -t ${THRESHOLD_VALUE}</span>
</span><span id="__span-3-166"><a id="__codelineno-3-166" name="__codelineno-3-166"></a><span class="w">        </span><span class="no">echo \$? &gt; /tmp/threshold_result.txt</span>
</span><span id="__span-3-167"><a id="__codelineno-3-167" name="__codelineno-3-167"></a><span class="w">      </span><span class="no">&quot;</span>
</span><span id="__span-3-168"><a id="__codelineno-3-168" name="__codelineno-3-168"></a>
</span><span id="__span-3-169"><a id="__codelineno-3-169" name="__codelineno-3-169"></a><span class="w">      </span><span class="no"># Copy results back from service container</span>
</span><span id="__span-3-170"><a id="__codelineno-3-170" name="__codelineno-3-170"></a><span class="w">      </span><span class="no">docker cp cinc-scanner:/tmp/scan-results.json ./scan-results.json</span>
</span><span id="__span-3-171"><a id="__codelineno-3-171" name="__codelineno-3-171"></a><span class="w">      </span><span class="no">docker cp cinc-scanner:/tmp/scan-summary.md ./scan-summary.md</span>
</span><span id="__span-3-172"><a id="__codelineno-3-172" name="__codelineno-3-172"></a><span class="w">      </span><span class="no">docker cp cinc-scanner:/tmp/threshold_result.txt ./threshold_result.txt</span>
</span><span id="__span-3-173"><a id="__codelineno-3-173" name="__codelineno-3-173"></a>
</span><span id="__span-3-174"><a id="__codelineno-3-174" name="__codelineno-3-174"></a><span class="w">      </span><span class="no"># Display summary in job output</span>
</span><span id="__span-3-175"><a id="__codelineno-3-175" name="__codelineno-3-175"></a><span class="w">      </span><span class="no">cat scan-summary.md</span>
</span><span id="__span-3-176"><a id="__codelineno-3-176" name="__codelineno-3-176"></a>
</span><span id="__span-3-177"><a id="__codelineno-3-177" name="__codelineno-3-177"></a><span class="w">      </span><span class="no"># Process threshold result</span>
</span><span id="__span-3-178"><a id="__codelineno-3-178" name="__codelineno-3-178"></a><span class="w">      </span><span class="no">THRESHOLD_RESULT=$(cat threshold_result.txt)</span>
</span><span id="__span-3-179"><a id="__codelineno-3-179" name="__codelineno-3-179"></a><span class="w">      </span><span class="no">echo &quot;THRESHOLD_PASSED=${THRESHOLD_RESULT}&quot; &gt;&gt; scan.env</span>
</span><span id="__span-3-180"><a id="__codelineno-3-180" name="__codelineno-3-180"></a>
</span><span id="__span-3-181"><a id="__codelineno-3-181" name="__codelineno-3-181"></a><span class="w">      </span><span class="no">if [ ${THRESHOLD_RESULT} -eq 0 ]; then</span>
</span><span id="__span-3-182"><a id="__codelineno-3-182" name="__codelineno-3-182"></a><span class="w">        </span><span class="no">echo &quot; Security scan passed threshold requirements&quot;</span>
</span><span id="__span-3-183"><a id="__codelineno-3-183" name="__codelineno-3-183"></a><span class="w">      </span><span class="no">else</span>
</span><span id="__span-3-184"><a id="__codelineno-3-184" name="__codelineno-3-184"></a><span class="w">        </span><span class="no">echo &quot; Security scan failed to meet threshold requirements&quot;</span>
</span><span id="__span-3-185"><a id="__codelineno-3-185" name="__codelineno-3-185"></a><span class="w">        </span><span class="no"># Uncomment to enforce threshold as a gate</span>
</span><span id="__span-3-186"><a id="__codelineno-3-186" name="__codelineno-3-186"></a><span class="w">        </span><span class="no"># exit ${THRESHOLD_RESULT}</span>
</span><span id="__span-3-187"><a id="__codelineno-3-187" name="__codelineno-3-187"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-3-188"><a id="__codelineno-3-188" name="__codelineno-3-188"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-3-189"><a id="__codelineno-3-189" name="__codelineno-3-189"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-3-190"><a id="__codelineno-3-190" name="__codelineno-3-190"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-results.json</span>
</span><span id="__span-3-191"><a id="__codelineno-3-191" name="__codelineno-3-191"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-summary.md</span>
</span><span id="__span-3-192"><a id="__codelineno-3-192" name="__codelineno-3-192"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-3-193"><a id="__codelineno-3-193" name="__codelineno-3-193"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan.env</span>
</span><span id="__span-3-194"><a id="__codelineno-3-194" name="__codelineno-3-194"></a>
</span><span id="__span-3-195"><a id="__codelineno-3-195" name="__codelineno-3-195"></a><span class="c1"># For distroless containers, we need a specialized approach</span>
</span><span id="__span-3-196"><a id="__codelineno-3-196" name="__codelineno-3-196"></a><span class="nt">run_distroless_scan</span><span class="p">:</span>
</span><span id="__span-3-197"><a id="__codelineno-3-197" name="__codelineno-3-197"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-3-198"><a id="__codelineno-3-198" name="__codelineno-3-198"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">deploy_container</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">create_access</span><span class="p p-Indicator">]</span>
</span><span id="__span-3-199"><a id="__codelineno-3-199" name="__codelineno-3-199"></a><span class="w">  </span><span class="c1"># This job will only run if the DISTROLESS variable is set to &quot;true&quot;</span>
</span><span id="__span-3-200"><a id="__codelineno-3-200" name="__codelineno-3-200"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-3-201"><a id="__codelineno-3-201" name="__codelineno-3-201"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$DISTROLESS == &quot;true&quot;</span>
</span><span id="__span-3-202"><a id="__codelineno-3-202" name="__codelineno-3-202"></a><span class="w">  </span><span class="c1"># Use our specialized distroless scanner service container</span>
</span><span id="__span-3-203"><a id="__codelineno-3-203" name="__codelineno-3-203"></a><span class="w">  </span><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-3-204"><a id="__codelineno-3-204" name="__codelineno-3-204"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.example.com/distroless-scanner:latest</span>
</span><span id="__span-3-205"><a id="__codelineno-3-205" name="__codelineno-3-205"></a><span class="w">      </span><span class="nt">alias</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">distroless-scanner</span>
</span><span id="__span-3-206"><a id="__codelineno-3-206" name="__codelineno-3-206"></a><span class="w">      </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;infinity&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-3-207"><a id="__codelineno-3-207" name="__codelineno-3-207"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-3-208"><a id="__codelineno-3-208" name="__codelineno-3-208"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-209"><a id="__codelineno-3-209" name="__codelineno-3-209"></a><span class="w">      </span><span class="no"># Create a kubeconfig file</span>
</span><span id="__span-3-210"><a id="__codelineno-3-210" name="__codelineno-3-210"></a><span class="w">      </span><span class="no">cat &gt; scan-kubeconfig.yaml &lt;&lt; EOF</span>
</span><span id="__span-3-211"><a id="__codelineno-3-211" name="__codelineno-3-211"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-3-212"><a id="__codelineno-3-212" name="__codelineno-3-212"></a><span class="w">      </span><span class="no">kind: Config</span>
</span><span id="__span-3-213"><a id="__codelineno-3-213" name="__codelineno-3-213"></a><span class="w">      </span><span class="no">preferences: {}</span>
</span><span id="__span-3-214"><a id="__codelineno-3-214" name="__codelineno-3-214"></a><span class="w">      </span><span class="no">clusters:</span>
</span><span id="__span-3-215"><a id="__codelineno-3-215" name="__codelineno-3-215"></a><span class="w">      </span><span class="no">- cluster:</span>
</span><span id="__span-3-216"><a id="__codelineno-3-216" name="__codelineno-3-216"></a><span class="w">          </span><span class="no">server: ${CLUSTER_SERVER}</span>
</span><span id="__span-3-217"><a id="__codelineno-3-217" name="__codelineno-3-217"></a><span class="w">          </span><span class="no">certificate-authority-data: ${CLUSTER_CA_DATA}</span>
</span><span id="__span-3-218"><a id="__codelineno-3-218" name="__codelineno-3-218"></a><span class="w">        </span><span class="no">name: scanner-cluster</span>
</span><span id="__span-3-219"><a id="__codelineno-3-219" name="__codelineno-3-219"></a><span class="w">      </span><span class="no">contexts:</span>
</span><span id="__span-3-220"><a id="__codelineno-3-220" name="__codelineno-3-220"></a><span class="w">      </span><span class="no">- context:</span>
</span><span id="__span-3-221"><a id="__codelineno-3-221" name="__codelineno-3-221"></a><span class="w">          </span><span class="no">cluster: scanner-cluster</span>
</span><span id="__span-3-222"><a id="__codelineno-3-222" name="__codelineno-3-222"></a><span class="w">          </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-3-223"><a id="__codelineno-3-223" name="__codelineno-3-223"></a><span class="w">          </span><span class="no">user: scanner-user</span>
</span><span id="__span-3-224"><a id="__codelineno-3-224" name="__codelineno-3-224"></a><span class="w">        </span><span class="no">name: scanner-context</span>
</span><span id="__span-3-225"><a id="__codelineno-3-225" name="__codelineno-3-225"></a><span class="w">      </span><span class="no">current-context: scanner-context</span>
</span><span id="__span-3-226"><a id="__codelineno-3-226" name="__codelineno-3-226"></a><span class="w">      </span><span class="no">users:</span>
</span><span id="__span-3-227"><a id="__codelineno-3-227" name="__codelineno-3-227"></a><span class="w">      </span><span class="no">- name: scanner-user</span>
</span><span id="__span-3-228"><a id="__codelineno-3-228" name="__codelineno-3-228"></a><span class="w">        </span><span class="no">user:</span>
</span><span id="__span-3-229"><a id="__codelineno-3-229" name="__codelineno-3-229"></a><span class="w">          </span><span class="no">token: ${SCANNER_TOKEN}</span>
</span><span id="__span-3-230"><a id="__codelineno-3-230" name="__codelineno-3-230"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-3-231"><a id="__codelineno-3-231" name="__codelineno-3-231"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-232"><a id="__codelineno-3-232" name="__codelineno-3-232"></a><span class="w">      </span><span class="no"># Copy kubeconfig and profiles to distroless scanner service container</span>
</span><span id="__span-3-233"><a id="__codelineno-3-233" name="__codelineno-3-233"></a><span class="w">      </span><span class="no">docker cp scan-kubeconfig.yaml distroless-scanner:/tmp/</span>
</span><span id="__span-3-234"><a id="__codelineno-3-234" name="__codelineno-3-234"></a><span class="w">      </span><span class="no">docker cp ${CINC_PROFILE_PATH} distroless-scanner:/tmp/profile</span>
</span><span id="__span-3-235"><a id="__codelineno-3-235" name="__codelineno-3-235"></a>
</span><span id="__span-3-236"><a id="__codelineno-3-236" name="__codelineno-3-236"></a><span class="w">      </span><span class="no"># Run specialized distroless scan in service container</span>
</span><span id="__span-3-237"><a id="__codelineno-3-237" name="__codelineno-3-237"></a><span class="w">      </span><span class="no">docker exec distroless-scanner bash -c &quot;</span>
</span><span id="__span-3-238"><a id="__codelineno-3-238" name="__codelineno-3-238"></a><span class="w">        </span><span class="no">KUBECONFIG=/tmp/scan-kubeconfig.yaml \</span>
</span><span id="__span-3-239"><a id="__codelineno-3-239" name="__codelineno-3-239"></a><span class="w">        </span><span class="no">/opt/scripts/scan-distroless.sh \</span>
</span><span id="__span-3-240"><a id="__codelineno-3-240" name="__codelineno-3-240"></a><span class="w">        </span><span class="no">${SCANNER_NAMESPACE} ${TARGET_POD} ${TARGET_CONTAINER} \</span>
</span><span id="__span-3-241"><a id="__codelineno-3-241" name="__codelineno-3-241"></a><span class="w">        </span><span class="no">/tmp/profile /tmp/scan-results.json</span>
</span><span id="__span-3-242"><a id="__codelineno-3-242" name="__codelineno-3-242"></a>
</span><span id="__span-3-243"><a id="__codelineno-3-243" name="__codelineno-3-243"></a><span class="w">        </span><span class="no"># Generate scan summary using SAF CLI</span>
</span><span id="__span-3-244"><a id="__codelineno-3-244" name="__codelineno-3-244"></a><span class="w">        </span><span class="no">saf summary --input /tmp/scan-results.json --output-md /tmp/scan-summary.md</span>
</span><span id="__span-3-245"><a id="__codelineno-3-245" name="__codelineno-3-245"></a>
</span><span id="__span-3-246"><a id="__codelineno-3-246" name="__codelineno-3-246"></a><span class="w">        </span><span class="no"># Check scan against threshold</span>
</span><span id="__span-3-247"><a id="__codelineno-3-247" name="__codelineno-3-247"></a><span class="w">        </span><span class="no">saf threshold -i /tmp/scan-results.json -t ${THRESHOLD_VALUE}</span>
</span><span id="__span-3-248"><a id="__codelineno-3-248" name="__codelineno-3-248"></a><span class="w">        </span><span class="no">echo \$? &gt; /tmp/threshold_result.txt</span>
</span><span id="__span-3-249"><a id="__codelineno-3-249" name="__codelineno-3-249"></a><span class="w">      </span><span class="no">&quot;</span>
</span><span id="__span-3-250"><a id="__codelineno-3-250" name="__codelineno-3-250"></a>
</span><span id="__span-3-251"><a id="__codelineno-3-251" name="__codelineno-3-251"></a><span class="w">      </span><span class="no"># Copy results back from service container</span>
</span><span id="__span-3-252"><a id="__codelineno-3-252" name="__codelineno-3-252"></a><span class="w">      </span><span class="no">docker cp distroless-scanner:/tmp/scan-results.json ./scan-results.json</span>
</span><span id="__span-3-253"><a id="__codelineno-3-253" name="__codelineno-3-253"></a><span class="w">      </span><span class="no">docker cp distroless-scanner:/tmp/scan-summary.md ./scan-summary.md</span>
</span><span id="__span-3-254"><a id="__codelineno-3-254" name="__codelineno-3-254"></a><span class="w">      </span><span class="no">docker cp distroless-scanner:/tmp/threshold_result.txt ./threshold_result.txt</span>
</span><span id="__span-3-255"><a id="__codelineno-3-255" name="__codelineno-3-255"></a>
</span><span id="__span-3-256"><a id="__codelineno-3-256" name="__codelineno-3-256"></a><span class="w">      </span><span class="no"># Display summary in job output</span>
</span><span id="__span-3-257"><a id="__codelineno-3-257" name="__codelineno-3-257"></a><span class="w">      </span><span class="no">cat scan-summary.md</span>
</span><span id="__span-3-258"><a id="__codelineno-3-258" name="__codelineno-3-258"></a>
</span><span id="__span-3-259"><a id="__codelineno-3-259" name="__codelineno-3-259"></a><span class="w">      </span><span class="no"># Process threshold result</span>
</span><span id="__span-3-260"><a id="__codelineno-3-260" name="__codelineno-3-260"></a><span class="w">      </span><span class="no">THRESHOLD_RESULT=$(cat threshold_result.txt)</span>
</span><span id="__span-3-261"><a id="__codelineno-3-261" name="__codelineno-3-261"></a><span class="w">      </span><span class="no">echo &quot;THRESHOLD_PASSED=${THRESHOLD_RESULT}&quot; &gt;&gt; scan.env</span>
</span><span id="__span-3-262"><a id="__codelineno-3-262" name="__codelineno-3-262"></a>
</span><span id="__span-3-263"><a id="__codelineno-3-263" name="__codelineno-3-263"></a><span class="w">      </span><span class="no">if [ ${THRESHOLD_RESULT} -eq 0 ]; then</span>
</span><span id="__span-3-264"><a id="__codelineno-3-264" name="__codelineno-3-264"></a><span class="w">        </span><span class="no">echo &quot; Security scan passed threshold requirements&quot;</span>
</span><span id="__span-3-265"><a id="__codelineno-3-265" name="__codelineno-3-265"></a><span class="w">      </span><span class="no">else</span>
</span><span id="__span-3-266"><a id="__codelineno-3-266" name="__codelineno-3-266"></a><span class="w">        </span><span class="no">echo &quot; Security scan failed to meet threshold requirements&quot;</span>
</span><span id="__span-3-267"><a id="__codelineno-3-267" name="__codelineno-3-267"></a><span class="w">        </span><span class="no"># Uncomment to enforce threshold as a gate</span>
</span><span id="__span-3-268"><a id="__codelineno-3-268" name="__codelineno-3-268"></a><span class="w">        </span><span class="no"># exit ${THRESHOLD_RESULT}</span>
</span><span id="__span-3-269"><a id="__codelineno-3-269" name="__codelineno-3-269"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-3-270"><a id="__codelineno-3-270" name="__codelineno-3-270"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-3-271"><a id="__codelineno-3-271" name="__codelineno-3-271"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-3-272"><a id="__codelineno-3-272" name="__codelineno-3-272"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-results.json</span>
</span><span id="__span-3-273"><a id="__codelineno-3-273" name="__codelineno-3-273"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-summary.md</span>
</span><span id="__span-3-274"><a id="__codelineno-3-274" name="__codelineno-3-274"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-3-275"><a id="__codelineno-3-275" name="__codelineno-3-275"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan.env</span>
</span><span id="__span-3-276"><a id="__codelineno-3-276" name="__codelineno-3-276"></a>
</span><span id="__span-3-277"><a id="__codelineno-3-277" name="__codelineno-3-277"></a><span class="nt">generate_report</span><span class="p">:</span>
</span><span id="__span-3-278"><a id="__codelineno-3-278" name="__codelineno-3-278"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">report</span>
</span><span id="__span-3-279"><a id="__codelineno-3-279" name="__codelineno-3-279"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">run_scan</span><span class="p p-Indicator">]</span>
</span><span id="__span-3-280"><a id="__codelineno-3-280" name="__codelineno-3-280"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-3-281"><a id="__codelineno-3-281" name="__codelineno-3-281"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-282"><a id="__codelineno-3-282" name="__codelineno-3-282"></a><span class="w">      </span><span class="no"># Install SAF CLI if needed in this stage</span>
</span><span id="__span-3-283"><a id="__codelineno-3-283" name="__codelineno-3-283"></a><span class="w">      </span><span class="no">which saf || npm install -g @mitre/saf</span>
</span><span id="__span-3-284"><a id="__codelineno-3-284" name="__codelineno-3-284"></a>
</span><span id="__span-3-285"><a id="__codelineno-3-285" name="__codelineno-3-285"></a><span class="w">      </span><span class="no"># Generate a more comprehensive report</span>
</span><span id="__span-3-286"><a id="__codelineno-3-286" name="__codelineno-3-286"></a><span class="w">      </span><span class="no">saf view -i scan-results.json --output scan-report.html</span>
</span><span id="__span-3-287"><a id="__codelineno-3-287" name="__codelineno-3-287"></a>
</span><span id="__span-3-288"><a id="__codelineno-3-288" name="__codelineno-3-288"></a><span class="w">      </span><span class="no"># Create a simple markdown report for the MR</span>
</span><span id="__span-3-289"><a id="__codelineno-3-289" name="__codelineno-3-289"></a><span class="w">      </span><span class="no">cat &gt; scan-report.md &lt;&lt; EOF</span>
</span><span id="__span-3-290"><a id="__codelineno-3-290" name="__codelineno-3-290"></a><span class="w">      </span><span class="no"># Security Scan Results</span>
</span><span id="__span-3-291"><a id="__codelineno-3-291" name="__codelineno-3-291"></a>
</span><span id="__span-3-292"><a id="__codelineno-3-292" name="__codelineno-3-292"></a><span class="w">      </span><span class="no">## Summary</span>
</span><span id="__span-3-293"><a id="__codelineno-3-293" name="__codelineno-3-293"></a>
</span><span id="__span-3-294"><a id="__codelineno-3-294" name="__codelineno-3-294"></a><span class="w">      </span><span class="no">$(cat scan-summary.md)</span>
</span><span id="__span-3-295"><a id="__codelineno-3-295" name="__codelineno-3-295"></a>
</span><span id="__span-3-296"><a id="__codelineno-3-296" name="__codelineno-3-296"></a><span class="w">      </span><span class="no">## Threshold Check</span>
</span><span id="__span-3-297"><a id="__codelineno-3-297" name="__codelineno-3-297"></a>
</span><span id="__span-3-298"><a id="__codelineno-3-298" name="__codelineno-3-298"></a><span class="w">      </span><span class="no">${THRESHOLD_PASSED} -eq 0 &amp;&amp; echo &quot; **PASSED**&quot; || echo &quot; **FAILED**&quot;</span>
</span><span id="__span-3-299"><a id="__codelineno-3-299" name="__codelineno-3-299"></a>
</span><span id="__span-3-300"><a id="__codelineno-3-300" name="__codelineno-3-300"></a><span class="w">      </span><span class="no">Threshold: ${THRESHOLD_VALUE}%</span>
</span><span id="__span-3-301"><a id="__codelineno-3-301" name="__codelineno-3-301"></a>
</span><span id="__span-3-302"><a id="__codelineno-3-302" name="__codelineno-3-302"></a><span class="w">      </span><span class="no">## Details</span>
</span><span id="__span-3-303"><a id="__codelineno-3-303" name="__codelineno-3-303"></a>
</span><span id="__span-3-304"><a id="__codelineno-3-304" name="__codelineno-3-304"></a><span class="w">      </span><span class="no">For full results, see the artifacts.</span>
</span><span id="__span-3-305"><a id="__codelineno-3-305" name="__codelineno-3-305"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-3-306"><a id="__codelineno-3-306" name="__codelineno-3-306"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-3-307"><a id="__codelineno-3-307" name="__codelineno-3-307"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-3-308"><a id="__codelineno-3-308" name="__codelineno-3-308"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-report.html</span>
</span><span id="__span-3-309"><a id="__codelineno-3-309" name="__codelineno-3-309"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-report.md</span>
</span><span id="__span-3-310"><a id="__codelineno-3-310" name="__codelineno-3-310"></a><span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
</span><span id="__span-3-311"><a id="__codelineno-3-311" name="__codelineno-3-311"></a>
</span><span id="__span-3-312"><a id="__codelineno-3-312" name="__codelineno-3-312"></a><span class="nt">cleanup</span><span class="p">:</span>
</span><span id="__span-3-313"><a id="__codelineno-3-313" name="__codelineno-3-313"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-3-314"><a id="__codelineno-3-314" name="__codelineno-3-314"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">run_scan</span><span class="p p-Indicator">]</span>
</span><span id="__span-3-315"><a id="__codelineno-3-315" name="__codelineno-3-315"></a><span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span><span class="w">  </span><span class="c1"># Run even if previous stages failed</span>
</span><span id="__span-3-316"><a id="__codelineno-3-316" name="__codelineno-3-316"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-3-317"><a id="__codelineno-3-317" name="__codelineno-3-317"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-3-318"><a id="__codelineno-3-318" name="__codelineno-3-318"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-3-319"><a id="__codelineno-3-319" name="__codelineno-3-319"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-3-320"><a id="__codelineno-3-320" name="__codelineno-3-320"></a><span class="w">      </span><span class="no"># Delete all resources</span>
</span><span id="__span-3-321"><a id="__codelineno-3-321" name="__codelineno-3-321"></a><span class="w">      </span><span class="no">kubectl delete pod/${TARGET_POD} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-3-322"><a id="__codelineno-3-322" name="__codelineno-3-322"></a><span class="w">      </span><span class="no">kubectl delete role/scanner-role-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-3-323"><a id="__codelineno-3-323" name="__codelineno-3-323"></a><span class="w">      </span><span class="no">kubectl delete sa/scanner-sa-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-3-324"><a id="__codelineno-3-324" name="__codelineno-3-324"></a><span class="w">      </span><span class="no">kubectl delete rolebinding/scanner-binding-${CI_PIPELINE_ID} \</span>
</span><span id="__span-3-325"><a id="__codelineno-3-325" name="__codelineno-3-325"></a><span class="w">        </span><span class="no">-n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="sidecar-container-pipeline">Sidecar Container Pipeline<a class="headerlink" href="#sidecar-container-pipeline" title="Permanent link">&para;</a></h2>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">  1</a></span>
<span class="normal"><a href="#__codelineno-4-2">  2</a></span>
<span class="normal"><a href="#__codelineno-4-3">  3</a></span>
<span class="normal"><a href="#__codelineno-4-4">  4</a></span>
<span class="normal"><a href="#__codelineno-4-5">  5</a></span>
<span class="normal"><a href="#__codelineno-4-6">  6</a></span>
<span class="normal"><a href="#__codelineno-4-7">  7</a></span>
<span class="normal"><a href="#__codelineno-4-8">  8</a></span>
<span class="normal"><a href="#__codelineno-4-9">  9</a></span>
<span class="normal"><a href="#__codelineno-4-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-4-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-4-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-4-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-4-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-4-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-4-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-4-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-4-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-4-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-4-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-4-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-4-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-4-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-4-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-4-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-4-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-4-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-4-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-4-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-4-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-4-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-4-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-4-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-4-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-4-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-4-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-4-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-4-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-4-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-4-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-4-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-4-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-4-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-4-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-4-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-4-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-4-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-4-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-4-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-4-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-4-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-4-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-4-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-4-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-4-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-4-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-4-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-4-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-4-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-4-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-4-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-4-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-4-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-4-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-4-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-4-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-4-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-4-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-4-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-4-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-4-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-4-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-4-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-4-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-4-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-4-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-4-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-4-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-4-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-4-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-4-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-4-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-4-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-4-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-4-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-4-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-4-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-4-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-4-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-4-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-4-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-4-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-4-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-4-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-4-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-4-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-4-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-4-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-4-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-4-100">100</a></span>
<span class="normal"><a href="#__codelineno-4-101">101</a></span>
<span class="normal"><a href="#__codelineno-4-102">102</a></span>
<span class="normal"><a href="#__codelineno-4-103">103</a></span>
<span class="normal"><a href="#__codelineno-4-104">104</a></span>
<span class="normal"><a href="#__codelineno-4-105">105</a></span>
<span class="normal"><a href="#__codelineno-4-106">106</a></span>
<span class="normal"><a href="#__codelineno-4-107">107</a></span>
<span class="normal"><a href="#__codelineno-4-108">108</a></span>
<span class="normal"><a href="#__codelineno-4-109">109</a></span>
<span class="normal"><a href="#__codelineno-4-110">110</a></span>
<span class="normal"><a href="#__codelineno-4-111">111</a></span>
<span class="normal"><a href="#__codelineno-4-112">112</a></span>
<span class="normal"><a href="#__codelineno-4-113">113</a></span>
<span class="normal"><a href="#__codelineno-4-114">114</a></span>
<span class="normal"><a href="#__codelineno-4-115">115</a></span>
<span class="normal"><a href="#__codelineno-4-116">116</a></span>
<span class="normal"><a href="#__codelineno-4-117">117</a></span>
<span class="normal"><a href="#__codelineno-4-118">118</a></span>
<span class="normal"><a href="#__codelineno-4-119">119</a></span>
<span class="normal"><a href="#__codelineno-4-120">120</a></span>
<span class="normal"><a href="#__codelineno-4-121">121</a></span>
<span class="normal"><a href="#__codelineno-4-122">122</a></span>
<span class="normal"><a href="#__codelineno-4-123">123</a></span>
<span class="normal"><a href="#__codelineno-4-124">124</a></span>
<span class="normal"><a href="#__codelineno-4-125">125</a></span>
<span class="normal"><a href="#__codelineno-4-126">126</a></span>
<span class="normal"><a href="#__codelineno-4-127">127</a></span>
<span class="normal"><a href="#__codelineno-4-128">128</a></span>
<span class="normal"><a href="#__codelineno-4-129">129</a></span>
<span class="normal"><a href="#__codelineno-4-130">130</a></span>
<span class="normal"><a href="#__codelineno-4-131">131</a></span>
<span class="normal"><a href="#__codelineno-4-132">132</a></span>
<span class="normal"><a href="#__codelineno-4-133">133</a></span>
<span class="normal"><a href="#__codelineno-4-134">134</a></span>
<span class="normal"><a href="#__codelineno-4-135">135</a></span>
<span class="normal"><a href="#__codelineno-4-136">136</a></span>
<span class="normal"><a href="#__codelineno-4-137">137</a></span>
<span class="normal"><a href="#__codelineno-4-138">138</a></span>
<span class="normal"><a href="#__codelineno-4-139">139</a></span>
<span class="normal"><a href="#__codelineno-4-140">140</a></span>
<span class="normal"><a href="#__codelineno-4-141">141</a></span>
<span class="normal"><a href="#__codelineno-4-142">142</a></span>
<span class="normal"><a href="#__codelineno-4-143">143</a></span>
<span class="normal"><a href="#__codelineno-4-144">144</a></span>
<span class="normal"><a href="#__codelineno-4-145">145</a></span>
<span class="normal"><a href="#__codelineno-4-146">146</a></span>
<span class="normal"><a href="#__codelineno-4-147">147</a></span>
<span class="normal"><a href="#__codelineno-4-148">148</a></span>
<span class="normal"><a href="#__codelineno-4-149">149</a></span>
<span class="normal"><a href="#__codelineno-4-150">150</a></span>
<span class="normal"><a href="#__codelineno-4-151">151</a></span>
<span class="normal"><a href="#__codelineno-4-152">152</a></span>
<span class="normal"><a href="#__codelineno-4-153">153</a></span>
<span class="normal"><a href="#__codelineno-4-154">154</a></span>
<span class="normal"><a href="#__codelineno-4-155">155</a></span>
<span class="normal"><a href="#__codelineno-4-156">156</a></span>
<span class="normal"><a href="#__codelineno-4-157">157</a></span>
<span class="normal"><a href="#__codelineno-4-158">158</a></span>
<span class="normal"><a href="#__codelineno-4-159">159</a></span>
<span class="normal"><a href="#__codelineno-4-160">160</a></span>
<span class="normal"><a href="#__codelineno-4-161">161</a></span>
<span class="normal"><a href="#__codelineno-4-162">162</a></span>
<span class="normal"><a href="#__codelineno-4-163">163</a></span>
<span class="normal"><a href="#__codelineno-4-164">164</a></span>
<span class="normal"><a href="#__codelineno-4-165">165</a></span>
<span class="normal"><a href="#__codelineno-4-166">166</a></span>
<span class="normal"><a href="#__codelineno-4-167">167</a></span>
<span class="normal"><a href="#__codelineno-4-168">168</a></span>
<span class="normal"><a href="#__codelineno-4-169">169</a></span>
<span class="normal"><a href="#__codelineno-4-170">170</a></span>
<span class="normal"><a href="#__codelineno-4-171">171</a></span>
<span class="normal"><a href="#__codelineno-4-172">172</a></span>
<span class="normal"><a href="#__codelineno-4-173">173</a></span>
<span class="normal"><a href="#__codelineno-4-174">174</a></span>
<span class="normal"><a href="#__codelineno-4-175">175</a></span>
<span class="normal"><a href="#__codelineno-4-176">176</a></span>
<span class="normal"><a href="#__codelineno-4-177">177</a></span>
<span class="normal"><a href="#__codelineno-4-178">178</a></span>
<span class="normal"><a href="#__codelineno-4-179">179</a></span>
<span class="normal"><a href="#__codelineno-4-180">180</a></span>
<span class="normal"><a href="#__codelineno-4-181">181</a></span>
<span class="normal"><a href="#__codelineno-4-182">182</a></span>
<span class="normal"><a href="#__codelineno-4-183">183</a></span>
<span class="normal"><a href="#__codelineno-4-184">184</a></span>
<span class="normal"><a href="#__codelineno-4-185">185</a></span>
<span class="normal"><a href="#__codelineno-4-186">186</a></span>
<span class="normal"><a href="#__codelineno-4-187">187</a></span>
<span class="normal"><a href="#__codelineno-4-188">188</a></span>
<span class="normal"><a href="#__codelineno-4-189">189</a></span>
<span class="normal"><a href="#__codelineno-4-190">190</a></span>
<span class="normal"><a href="#__codelineno-4-191">191</a></span>
<span class="normal"><a href="#__codelineno-4-192">192</a></span>
<span class="normal"><a href="#__codelineno-4-193">193</a></span>
<span class="normal"><a href="#__codelineno-4-194">194</a></span>
<span class="normal"><a href="#__codelineno-4-195">195</a></span>
<span class="normal"><a href="#__codelineno-4-196">196</a></span>
<span class="normal"><a href="#__codelineno-4-197">197</a></span>
<span class="normal"><a href="#__codelineno-4-198">198</a></span>
<span class="normal"><a href="#__codelineno-4-199">199</a></span>
<span class="normal"><a href="#__codelineno-4-200">200</a></span>
<span class="normal"><a href="#__codelineno-4-201">201</a></span>
<span class="normal"><a href="#__codelineno-4-202">202</a></span>
<span class="normal"><a href="#__codelineno-4-203">203</a></span>
<span class="normal"><a href="#__codelineno-4-204">204</a></span>
<span class="normal"><a href="#__codelineno-4-205">205</a></span>
<span class="normal"><a href="#__codelineno-4-206">206</a></span>
<span class="normal"><a href="#__codelineno-4-207">207</a></span>
<span class="normal"><a href="#__codelineno-4-208">208</a></span>
<span class="normal"><a href="#__codelineno-4-209">209</a></span>
<span class="normal"><a href="#__codelineno-4-210">210</a></span>
<span class="normal"><a href="#__codelineno-4-211">211</a></span>
<span class="normal"><a href="#__codelineno-4-212">212</a></span>
<span class="normal"><a href="#__codelineno-4-213">213</a></span>
<span class="normal"><a href="#__codelineno-4-214">214</a></span>
<span class="normal"><a href="#__codelineno-4-215">215</a></span>
<span class="normal"><a href="#__codelineno-4-216">216</a></span>
<span class="normal"><a href="#__codelineno-4-217">217</a></span>
<span class="normal"><a href="#__codelineno-4-218">218</a></span>
<span class="normal"><a href="#__codelineno-4-219">219</a></span>
<span class="normal"><a href="#__codelineno-4-220">220</a></span>
<span class="normal"><a href="#__codelineno-4-221">221</a></span>
<span class="normal"><a href="#__codelineno-4-222">222</a></span>
<span class="normal"><a href="#__codelineno-4-223">223</a></span>
<span class="normal"><a href="#__codelineno-4-224">224</a></span>
<span class="normal"><a href="#__codelineno-4-225">225</a></span>
<span class="normal"><a href="#__codelineno-4-226">226</a></span>
<span class="normal"><a href="#__codelineno-4-227">227</a></span>
<span class="normal"><a href="#__codelineno-4-228">228</a></span>
<span class="normal"><a href="#__codelineno-4-229">229</a></span>
<span class="normal"><a href="#__codelineno-4-230">230</a></span>
<span class="normal"><a href="#__codelineno-4-231">231</a></span>
<span class="normal"><a href="#__codelineno-4-232">232</a></span>
<span class="normal"><a href="#__codelineno-4-233">233</a></span>
<span class="normal"><a href="#__codelineno-4-234">234</a></span>
<span class="normal"><a href="#__codelineno-4-235">235</a></span>
<span class="normal"><a href="#__codelineno-4-236">236</a></span>
<span class="normal"><a href="#__codelineno-4-237">237</a></span>
<span class="normal"><a href="#__codelineno-4-238">238</a></span>
<span class="normal"><a href="#__codelineno-4-239">239</a></span>
<span class="normal"><a href="#__codelineno-4-240">240</a></span>
<span class="normal"><a href="#__codelineno-4-241">241</a></span>
<span class="normal"><a href="#__codelineno-4-242">242</a></span>
<span class="normal"><a href="#__codelineno-4-243">243</a></span>
<span class="normal"><a href="#__codelineno-4-244">244</a></span>
<span class="normal"><a href="#__codelineno-4-245">245</a></span>
<span class="normal"><a href="#__codelineno-4-246">246</a></span>
<span class="normal"><a href="#__codelineno-4-247">247</a></span>
<span class="normal"><a href="#__codelineno-4-248">248</a></span>
<span class="normal"><a href="#__codelineno-4-249">249</a></span>
<span class="normal"><a href="#__codelineno-4-250">250</a></span>
<span class="normal"><a href="#__codelineno-4-251">251</a></span>
<span class="normal"><a href="#__codelineno-4-252">252</a></span>
<span class="normal"><a href="#__codelineno-4-253">253</a></span>
<span class="normal"><a href="#__codelineno-4-254">254</a></span>
<span class="normal"><a href="#__codelineno-4-255">255</a></span>
<span class="normal"><a href="#__codelineno-4-256">256</a></span>
<span class="normal"><a href="#__codelineno-4-257">257</a></span>
<span class="normal"><a href="#__codelineno-4-258">258</a></span>
<span class="normal"><a href="#__codelineno-4-259">259</a></span>
<span class="normal"><a href="#__codelineno-4-260">260</a></span>
<span class="normal"><a href="#__codelineno-4-261">261</a></span>
<span class="normal"><a href="#__codelineno-4-262">262</a></span>
<span class="normal"><a href="#__codelineno-4-263">263</a></span>
<span class="normal"><a href="#__codelineno-4-264">264</a></span>
<span class="normal"><a href="#__codelineno-4-265">265</a></span>
<span class="normal"><a href="#__codelineno-4-266">266</a></span>
<span class="normal"><a href="#__codelineno-4-267">267</a></span>
<span class="normal"><a href="#__codelineno-4-268">268</a></span>
<span class="normal"><a href="#__codelineno-4-269">269</a></span>
<span class="normal"><a href="#__codelineno-4-270">270</a></span>
<span class="normal"><a href="#__codelineno-4-271">271</a></span>
<span class="normal"><a href="#__codelineno-4-272">272</a></span>
<span class="normal"><a href="#__codelineno-4-273">273</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="nt">stages</span><span class="p">:</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">report</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">  </span><span class="nt">SCANNER_NAMESPACE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;inspec-test&quot;</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">  </span><span class="nt">TARGET_LABEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app=target-app&quot;</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">  </span><span class="nt">THRESHOLD_VALUE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;70&quot;</span><span class="w">  </span><span class="c1"># Minimum passing score (0-100)</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">  </span><span class="nt">TARGET_IMAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;registry.example.com/my-image:latest&quot;</span><span class="w">  </span><span class="c1"># Target image to scan</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">  </span><span class="c1"># If scanning a distroless image, set this to true</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">  </span><span class="nt">IS_DISTROLESS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14"></a>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="nt">deploy_sidecar_pod</span><span class="p">:</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="w">      </span><span class="no"># Create the namespace if it doesn&#39;t exist</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="w">      </span><span class="no">kubectl get namespace ${SCANNER_NAMESPACE} || kubectl create namespace ${SCANNER_NAMESPACE}</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23"></a>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24"></a><span class="w">      </span><span class="no"># Create ConfigMap for CINC profile</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25"></a><span class="w">      </span><span class="no">cat &gt; container-baseline.rb &lt;&lt; EOF</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26"></a><span class="w">      </span><span class="no"># Example CINC Auditor profile for container scanning</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27"></a>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="w">      </span><span class="no">title &quot;Container Baseline&quot;</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29"></a>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30"></a><span class="w">      </span><span class="no">control &quot;container-1.1&quot; do</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31"></a><span class="w">        </span><span class="no">impact 0.7</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32"></a><span class="w">        </span><span class="no">title &quot;Container files should have proper permissions&quot;</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33"></a><span class="w">        </span><span class="no">desc &quot;Critical files in the container should have proper permissions.&quot;</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34"></a>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35"></a><span class="w">        </span><span class="no">describe file(&#39;/etc/passwd&#39;) do</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36"></a><span class="w">          </span><span class="no">it { should exist }</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37"></a><span class="w">          </span><span class="no">its(&#39;mode&#39;) { should cmp &#39;0644&#39; }</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38"></a><span class="w">        </span><span class="no">end</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39"></a><span class="w">      </span><span class="no">end</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40"></a>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41"></a><span class="w">      </span><span class="no">control &quot;container-1.2&quot; do</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42"></a><span class="w">        </span><span class="no">impact 0.5</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43"></a><span class="w">        </span><span class="no">title &quot;Container should not have unnecessary packages&quot;</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44"></a><span class="w">        </span><span class="no">desc &quot;Container should be minimal and not contain unnecessary packages.&quot;</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45"></a>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46"></a><span class="w">        </span><span class="no">describe directory(&#39;/var/lib/apt&#39;) do</span>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47"></a><span class="w">          </span><span class="no">it { should_not exist }</span>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48"></a><span class="w">        </span><span class="no">end</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49"></a><span class="w">      </span><span class="no">end</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51"></a>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52"></a><span class="w">      </span><span class="no">kubectl create configmap inspec-profiles-${CI_PIPELINE_ID} \</span>
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53"></a><span class="w">        </span><span class="no">--from-file=container-baseline=container-baseline.rb \</span>
</span><span id="__span-4-54"><a id="__codelineno-4-54" name="__codelineno-4-54"></a><span class="w">        </span><span class="no">-n ${SCANNER_NAMESPACE}</span>
</span><span id="__span-4-55"><a id="__codelineno-4-55" name="__codelineno-4-55"></a>
</span><span id="__span-4-56"><a id="__codelineno-4-56" name="__codelineno-4-56"></a><span class="w">      </span><span class="no"># Create ConfigMap for threshold</span>
</span><span id="__span-4-57"><a id="__codelineno-4-57" name="__codelineno-4-57"></a><span class="w">      </span><span class="no">cat &gt; threshold.yml &lt;&lt; EOF</span>
</span><span id="__span-4-58"><a id="__codelineno-4-58" name="__codelineno-4-58"></a><span class="w">      </span><span class="no">compliance:</span>
</span><span id="__span-4-59"><a id="__codelineno-4-59" name="__codelineno-4-59"></a><span class="w">        </span><span class="no">min: ${THRESHOLD_VALUE}</span>
</span><span id="__span-4-60"><a id="__codelineno-4-60" name="__codelineno-4-60"></a><span class="w">      </span><span class="no">failed:</span>
</span><span id="__span-4-61"><a id="__codelineno-4-61" name="__codelineno-4-61"></a><span class="w">        </span><span class="no">critical:</span>
</span><span id="__span-4-62"><a id="__codelineno-4-62" name="__codelineno-4-62"></a><span class="w">          </span><span class="no">max: 0</span>
</span><span id="__span-4-63"><a id="__codelineno-4-63" name="__codelineno-4-63"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-4-64"><a id="__codelineno-4-64" name="__codelineno-4-64"></a>
</span><span id="__span-4-65"><a id="__codelineno-4-65" name="__codelineno-4-65"></a><span class="w">      </span><span class="no">kubectl create configmap inspec-thresholds-${CI_PIPELINE_ID} \</span>
</span><span id="__span-4-66"><a id="__codelineno-4-66" name="__codelineno-4-66"></a><span class="w">        </span><span class="no">--from-file=threshold.yml=threshold.yml \</span>
</span><span id="__span-4-67"><a id="__codelineno-4-67" name="__codelineno-4-67"></a><span class="w">        </span><span class="no">-n ${SCANNER_NAMESPACE}</span>
</span><span id="__span-4-68"><a id="__codelineno-4-68" name="__codelineno-4-68"></a>
</span><span id="__span-4-69"><a id="__codelineno-4-69" name="__codelineno-4-69"></a><span class="w">      </span><span class="no"># Deploy the pod with sidecar scanner</span>
</span><span id="__span-4-70"><a id="__codelineno-4-70" name="__codelineno-4-70"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-4-71"><a id="__codelineno-4-71" name="__codelineno-4-71"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-4-72"><a id="__codelineno-4-72" name="__codelineno-4-72"></a><span class="w">      </span><span class="no">kind: Pod</span>
</span><span id="__span-4-73"><a id="__codelineno-4-73" name="__codelineno-4-73"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-4-74"><a id="__codelineno-4-74" name="__codelineno-4-74"></a><span class="w">        </span><span class="no">name: app-scanner-${CI_PIPELINE_ID}</span>
</span><span id="__span-4-75"><a id="__codelineno-4-75" name="__codelineno-4-75"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-4-76"><a id="__codelineno-4-76" name="__codelineno-4-76"></a><span class="w">        </span><span class="no">labels:</span>
</span><span id="__span-4-77"><a id="__codelineno-4-77" name="__codelineno-4-77"></a><span class="w">          </span><span class="no">app: scanner-pod</span>
</span><span id="__span-4-78"><a id="__codelineno-4-78" name="__codelineno-4-78"></a><span class="w">          </span><span class="no">pipeline: &quot;${CI_PIPELINE_ID}&quot;</span>
</span><span id="__span-4-79"><a id="__codelineno-4-79" name="__codelineno-4-79"></a><span class="w">      </span><span class="no">spec:</span>
</span><span id="__span-4-80"><a id="__codelineno-4-80" name="__codelineno-4-80"></a><span class="w">        </span><span class="no">shareProcessNamespace: true  # Enable shared process namespace</span>
</span><span id="__span-4-81"><a id="__codelineno-4-81" name="__codelineno-4-81"></a><span class="w">        </span><span class="no">containers:</span>
</span><span id="__span-4-82"><a id="__codelineno-4-82" name="__codelineno-4-82"></a><span class="w">        </span><span class="no"># Target container to be scanned</span>
</span><span id="__span-4-83"><a id="__codelineno-4-83" name="__codelineno-4-83"></a><span class="w">        </span><span class="no">- name: target</span>
</span><span id="__span-4-84"><a id="__codelineno-4-84" name="__codelineno-4-84"></a><span class="w">          </span><span class="no">image: ${TARGET_IMAGE}</span>
</span><span id="__span-4-85"><a id="__codelineno-4-85" name="__codelineno-4-85"></a><span class="w">          </span><span class="no">command: [&quot;sleep&quot;, &quot;3600&quot;]</span>
</span><span id="__span-4-86"><a id="__codelineno-4-86" name="__codelineno-4-86"></a><span class="w">          </span><span class="no"># For distroless containers, adjust command accordingly</span>
</span><span id="__span-4-87"><a id="__codelineno-4-87" name="__codelineno-4-87"></a>
</span><span id="__span-4-88"><a id="__codelineno-4-88" name="__codelineno-4-88"></a><span class="w">        </span><span class="no"># CINC Auditor scanner sidecar</span>
</span><span id="__span-4-89"><a id="__codelineno-4-89" name="__codelineno-4-89"></a><span class="w">        </span><span class="no">- name: scanner</span>
</span><span id="__span-4-90"><a id="__codelineno-4-90" name="__codelineno-4-90"></a><span class="w">          </span><span class="no">image: ruby:3.0-slim</span>
</span><span id="__span-4-91"><a id="__codelineno-4-91" name="__codelineno-4-91"></a><span class="w">          </span><span class="no">command: </span>
</span><span id="__span-4-92"><a id="__codelineno-4-92" name="__codelineno-4-92"></a><span class="w">          </span><span class="no">- &quot;/bin/bash&quot;</span>
</span><span id="__span-4-93"><a id="__codelineno-4-93" name="__codelineno-4-93"></a><span class="w">          </span><span class="no">- &quot;-c&quot;</span>
</span><span id="__span-4-94"><a id="__codelineno-4-94" name="__codelineno-4-94"></a><span class="w">          </span><span class="no">- |</span>
</span><span id="__span-4-95"><a id="__codelineno-4-95" name="__codelineno-4-95"></a><span class="w">            </span><span class="no"># Install dependencies</span>
</span><span id="__span-4-96"><a id="__codelineno-4-96" name="__codelineno-4-96"></a><span class="w">            </span><span class="no">apt-get update</span>
</span><span id="__span-4-97"><a id="__codelineno-4-97" name="__codelineno-4-97"></a><span class="w">            </span><span class="no">apt-get install -y curl gnupg procps nodejs npm</span>
</span><span id="__span-4-98"><a id="__codelineno-4-98" name="__codelineno-4-98"></a>
</span><span id="__span-4-99"><a id="__codelineno-4-99" name="__codelineno-4-99"></a><span class="w">            </span><span class="no"># Install CINC Auditor</span>
</span><span id="__span-4-100"><a id="__codelineno-4-100" name="__codelineno-4-100"></a><span class="w">            </span><span class="no">curl -L https://omnitruck.cinc.sh/install.sh | bash -s -- -P cinc-auditor</span>
</span><span id="__span-4-101"><a id="__codelineno-4-101" name="__codelineno-4-101"></a>
</span><span id="__span-4-102"><a id="__codelineno-4-102" name="__codelineno-4-102"></a><span class="w">            </span><span class="no"># Install SAF CLI</span>
</span><span id="__span-4-103"><a id="__codelineno-4-103" name="__codelineno-4-103"></a><span class="w">            </span><span class="no">npm install -g @mitre/saf</span>
</span><span id="__span-4-104"><a id="__codelineno-4-104" name="__codelineno-4-104"></a>
</span><span id="__span-4-105"><a id="__codelineno-4-105" name="__codelineno-4-105"></a><span class="w">            </span><span class="no"># Wait for the main container to start</span>
</span><span id="__span-4-106"><a id="__codelineno-4-106" name="__codelineno-4-106"></a><span class="w">            </span><span class="no">sleep 10</span>
</span><span id="__span-4-107"><a id="__codelineno-4-107" name="__codelineno-4-107"></a>
</span><span id="__span-4-108"><a id="__codelineno-4-108" name="__codelineno-4-108"></a><span class="w">            </span><span class="no">echo &quot;Starting CINC Auditor scan...&quot;</span>
</span><span id="__span-4-109"><a id="__codelineno-4-109" name="__codelineno-4-109"></a>
</span><span id="__span-4-110"><a id="__codelineno-4-110" name="__codelineno-4-110"></a><span class="w">            </span><span class="no"># Find the main process of the target container</span>
</span><span id="__span-4-111"><a id="__codelineno-4-111" name="__codelineno-4-111"></a><span class="w">            </span><span class="no">TARGET_PID=\$(ps aux | grep -v grep | grep &quot;sleep 3600&quot; | head -1 | awk &#39;{print \$2}&#39;)</span>
</span><span id="__span-4-112"><a id="__codelineno-4-112" name="__codelineno-4-112"></a>
</span><span id="__span-4-113"><a id="__codelineno-4-113" name="__codelineno-4-113"></a><span class="w">            </span><span class="no">if [ -z &quot;\$TARGET_PID&quot; ]; then</span>
</span><span id="__span-4-114"><a id="__codelineno-4-114" name="__codelineno-4-114"></a><span class="w">              </span><span class="no">echo &quot;ERROR: Could not find target process&quot;</span>
</span><span id="__span-4-115"><a id="__codelineno-4-115" name="__codelineno-4-115"></a><span class="w">              </span><span class="no">exit 1</span>
</span><span id="__span-4-116"><a id="__codelineno-4-116" name="__codelineno-4-116"></a><span class="w">            </span><span class="no">fi</span>
</span><span id="__span-4-117"><a id="__codelineno-4-117" name="__codelineno-4-117"></a>
</span><span id="__span-4-118"><a id="__codelineno-4-118" name="__codelineno-4-118"></a><span class="w">            </span><span class="no">echo &quot;Target process identified: PID \$TARGET_PID&quot;</span>
</span><span id="__span-4-119"><a id="__codelineno-4-119" name="__codelineno-4-119"></a>
</span><span id="__span-4-120"><a id="__codelineno-4-120" name="__codelineno-4-120"></a><span class="w">            </span><span class="no"># Run CINC Auditor against the target filesystem</span>
</span><span id="__span-4-121"><a id="__codelineno-4-121" name="__codelineno-4-121"></a><span class="w">            </span><span class="no">cd /</span>
</span><span id="__span-4-122"><a id="__codelineno-4-122" name="__codelineno-4-122"></a><span class="w">            </span><span class="no">cinc-auditor exec /opt/profiles/container-baseline \</span>
</span><span id="__span-4-123"><a id="__codelineno-4-123" name="__codelineno-4-123"></a><span class="w">              </span><span class="no">-b os=linux \</span>
</span><span id="__span-4-124"><a id="__codelineno-4-124" name="__codelineno-4-124"></a><span class="w">              </span><span class="no">--target=/proc/\$TARGET_PID/root \</span>
</span><span id="__span-4-125"><a id="__codelineno-4-125" name="__codelineno-4-125"></a><span class="w">              </span><span class="no">--reporter cli json:/results/scan-results.json</span>
</span><span id="__span-4-126"><a id="__codelineno-4-126" name="__codelineno-4-126"></a>
</span><span id="__span-4-127"><a id="__codelineno-4-127" name="__codelineno-4-127"></a><span class="w">            </span><span class="no">SCAN_EXIT_CODE=\$?</span>
</span><span id="__span-4-128"><a id="__codelineno-4-128" name="__codelineno-4-128"></a>
</span><span id="__span-4-129"><a id="__codelineno-4-129" name="__codelineno-4-129"></a><span class="w">            </span><span class="no">echo &quot;Scan completed with exit code: \$SCAN_EXIT_CODE&quot;</span>
</span><span id="__span-4-130"><a id="__codelineno-4-130" name="__codelineno-4-130"></a>
</span><span id="__span-4-131"><a id="__codelineno-4-131" name="__codelineno-4-131"></a><span class="w">            </span><span class="no"># Process results with SAF</span>
</span><span id="__span-4-132"><a id="__codelineno-4-132" name="__codelineno-4-132"></a><span class="w">            </span><span class="no">if [ -f &quot;/results/scan-results.json&quot; ]; then</span>
</span><span id="__span-4-133"><a id="__codelineno-4-133" name="__codelineno-4-133"></a><span class="w">              </span><span class="no">echo &quot;Processing results with SAF CLI...&quot;</span>
</span><span id="__span-4-134"><a id="__codelineno-4-134" name="__codelineno-4-134"></a><span class="w">              </span><span class="no">saf summary --input /results/scan-results.json --output-md /results/scan-summary.md</span>
</span><span id="__span-4-135"><a id="__codelineno-4-135" name="__codelineno-4-135"></a>
</span><span id="__span-4-136"><a id="__codelineno-4-136" name="__codelineno-4-136"></a><span class="w">              </span><span class="no"># Validate against threshold</span>
</span><span id="__span-4-137"><a id="__codelineno-4-137" name="__codelineno-4-137"></a><span class="w">              </span><span class="no">if [ -f &quot;/opt/thresholds/threshold.yml&quot; ]; then</span>
</span><span id="__span-4-138"><a id="__codelineno-4-138" name="__codelineno-4-138"></a><span class="w">                </span><span class="no">echo &quot;Validating against threshold...&quot;</span>
</span><span id="__span-4-139"><a id="__codelineno-4-139" name="__codelineno-4-139"></a><span class="w">                </span><span class="no">saf threshold -i /results/scan-results.json -t /opt/thresholds/threshold.yml</span>
</span><span id="__span-4-140"><a id="__codelineno-4-140" name="__codelineno-4-140"></a><span class="w">                </span><span class="no">THRESHOLD_RESULT=\$?</span>
</span><span id="__span-4-141"><a id="__codelineno-4-141" name="__codelineno-4-141"></a><span class="w">                </span><span class="no">echo &quot;Threshold validation result: \$THRESHOLD_RESULT&quot; &gt; /results/threshold-result.txt</span>
</span><span id="__span-4-142"><a id="__codelineno-4-142" name="__codelineno-4-142"></a><span class="w">              </span><span class="no">fi</span>
</span><span id="__span-4-143"><a id="__codelineno-4-143" name="__codelineno-4-143"></a><span class="w">            </span><span class="no">fi</span>
</span><span id="__span-4-144"><a id="__codelineno-4-144" name="__codelineno-4-144"></a>
</span><span id="__span-4-145"><a id="__codelineno-4-145" name="__codelineno-4-145"></a><span class="w">            </span><span class="no"># Indicate scan is complete</span>
</span><span id="__span-4-146"><a id="__codelineno-4-146" name="__codelineno-4-146"></a><span class="w">            </span><span class="no">touch /results/scan-complete</span>
</span><span id="__span-4-147"><a id="__codelineno-4-147" name="__codelineno-4-147"></a>
</span><span id="__span-4-148"><a id="__codelineno-4-148" name="__codelineno-4-148"></a><span class="w">            </span><span class="no"># Keep container running briefly to allow result retrieval</span>
</span><span id="__span-4-149"><a id="__codelineno-4-149" name="__codelineno-4-149"></a><span class="w">            </span><span class="no">echo &quot;Scan complete. Results available in /results directory.&quot;</span>
</span><span id="__span-4-150"><a id="__codelineno-4-150" name="__codelineno-4-150"></a><span class="w">            </span><span class="no">sleep 300</span>
</span><span id="__span-4-151"><a id="__codelineno-4-151" name="__codelineno-4-151"></a><span class="w">          </span><span class="no">volumeMounts:</span>
</span><span id="__span-4-152"><a id="__codelineno-4-152" name="__codelineno-4-152"></a><span class="w">          </span><span class="no">- name: shared-results</span>
</span><span id="__span-4-153"><a id="__codelineno-4-153" name="__codelineno-4-153"></a><span class="w">            </span><span class="no">mountPath: /results</span>
</span><span id="__span-4-154"><a id="__codelineno-4-154" name="__codelineno-4-154"></a><span class="w">          </span><span class="no">- name: profiles</span>
</span><span id="__span-4-155"><a id="__codelineno-4-155" name="__codelineno-4-155"></a><span class="w">            </span><span class="no">mountPath: /opt/profiles</span>
</span><span id="__span-4-156"><a id="__codelineno-4-156" name="__codelineno-4-156"></a><span class="w">          </span><span class="no">- name: thresholds</span>
</span><span id="__span-4-157"><a id="__codelineno-4-157" name="__codelineno-4-157"></a><span class="w">            </span><span class="no">mountPath: /opt/thresholds</span>
</span><span id="__span-4-158"><a id="__codelineno-4-158" name="__codelineno-4-158"></a>
</span><span id="__span-4-159"><a id="__codelineno-4-159" name="__codelineno-4-159"></a><span class="w">        </span><span class="no">volumes:</span>
</span><span id="__span-4-160"><a id="__codelineno-4-160" name="__codelineno-4-160"></a><span class="w">        </span><span class="no">- name: shared-results</span>
</span><span id="__span-4-161"><a id="__codelineno-4-161" name="__codelineno-4-161"></a><span class="w">          </span><span class="no">emptyDir: {}</span>
</span><span id="__span-4-162"><a id="__codelineno-4-162" name="__codelineno-4-162"></a><span class="w">        </span><span class="no">- name: profiles</span>
</span><span id="__span-4-163"><a id="__codelineno-4-163" name="__codelineno-4-163"></a><span class="w">          </span><span class="no">configMap:</span>
</span><span id="__span-4-164"><a id="__codelineno-4-164" name="__codelineno-4-164"></a><span class="w">            </span><span class="no">name: inspec-profiles-${CI_PIPELINE_ID}</span>
</span><span id="__span-4-165"><a id="__codelineno-4-165" name="__codelineno-4-165"></a><span class="w">        </span><span class="no">- name: thresholds</span>
</span><span id="__span-4-166"><a id="__codelineno-4-166" name="__codelineno-4-166"></a><span class="w">          </span><span class="no">configMap:</span>
</span><span id="__span-4-167"><a id="__codelineno-4-167" name="__codelineno-4-167"></a><span class="w">            </span><span class="no">name: inspec-thresholds-${CI_PIPELINE_ID}</span>
</span><span id="__span-4-168"><a id="__codelineno-4-168" name="__codelineno-4-168"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-4-169"><a id="__codelineno-4-169" name="__codelineno-4-169"></a>
</span><span id="__span-4-170"><a id="__codelineno-4-170" name="__codelineno-4-170"></a><span class="w">      </span><span class="no"># Wait for pod to be ready</span>
</span><span id="__span-4-171"><a id="__codelineno-4-171" name="__codelineno-4-171"></a><span class="w">      </span><span class="no">kubectl wait --for=condition=ready pod/app-scanner-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE} --timeout=300s</span>
</span><span id="__span-4-172"><a id="__codelineno-4-172" name="__codelineno-4-172"></a>
</span><span id="__span-4-173"><a id="__codelineno-4-173" name="__codelineno-4-173"></a><span class="w">      </span><span class="no"># Save pod name for later stages</span>
</span><span id="__span-4-174"><a id="__codelineno-4-174" name="__codelineno-4-174"></a><span class="w">      </span><span class="no">echo &quot;SCANNER_POD=app-scanner-${CI_PIPELINE_ID}&quot; &gt;&gt; deploy.env</span>
</span><span id="__span-4-175"><a id="__codelineno-4-175" name="__codelineno-4-175"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-4-176"><a id="__codelineno-4-176" name="__codelineno-4-176"></a><span class="w">      </span><span class="no"># Verify the pod is ready</span>
</span><span id="__span-4-177"><a id="__codelineno-4-177" name="__codelineno-4-177"></a><span class="w">      </span><span class="no">kubectl get pod app-scanner-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE}</span>
</span><span id="__span-4-178"><a id="__codelineno-4-178" name="__codelineno-4-178"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-4-179"><a id="__codelineno-4-179" name="__codelineno-4-179"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-4-180"><a id="__codelineno-4-180" name="__codelineno-4-180"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy.env</span>
</span><span id="__span-4-181"><a id="__codelineno-4-181" name="__codelineno-4-181"></a>
</span><span id="__span-4-182"><a id="__codelineno-4-182" name="__codelineno-4-182"></a><span class="nt">retrieve_results</span><span class="p">:</span>
</span><span id="__span-4-183"><a id="__codelineno-4-183" name="__codelineno-4-183"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-4-184"><a id="__codelineno-4-184" name="__codelineno-4-184"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">deploy_sidecar_pod</span><span class="p p-Indicator">]</span>
</span><span id="__span-4-185"><a id="__codelineno-4-185" name="__codelineno-4-185"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-4-186"><a id="__codelineno-4-186" name="__codelineno-4-186"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-4-187"><a id="__codelineno-4-187" name="__codelineno-4-187"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-4-188"><a id="__codelineno-4-188" name="__codelineno-4-188"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-4-189"><a id="__codelineno-4-189" name="__codelineno-4-189"></a><span class="w">      </span><span class="no"># Wait for scan to complete</span>
</span><span id="__span-4-190"><a id="__codelineno-4-190" name="__codelineno-4-190"></a><span class="w">      </span><span class="no">echo &quot;Waiting for scan to complete...&quot;</span>
</span><span id="__span-4-191"><a id="__codelineno-4-191" name="__codelineno-4-191"></a><span class="w">      </span><span class="no">until kubectl exec -it ${SCANNER_POD} -n ${SCANNER_NAMESPACE} -c scanner -- ls /results/scan-complete &gt;/dev/null 2&gt;&amp;1; do</span>
</span><span id="__span-4-192"><a id="__codelineno-4-192" name="__codelineno-4-192"></a><span class="w">        </span><span class="no">echo &quot;Scan in progress...&quot;</span>
</span><span id="__span-4-193"><a id="__codelineno-4-193" name="__codelineno-4-193"></a><span class="w">        </span><span class="no">sleep 5</span>
</span><span id="__span-4-194"><a id="__codelineno-4-194" name="__codelineno-4-194"></a><span class="w">      </span><span class="no">done</span>
</span><span id="__span-4-195"><a id="__codelineno-4-195" name="__codelineno-4-195"></a>
</span><span id="__span-4-196"><a id="__codelineno-4-196" name="__codelineno-4-196"></a><span class="w">      </span><span class="no"># Retrieve scan results</span>
</span><span id="__span-4-197"><a id="__codelineno-4-197" name="__codelineno-4-197"></a><span class="w">      </span><span class="no">echo &quot;Retrieving scan results...&quot;</span>
</span><span id="__span-4-198"><a id="__codelineno-4-198" name="__codelineno-4-198"></a><span class="w">      </span><span class="no">kubectl cp ${SCANNER_NAMESPACE}/${SCANNER_POD}:/results/scan-results.json ./scan-results.json -c scanner</span>
</span><span id="__span-4-199"><a id="__codelineno-4-199" name="__codelineno-4-199"></a><span class="w">      </span><span class="no">kubectl cp ${SCANNER_NAMESPACE}/${SCANNER_POD}:/results/scan-summary.md ./scan-summary.md -c scanner</span>
</span><span id="__span-4-200"><a id="__codelineno-4-200" name="__codelineno-4-200"></a>
</span><span id="__span-4-201"><a id="__codelineno-4-201" name="__codelineno-4-201"></a><span class="w">      </span><span class="no"># Check threshold result</span>
</span><span id="__span-4-202"><a id="__codelineno-4-202" name="__codelineno-4-202"></a><span class="w">      </span><span class="no">if kubectl exec -it ${SCANNER_POD} -n ${SCANNER_NAMESPACE} -c scanner -- cat /results/threshold-result.txt &gt;/dev/null 2&gt;&amp;1; then</span>
</span><span id="__span-4-203"><a id="__codelineno-4-203" name="__codelineno-4-203"></a><span class="w">        </span><span class="no">THRESHOLD_RESULT=$(kubectl exec -it ${SCANNER_POD} -n ${SCANNER_NAMESPACE} -c scanner -- cat /results/threshold-result.txt)</span>
</span><span id="__span-4-204"><a id="__codelineno-4-204" name="__codelineno-4-204"></a><span class="w">        </span><span class="no">echo &quot;THRESHOLD_PASSED=${THRESHOLD_RESULT}&quot; &gt;&gt; scan.env</span>
</span><span id="__span-4-205"><a id="__codelineno-4-205" name="__codelineno-4-205"></a>
</span><span id="__span-4-206"><a id="__codelineno-4-206" name="__codelineno-4-206"></a><span class="w">        </span><span class="no">if [ &quot;${THRESHOLD_RESULT}&quot; -eq 0 ]; then</span>
</span><span id="__span-4-207"><a id="__codelineno-4-207" name="__codelineno-4-207"></a><span class="w">          </span><span class="no">echo &quot; Security scan passed threshold requirements&quot;</span>
</span><span id="__span-4-208"><a id="__codelineno-4-208" name="__codelineno-4-208"></a><span class="w">        </span><span class="no">else</span>
</span><span id="__span-4-209"><a id="__codelineno-4-209" name="__codelineno-4-209"></a><span class="w">          </span><span class="no">echo &quot; Security scan failed to meet threshold requirements&quot;</span>
</span><span id="__span-4-210"><a id="__codelineno-4-210" name="__codelineno-4-210"></a><span class="w">        </span><span class="no">fi</span>
</span><span id="__span-4-211"><a id="__codelineno-4-211" name="__codelineno-4-211"></a><span class="w">      </span><span class="no">else</span>
</span><span id="__span-4-212"><a id="__codelineno-4-212" name="__codelineno-4-212"></a><span class="w">        </span><span class="no">echo &quot;Warning: Threshold result not found&quot;</span>
</span><span id="__span-4-213"><a id="__codelineno-4-213" name="__codelineno-4-213"></a><span class="w">        </span><span class="no">echo &quot;THRESHOLD_PASSED=1&quot; &gt;&gt; scan.env</span>
</span><span id="__span-4-214"><a id="__codelineno-4-214" name="__codelineno-4-214"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-4-215"><a id="__codelineno-4-215" name="__codelineno-4-215"></a>
</span><span id="__span-4-216"><a id="__codelineno-4-216" name="__codelineno-4-216"></a><span class="w">      </span><span class="no"># Display summary in job output</span>
</span><span id="__span-4-217"><a id="__codelineno-4-217" name="__codelineno-4-217"></a><span class="w">      </span><span class="no">echo &quot;============= SCAN SUMMARY =============&quot;</span>
</span><span id="__span-4-218"><a id="__codelineno-4-218" name="__codelineno-4-218"></a><span class="w">      </span><span class="no">cat scan-summary.md</span>
</span><span id="__span-4-219"><a id="__codelineno-4-219" name="__codelineno-4-219"></a><span class="w">      </span><span class="no">echo &quot;========================================&quot;</span>
</span><span id="__span-4-220"><a id="__codelineno-4-220" name="__codelineno-4-220"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-4-221"><a id="__codelineno-4-221" name="__codelineno-4-221"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-4-222"><a id="__codelineno-4-222" name="__codelineno-4-222"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-results.json</span>
</span><span id="__span-4-223"><a id="__codelineno-4-223" name="__codelineno-4-223"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-summary.md</span>
</span><span id="__span-4-224"><a id="__codelineno-4-224" name="__codelineno-4-224"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-4-225"><a id="__codelineno-4-225" name="__codelineno-4-225"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan.env</span>
</span><span id="__span-4-226"><a id="__codelineno-4-226" name="__codelineno-4-226"></a>
</span><span id="__span-4-227"><a id="__codelineno-4-227" name="__codelineno-4-227"></a><span class="nt">generate_report</span><span class="p">:</span>
</span><span id="__span-4-228"><a id="__codelineno-4-228" name="__codelineno-4-228"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">report</span>
</span><span id="__span-4-229"><a id="__codelineno-4-229" name="__codelineno-4-229"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">retrieve_results</span><span class="p p-Indicator">]</span>
</span><span id="__span-4-230"><a id="__codelineno-4-230" name="__codelineno-4-230"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-4-231"><a id="__codelineno-4-231" name="__codelineno-4-231"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-4-232"><a id="__codelineno-4-232" name="__codelineno-4-232"></a><span class="w">      </span><span class="no"># Install SAF CLI if needed in this stage</span>
</span><span id="__span-4-233"><a id="__codelineno-4-233" name="__codelineno-4-233"></a><span class="w">      </span><span class="no">which saf || npm install -g @mitre/saf</span>
</span><span id="__span-4-234"><a id="__codelineno-4-234" name="__codelineno-4-234"></a>
</span><span id="__span-4-235"><a id="__codelineno-4-235" name="__codelineno-4-235"></a><span class="w">      </span><span class="no"># Generate a more comprehensive report</span>
</span><span id="__span-4-236"><a id="__codelineno-4-236" name="__codelineno-4-236"></a><span class="w">      </span><span class="no">saf view -i scan-results.json --output scan-report.html</span>
</span><span id="__span-4-237"><a id="__codelineno-4-237" name="__codelineno-4-237"></a>
</span><span id="__span-4-238"><a id="__codelineno-4-238" name="__codelineno-4-238"></a><span class="w">      </span><span class="no"># Create a simple markdown report for the MR</span>
</span><span id="__span-4-239"><a id="__codelineno-4-239" name="__codelineno-4-239"></a><span class="w">      </span><span class="no">cat &gt; scan-report.md &lt;&lt; EOF</span>
</span><span id="__span-4-240"><a id="__codelineno-4-240" name="__codelineno-4-240"></a><span class="w">      </span><span class="no"># Security Scan Results</span>
</span><span id="__span-4-241"><a id="__codelineno-4-241" name="__codelineno-4-241"></a>
</span><span id="__span-4-242"><a id="__codelineno-4-242" name="__codelineno-4-242"></a><span class="w">      </span><span class="no">## Summary</span>
</span><span id="__span-4-243"><a id="__codelineno-4-243" name="__codelineno-4-243"></a>
</span><span id="__span-4-244"><a id="__codelineno-4-244" name="__codelineno-4-244"></a><span class="w">      </span><span class="no">$(cat scan-summary.md)</span>
</span><span id="__span-4-245"><a id="__codelineno-4-245" name="__codelineno-4-245"></a>
</span><span id="__span-4-246"><a id="__codelineno-4-246" name="__codelineno-4-246"></a><span class="w">      </span><span class="no">## Threshold Check</span>
</span><span id="__span-4-247"><a id="__codelineno-4-247" name="__codelineno-4-247"></a>
</span><span id="__span-4-248"><a id="__codelineno-4-248" name="__codelineno-4-248"></a><span class="w">      </span><span class="no">${THRESHOLD_PASSED} -eq 0 &amp;&amp; echo &quot; **PASSED**&quot; || echo &quot; **FAILED**&quot;</span>
</span><span id="__span-4-249"><a id="__codelineno-4-249" name="__codelineno-4-249"></a>
</span><span id="__span-4-250"><a id="__codelineno-4-250" name="__codelineno-4-250"></a><span class="w">      </span><span class="no">Threshold: ${THRESHOLD_VALUE}%</span>
</span><span id="__span-4-251"><a id="__codelineno-4-251" name="__codelineno-4-251"></a>
</span><span id="__span-4-252"><a id="__codelineno-4-252" name="__codelineno-4-252"></a><span class="w">      </span><span class="no">## Details</span>
</span><span id="__span-4-253"><a id="__codelineno-4-253" name="__codelineno-4-253"></a>
</span><span id="__span-4-254"><a id="__codelineno-4-254" name="__codelineno-4-254"></a><span class="w">      </span><span class="no">For full results, see the artifacts.</span>
</span><span id="__span-4-255"><a id="__codelineno-4-255" name="__codelineno-4-255"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-4-256"><a id="__codelineno-4-256" name="__codelineno-4-256"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-4-257"><a id="__codelineno-4-257" name="__codelineno-4-257"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-4-258"><a id="__codelineno-4-258" name="__codelineno-4-258"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-report.html</span>
</span><span id="__span-4-259"><a id="__codelineno-4-259" name="__codelineno-4-259"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-report.md</span>
</span><span id="__span-4-260"><a id="__codelineno-4-260" name="__codelineno-4-260"></a><span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
</span><span id="__span-4-261"><a id="__codelineno-4-261" name="__codelineno-4-261"></a>
</span><span id="__span-4-262"><a id="__codelineno-4-262" name="__codelineno-4-262"></a><span class="nt">cleanup</span><span class="p">:</span>
</span><span id="__span-4-263"><a id="__codelineno-4-263" name="__codelineno-4-263"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-4-264"><a id="__codelineno-4-264" name="__codelineno-4-264"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">retrieve_results</span><span class="p p-Indicator">]</span>
</span><span id="__span-4-265"><a id="__codelineno-4-265" name="__codelineno-4-265"></a><span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span><span class="w">  </span><span class="c1"># Run even if previous stages failed</span>
</span><span id="__span-4-266"><a id="__codelineno-4-266" name="__codelineno-4-266"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-4-267"><a id="__codelineno-4-267" name="__codelineno-4-267"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-4-268"><a id="__codelineno-4-268" name="__codelineno-4-268"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-4-269"><a id="__codelineno-4-269" name="__codelineno-4-269"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-4-270"><a id="__codelineno-4-270" name="__codelineno-4-270"></a><span class="w">      </span><span class="no"># Delete all resources</span>
</span><span id="__span-4-271"><a id="__codelineno-4-271" name="__codelineno-4-271"></a><span class="w">      </span><span class="no">kubectl delete pod/${SCANNER_POD} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-4-272"><a id="__codelineno-4-272" name="__codelineno-4-272"></a><span class="w">      </span><span class="no">kubectl delete configmap/inspec-profiles-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-4-273"><a id="__codelineno-4-273" name="__codelineno-4-273"></a><span class="w">      </span><span class="no">kubectl delete configmap/inspec-thresholds-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="sidecar-with-services-pipeline">Sidecar with Services Pipeline<a class="headerlink" href="#sidecar-with-services-pipeline" title="Permanent link">&para;</a></h2>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">  1</a></span>
<span class="normal"><a href="#__codelineno-5-2">  2</a></span>
<span class="normal"><a href="#__codelineno-5-3">  3</a></span>
<span class="normal"><a href="#__codelineno-5-4">  4</a></span>
<span class="normal"><a href="#__codelineno-5-5">  5</a></span>
<span class="normal"><a href="#__codelineno-5-6">  6</a></span>
<span class="normal"><a href="#__codelineno-5-7">  7</a></span>
<span class="normal"><a href="#__codelineno-5-8">  8</a></span>
<span class="normal"><a href="#__codelineno-5-9">  9</a></span>
<span class="normal"><a href="#__codelineno-5-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-5-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-5-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-5-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-5-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-5-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-5-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-5-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-5-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-5-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-5-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-5-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-5-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-5-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-5-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-5-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-5-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-5-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-5-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-5-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-5-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-5-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-5-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-5-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-5-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-5-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-5-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-5-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-5-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-5-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-5-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-5-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-5-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-5-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-5-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-5-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-5-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-5-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-5-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-5-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-5-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-5-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-5-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-5-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-5-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-5-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-5-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-5-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-5-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-5-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-5-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-5-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-5-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-5-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-5-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-5-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-5-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-5-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-5-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-5-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-5-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-5-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-5-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-5-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-5-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-5-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-5-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-5-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-5-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-5-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-5-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-5-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-5-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-5-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-5-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-5-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-5-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-5-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-5-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-5-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-5-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-5-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-5-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-5-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-5-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-5-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-5-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-5-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-5-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-5-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-5-100">100</a></span>
<span class="normal"><a href="#__codelineno-5-101">101</a></span>
<span class="normal"><a href="#__codelineno-5-102">102</a></span>
<span class="normal"><a href="#__codelineno-5-103">103</a></span>
<span class="normal"><a href="#__codelineno-5-104">104</a></span>
<span class="normal"><a href="#__codelineno-5-105">105</a></span>
<span class="normal"><a href="#__codelineno-5-106">106</a></span>
<span class="normal"><a href="#__codelineno-5-107">107</a></span>
<span class="normal"><a href="#__codelineno-5-108">108</a></span>
<span class="normal"><a href="#__codelineno-5-109">109</a></span>
<span class="normal"><a href="#__codelineno-5-110">110</a></span>
<span class="normal"><a href="#__codelineno-5-111">111</a></span>
<span class="normal"><a href="#__codelineno-5-112">112</a></span>
<span class="normal"><a href="#__codelineno-5-113">113</a></span>
<span class="normal"><a href="#__codelineno-5-114">114</a></span>
<span class="normal"><a href="#__codelineno-5-115">115</a></span>
<span class="normal"><a href="#__codelineno-5-116">116</a></span>
<span class="normal"><a href="#__codelineno-5-117">117</a></span>
<span class="normal"><a href="#__codelineno-5-118">118</a></span>
<span class="normal"><a href="#__codelineno-5-119">119</a></span>
<span class="normal"><a href="#__codelineno-5-120">120</a></span>
<span class="normal"><a href="#__codelineno-5-121">121</a></span>
<span class="normal"><a href="#__codelineno-5-122">122</a></span>
<span class="normal"><a href="#__codelineno-5-123">123</a></span>
<span class="normal"><a href="#__codelineno-5-124">124</a></span>
<span class="normal"><a href="#__codelineno-5-125">125</a></span>
<span class="normal"><a href="#__codelineno-5-126">126</a></span>
<span class="normal"><a href="#__codelineno-5-127">127</a></span>
<span class="normal"><a href="#__codelineno-5-128">128</a></span>
<span class="normal"><a href="#__codelineno-5-129">129</a></span>
<span class="normal"><a href="#__codelineno-5-130">130</a></span>
<span class="normal"><a href="#__codelineno-5-131">131</a></span>
<span class="normal"><a href="#__codelineno-5-132">132</a></span>
<span class="normal"><a href="#__codelineno-5-133">133</a></span>
<span class="normal"><a href="#__codelineno-5-134">134</a></span>
<span class="normal"><a href="#__codelineno-5-135">135</a></span>
<span class="normal"><a href="#__codelineno-5-136">136</a></span>
<span class="normal"><a href="#__codelineno-5-137">137</a></span>
<span class="normal"><a href="#__codelineno-5-138">138</a></span>
<span class="normal"><a href="#__codelineno-5-139">139</a></span>
<span class="normal"><a href="#__codelineno-5-140">140</a></span>
<span class="normal"><a href="#__codelineno-5-141">141</a></span>
<span class="normal"><a href="#__codelineno-5-142">142</a></span>
<span class="normal"><a href="#__codelineno-5-143">143</a></span>
<span class="normal"><a href="#__codelineno-5-144">144</a></span>
<span class="normal"><a href="#__codelineno-5-145">145</a></span>
<span class="normal"><a href="#__codelineno-5-146">146</a></span>
<span class="normal"><a href="#__codelineno-5-147">147</a></span>
<span class="normal"><a href="#__codelineno-5-148">148</a></span>
<span class="normal"><a href="#__codelineno-5-149">149</a></span>
<span class="normal"><a href="#__codelineno-5-150">150</a></span>
<span class="normal"><a href="#__codelineno-5-151">151</a></span>
<span class="normal"><a href="#__codelineno-5-152">152</a></span>
<span class="normal"><a href="#__codelineno-5-153">153</a></span>
<span class="normal"><a href="#__codelineno-5-154">154</a></span>
<span class="normal"><a href="#__codelineno-5-155">155</a></span>
<span class="normal"><a href="#__codelineno-5-156">156</a></span>
<span class="normal"><a href="#__codelineno-5-157">157</a></span>
<span class="normal"><a href="#__codelineno-5-158">158</a></span>
<span class="normal"><a href="#__codelineno-5-159">159</a></span>
<span class="normal"><a href="#__codelineno-5-160">160</a></span>
<span class="normal"><a href="#__codelineno-5-161">161</a></span>
<span class="normal"><a href="#__codelineno-5-162">162</a></span>
<span class="normal"><a href="#__codelineno-5-163">163</a></span>
<span class="normal"><a href="#__codelineno-5-164">164</a></span>
<span class="normal"><a href="#__codelineno-5-165">165</a></span>
<span class="normal"><a href="#__codelineno-5-166">166</a></span>
<span class="normal"><a href="#__codelineno-5-167">167</a></span>
<span class="normal"><a href="#__codelineno-5-168">168</a></span>
<span class="normal"><a href="#__codelineno-5-169">169</a></span>
<span class="normal"><a href="#__codelineno-5-170">170</a></span>
<span class="normal"><a href="#__codelineno-5-171">171</a></span>
<span class="normal"><a href="#__codelineno-5-172">172</a></span>
<span class="normal"><a href="#__codelineno-5-173">173</a></span>
<span class="normal"><a href="#__codelineno-5-174">174</a></span>
<span class="normal"><a href="#__codelineno-5-175">175</a></span>
<span class="normal"><a href="#__codelineno-5-176">176</a></span>
<span class="normal"><a href="#__codelineno-5-177">177</a></span>
<span class="normal"><a href="#__codelineno-5-178">178</a></span>
<span class="normal"><a href="#__codelineno-5-179">179</a></span>
<span class="normal"><a href="#__codelineno-5-180">180</a></span>
<span class="normal"><a href="#__codelineno-5-181">181</a></span>
<span class="normal"><a href="#__codelineno-5-182">182</a></span>
<span class="normal"><a href="#__codelineno-5-183">183</a></span>
<span class="normal"><a href="#__codelineno-5-184">184</a></span>
<span class="normal"><a href="#__codelineno-5-185">185</a></span>
<span class="normal"><a href="#__codelineno-5-186">186</a></span>
<span class="normal"><a href="#__codelineno-5-187">187</a></span>
<span class="normal"><a href="#__codelineno-5-188">188</a></span>
<span class="normal"><a href="#__codelineno-5-189">189</a></span>
<span class="normal"><a href="#__codelineno-5-190">190</a></span>
<span class="normal"><a href="#__codelineno-5-191">191</a></span>
<span class="normal"><a href="#__codelineno-5-192">192</a></span>
<span class="normal"><a href="#__codelineno-5-193">193</a></span>
<span class="normal"><a href="#__codelineno-5-194">194</a></span>
<span class="normal"><a href="#__codelineno-5-195">195</a></span>
<span class="normal"><a href="#__codelineno-5-196">196</a></span>
<span class="normal"><a href="#__codelineno-5-197">197</a></span>
<span class="normal"><a href="#__codelineno-5-198">198</a></span>
<span class="normal"><a href="#__codelineno-5-199">199</a></span>
<span class="normal"><a href="#__codelineno-5-200">200</a></span>
<span class="normal"><a href="#__codelineno-5-201">201</a></span>
<span class="normal"><a href="#__codelineno-5-202">202</a></span>
<span class="normal"><a href="#__codelineno-5-203">203</a></span>
<span class="normal"><a href="#__codelineno-5-204">204</a></span>
<span class="normal"><a href="#__codelineno-5-205">205</a></span>
<span class="normal"><a href="#__codelineno-5-206">206</a></span>
<span class="normal"><a href="#__codelineno-5-207">207</a></span>
<span class="normal"><a href="#__codelineno-5-208">208</a></span>
<span class="normal"><a href="#__codelineno-5-209">209</a></span>
<span class="normal"><a href="#__codelineno-5-210">210</a></span>
<span class="normal"><a href="#__codelineno-5-211">211</a></span>
<span class="normal"><a href="#__codelineno-5-212">212</a></span>
<span class="normal"><a href="#__codelineno-5-213">213</a></span>
<span class="normal"><a href="#__codelineno-5-214">214</a></span>
<span class="normal"><a href="#__codelineno-5-215">215</a></span>
<span class="normal"><a href="#__codelineno-5-216">216</a></span>
<span class="normal"><a href="#__codelineno-5-217">217</a></span>
<span class="normal"><a href="#__codelineno-5-218">218</a></span>
<span class="normal"><a href="#__codelineno-5-219">219</a></span>
<span class="normal"><a href="#__codelineno-5-220">220</a></span>
<span class="normal"><a href="#__codelineno-5-221">221</a></span>
<span class="normal"><a href="#__codelineno-5-222">222</a></span>
<span class="normal"><a href="#__codelineno-5-223">223</a></span>
<span class="normal"><a href="#__codelineno-5-224">224</a></span>
<span class="normal"><a href="#__codelineno-5-225">225</a></span>
<span class="normal"><a href="#__codelineno-5-226">226</a></span>
<span class="normal"><a href="#__codelineno-5-227">227</a></span>
<span class="normal"><a href="#__codelineno-5-228">228</a></span>
<span class="normal"><a href="#__codelineno-5-229">229</a></span>
<span class="normal"><a href="#__codelineno-5-230">230</a></span>
<span class="normal"><a href="#__codelineno-5-231">231</a></span>
<span class="normal"><a href="#__codelineno-5-232">232</a></span>
<span class="normal"><a href="#__codelineno-5-233">233</a></span>
<span class="normal"><a href="#__codelineno-5-234">234</a></span>
<span class="normal"><a href="#__codelineno-5-235">235</a></span>
<span class="normal"><a href="#__codelineno-5-236">236</a></span>
<span class="normal"><a href="#__codelineno-5-237">237</a></span>
<span class="normal"><a href="#__codelineno-5-238">238</a></span>
<span class="normal"><a href="#__codelineno-5-239">239</a></span>
<span class="normal"><a href="#__codelineno-5-240">240</a></span>
<span class="normal"><a href="#__codelineno-5-241">241</a></span>
<span class="normal"><a href="#__codelineno-5-242">242</a></span>
<span class="normal"><a href="#__codelineno-5-243">243</a></span>
<span class="normal"><a href="#__codelineno-5-244">244</a></span>
<span class="normal"><a href="#__codelineno-5-245">245</a></span>
<span class="normal"><a href="#__codelineno-5-246">246</a></span>
<span class="normal"><a href="#__codelineno-5-247">247</a></span>
<span class="normal"><a href="#__codelineno-5-248">248</a></span>
<span class="normal"><a href="#__codelineno-5-249">249</a></span>
<span class="normal"><a href="#__codelineno-5-250">250</a></span>
<span class="normal"><a href="#__codelineno-5-251">251</a></span>
<span class="normal"><a href="#__codelineno-5-252">252</a></span>
<span class="normal"><a href="#__codelineno-5-253">253</a></span>
<span class="normal"><a href="#__codelineno-5-254">254</a></span>
<span class="normal"><a href="#__codelineno-5-255">255</a></span>
<span class="normal"><a href="#__codelineno-5-256">256</a></span>
<span class="normal"><a href="#__codelineno-5-257">257</a></span>
<span class="normal"><a href="#__codelineno-5-258">258</a></span>
<span class="normal"><a href="#__codelineno-5-259">259</a></span>
<span class="normal"><a href="#__codelineno-5-260">260</a></span>
<span class="normal"><a href="#__codelineno-5-261">261</a></span>
<span class="normal"><a href="#__codelineno-5-262">262</a></span>
<span class="normal"><a href="#__codelineno-5-263">263</a></span>
<span class="normal"><a href="#__codelineno-5-264">264</a></span>
<span class="normal"><a href="#__codelineno-5-265">265</a></span>
<span class="normal"><a href="#__codelineno-5-266">266</a></span>
<span class="normal"><a href="#__codelineno-5-267">267</a></span>
<span class="normal"><a href="#__codelineno-5-268">268</a></span>
<span class="normal"><a href="#__codelineno-5-269">269</a></span>
<span class="normal"><a href="#__codelineno-5-270">270</a></span>
<span class="normal"><a href="#__codelineno-5-271">271</a></span>
<span class="normal"><a href="#__codelineno-5-272">272</a></span>
<span class="normal"><a href="#__codelineno-5-273">273</a></span>
<span class="normal"><a href="#__codelineno-5-274">274</a></span>
<span class="normal"><a href="#__codelineno-5-275">275</a></span>
<span class="normal"><a href="#__codelineno-5-276">276</a></span>
<span class="normal"><a href="#__codelineno-5-277">277</a></span>
<span class="normal"><a href="#__codelineno-5-278">278</a></span>
<span class="normal"><a href="#__codelineno-5-279">279</a></span>
<span class="normal"><a href="#__codelineno-5-280">280</a></span>
<span class="normal"><a href="#__codelineno-5-281">281</a></span>
<span class="normal"><a href="#__codelineno-5-282">282</a></span>
<span class="normal"><a href="#__codelineno-5-283">283</a></span>
<span class="normal"><a href="#__codelineno-5-284">284</a></span>
<span class="normal"><a href="#__codelineno-5-285">285</a></span>
<span class="normal"><a href="#__codelineno-5-286">286</a></span>
<span class="normal"><a href="#__codelineno-5-287">287</a></span>
<span class="normal"><a href="#__codelineno-5-288">288</a></span>
<span class="normal"><a href="#__codelineno-5-289">289</a></span>
<span class="normal"><a href="#__codelineno-5-290">290</a></span>
<span class="normal"><a href="#__codelineno-5-291">291</a></span>
<span class="normal"><a href="#__codelineno-5-292">292</a></span>
<span class="normal"><a href="#__codelineno-5-293">293</a></span>
<span class="normal"><a href="#__codelineno-5-294">294</a></span>
<span class="normal"><a href="#__codelineno-5-295">295</a></span>
<span class="normal"><a href="#__codelineno-5-296">296</a></span>
<span class="normal"><a href="#__codelineno-5-297">297</a></span>
<span class="normal"><a href="#__codelineno-5-298">298</a></span>
<span class="normal"><a href="#__codelineno-5-299">299</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nt">stages</span><span class="p">:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">report</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">  </span><span class="nt">SCANNER_NAMESPACE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;inspec-test&quot;</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">  </span><span class="nt">TARGET_LABEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app=target-app&quot;</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">  </span><span class="nt">THRESHOLD_VALUE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;70&quot;</span><span class="w">  </span><span class="c1"># Minimum passing score (0-100)</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">  </span><span class="nt">TARGET_IMAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;registry.example.com/my-image:latest&quot;</span><span class="w">  </span><span class="c1"># Target image to scan</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">  </span><span class="c1"># If scanning a distroless image, set this to true</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">  </span><span class="nt">IS_DISTROLESS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14"></a>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="c1"># Define a custom service image for CINC Auditor sidecar deployment</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.example.com/cinc-auditor-scanner:latest</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">    </span><span class="nt">alias</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cinc-scanner</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="w">    </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;infinity&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20"></a>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="nt">deploy_sidecar_pod</span><span class="p">:</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="w">      </span><span class="no"># Create the namespace if it doesn&#39;t exist</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="w">      </span><span class="no">kubectl get namespace ${SCANNER_NAMESPACE} || kubectl create namespace ${SCANNER_NAMESPACE}</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29"></a>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="w">      </span><span class="no"># Copy profile from within the service container</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="w">      </span><span class="no">docker cp ${CINC_PROFILE_PATH} cinc-scanner:/tmp/profile</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="w">      </span><span class="no">docker exec cinc-scanner ls -la /tmp/profile</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33"></a>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="w">      </span><span class="no"># Create ConfigMap for CINC profile from the service container</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35"></a><span class="w">      </span><span class="no">kubectl create configmap inspec-profiles-${CI_PIPELINE_ID} \</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="w">        </span><span class="no">--from-file=container-baseline=$(docker exec cinc-scanner find /tmp/profile -name &quot;*.rb&quot; | head -1) \</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37"></a><span class="w">        </span><span class="no">-n ${SCANNER_NAMESPACE}</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38"></a>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39"></a><span class="w">      </span><span class="no"># Create ConfigMap for threshold</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40"></a><span class="w">      </span><span class="no">cat &gt; threshold.yml &lt;&lt; EOF</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="w">      </span><span class="no">compliance:</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42"></a><span class="w">        </span><span class="no">min: ${THRESHOLD_VALUE}</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="w">      </span><span class="no">failed:</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="w">        </span><span class="no">critical:</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="w">          </span><span class="no">max: 0</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47"></a>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48"></a><span class="w">      </span><span class="no">kubectl create configmap inspec-thresholds-${CI_PIPELINE_ID} \</span>
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49"></a><span class="w">        </span><span class="no">--from-file=threshold.yml=threshold.yml \</span>
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50"></a><span class="w">        </span><span class="no">-n ${SCANNER_NAMESPACE}</span>
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51"></a>
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52"></a><span class="w">      </span><span class="no"># Deploy the pod with sidecar scanner</span>
</span><span id="__span-5-53"><a id="__codelineno-5-53" name="__codelineno-5-53"></a><span class="w">      </span><span class="no">cat &lt;&lt;EOF | kubectl apply -f -</span>
</span><span id="__span-5-54"><a id="__codelineno-5-54" name="__codelineno-5-54"></a><span class="w">      </span><span class="no">apiVersion: v1</span>
</span><span id="__span-5-55"><a id="__codelineno-5-55" name="__codelineno-5-55"></a><span class="w">      </span><span class="no">kind: Pod</span>
</span><span id="__span-5-56"><a id="__codelineno-5-56" name="__codelineno-5-56"></a><span class="w">      </span><span class="no">metadata:</span>
</span><span id="__span-5-57"><a id="__codelineno-5-57" name="__codelineno-5-57"></a><span class="w">        </span><span class="no">name: app-scanner-${CI_PIPELINE_ID}</span>
</span><span id="__span-5-58"><a id="__codelineno-5-58" name="__codelineno-5-58"></a><span class="w">        </span><span class="no">namespace: ${SCANNER_NAMESPACE}</span>
</span><span id="__span-5-59"><a id="__codelineno-5-59" name="__codelineno-5-59"></a><span class="w">        </span><span class="no">labels:</span>
</span><span id="__span-5-60"><a id="__codelineno-5-60" name="__codelineno-5-60"></a><span class="w">          </span><span class="no">app: scanner-pod</span>
</span><span id="__span-5-61"><a id="__codelineno-5-61" name="__codelineno-5-61"></a><span class="w">          </span><span class="no">pipeline: &quot;${CI_PIPELINE_ID}&quot;</span>
</span><span id="__span-5-62"><a id="__codelineno-5-62" name="__codelineno-5-62"></a><span class="w">      </span><span class="no">spec:</span>
</span><span id="__span-5-63"><a id="__codelineno-5-63" name="__codelineno-5-63"></a><span class="w">        </span><span class="no">shareProcessNamespace: true  # Enable shared process namespace</span>
</span><span id="__span-5-64"><a id="__codelineno-5-64" name="__codelineno-5-64"></a><span class="w">        </span><span class="no">containers:</span>
</span><span id="__span-5-65"><a id="__codelineno-5-65" name="__codelineno-5-65"></a><span class="w">        </span><span class="no"># Target container to be scanned</span>
</span><span id="__span-5-66"><a id="__codelineno-5-66" name="__codelineno-5-66"></a><span class="w">        </span><span class="no">- name: target</span>
</span><span id="__span-5-67"><a id="__codelineno-5-67" name="__codelineno-5-67"></a><span class="w">          </span><span class="no">image: ${TARGET_IMAGE}</span>
</span><span id="__span-5-68"><a id="__codelineno-5-68" name="__codelineno-5-68"></a><span class="w">          </span><span class="no">command: [&quot;sleep&quot;, &quot;3600&quot;]</span>
</span><span id="__span-5-69"><a id="__codelineno-5-69" name="__codelineno-5-69"></a><span class="w">          </span><span class="no"># For distroless containers, adjust command accordingly</span>
</span><span id="__span-5-70"><a id="__codelineno-5-70" name="__codelineno-5-70"></a>
</span><span id="__span-5-71"><a id="__codelineno-5-71" name="__codelineno-5-71"></a><span class="w">        </span><span class="no"># CINC Auditor scanner sidecar</span>
</span><span id="__span-5-72"><a id="__codelineno-5-72" name="__codelineno-5-72"></a><span class="w">        </span><span class="no">- name: scanner</span>
</span><span id="__span-5-73"><a id="__codelineno-5-73" name="__codelineno-5-73"></a><span class="w">          </span><span class="no">image: registry.example.com/cinc-auditor-scanner:latest</span>
</span><span id="__span-5-74"><a id="__codelineno-5-74" name="__codelineno-5-74"></a><span class="w">          </span><span class="no">command: </span>
</span><span id="__span-5-75"><a id="__codelineno-5-75" name="__codelineno-5-75"></a><span class="w">          </span><span class="no">- &quot;/bin/bash&quot;</span>
</span><span id="__span-5-76"><a id="__codelineno-5-76" name="__codelineno-5-76"></a><span class="w">          </span><span class="no">- &quot;-c&quot;</span>
</span><span id="__span-5-77"><a id="__codelineno-5-77" name="__codelineno-5-77"></a><span class="w">          </span><span class="no">- |</span>
</span><span id="__span-5-78"><a id="__codelineno-5-78" name="__codelineno-5-78"></a><span class="w">            </span><span class="no"># Wait for the main container to start</span>
</span><span id="__span-5-79"><a id="__codelineno-5-79" name="__codelineno-5-79"></a><span class="w">            </span><span class="no">sleep 10</span>
</span><span id="__span-5-80"><a id="__codelineno-5-80" name="__codelineno-5-80"></a>
</span><span id="__span-5-81"><a id="__codelineno-5-81" name="__codelineno-5-81"></a><span class="w">            </span><span class="no">echo &quot;Starting CINC Auditor scan...&quot;</span>
</span><span id="__span-5-82"><a id="__codelineno-5-82" name="__codelineno-5-82"></a>
</span><span id="__span-5-83"><a id="__codelineno-5-83" name="__codelineno-5-83"></a><span class="w">            </span><span class="no"># Find the main process of the target container</span>
</span><span id="__span-5-84"><a id="__codelineno-5-84" name="__codelineno-5-84"></a><span class="w">            </span><span class="no">TARGET_PID=$(ps aux | grep -v grep | grep &quot;sleep 3600&quot; | head -1 | awk &#39;{print $2}&#39;)</span>
</span><span id="__span-5-85"><a id="__codelineno-5-85" name="__codelineno-5-85"></a>
</span><span id="__span-5-86"><a id="__codelineno-5-86" name="__codelineno-5-86"></a><span class="w">            </span><span class="no">if [ -z &quot;$TARGET_PID&quot; ]; then</span>
</span><span id="__span-5-87"><a id="__codelineno-5-87" name="__codelineno-5-87"></a><span class="w">              </span><span class="no">echo &quot;ERROR: Could not find target process&quot;</span>
</span><span id="__span-5-88"><a id="__codelineno-5-88" name="__codelineno-5-88"></a><span class="w">              </span><span class="no">exit 1</span>
</span><span id="__span-5-89"><a id="__codelineno-5-89" name="__codelineno-5-89"></a><span class="w">            </span><span class="no">fi</span>
</span><span id="__span-5-90"><a id="__codelineno-5-90" name="__codelineno-5-90"></a>
</span><span id="__span-5-91"><a id="__codelineno-5-91" name="__codelineno-5-91"></a><span class="w">            </span><span class="no">echo &quot;Target process identified: PID $TARGET_PID&quot;</span>
</span><span id="__span-5-92"><a id="__codelineno-5-92" name="__codelineno-5-92"></a>
</span><span id="__span-5-93"><a id="__codelineno-5-93" name="__codelineno-5-93"></a><span class="w">            </span><span class="no"># Run CINC Auditor against the target filesystem</span>
</span><span id="__span-5-94"><a id="__codelineno-5-94" name="__codelineno-5-94"></a><span class="w">            </span><span class="no">cd /</span>
</span><span id="__span-5-95"><a id="__codelineno-5-95" name="__codelineno-5-95"></a><span class="w">            </span><span class="no">cinc-auditor exec /opt/profiles/container-baseline \</span>
</span><span id="__span-5-96"><a id="__codelineno-5-96" name="__codelineno-5-96"></a><span class="w">              </span><span class="no">-b os=linux \</span>
</span><span id="__span-5-97"><a id="__codelineno-5-97" name="__codelineno-5-97"></a><span class="w">              </span><span class="no">--target=/proc/$TARGET_PID/root \</span>
</span><span id="__span-5-98"><a id="__codelineno-5-98" name="__codelineno-5-98"></a><span class="w">              </span><span class="no">--reporter cli json:/results/scan-results.json</span>
</span><span id="__span-5-99"><a id="__codelineno-5-99" name="__codelineno-5-99"></a>
</span><span id="__span-5-100"><a id="__codelineno-5-100" name="__codelineno-5-100"></a><span class="w">            </span><span class="no">SCAN_EXIT_CODE=$?</span>
</span><span id="__span-5-101"><a id="__codelineno-5-101" name="__codelineno-5-101"></a>
</span><span id="__span-5-102"><a id="__codelineno-5-102" name="__codelineno-5-102"></a><span class="w">            </span><span class="no">echo &quot;Scan completed with exit code: $SCAN_EXIT_CODE&quot;</span>
</span><span id="__span-5-103"><a id="__codelineno-5-103" name="__codelineno-5-103"></a>
</span><span id="__span-5-104"><a id="__codelineno-5-104" name="__codelineno-5-104"></a><span class="w">            </span><span class="no"># Process results with SAF</span>
</span><span id="__span-5-105"><a id="__codelineno-5-105" name="__codelineno-5-105"></a><span class="w">            </span><span class="no">if [ -f &quot;/results/scan-results.json&quot; ]; then</span>
</span><span id="__span-5-106"><a id="__codelineno-5-106" name="__codelineno-5-106"></a><span class="w">              </span><span class="no">echo &quot;Processing results with SAF CLI...&quot;</span>
</span><span id="__span-5-107"><a id="__codelineno-5-107" name="__codelineno-5-107"></a><span class="w">              </span><span class="no">saf summary --input /results/scan-results.json --output-md /results/scan-summary.md</span>
</span><span id="__span-5-108"><a id="__codelineno-5-108" name="__codelineno-5-108"></a>
</span><span id="__span-5-109"><a id="__codelineno-5-109" name="__codelineno-5-109"></a><span class="w">              </span><span class="no"># Validate against threshold</span>
</span><span id="__span-5-110"><a id="__codelineno-5-110" name="__codelineno-5-110"></a><span class="w">              </span><span class="no">if [ -f &quot;/opt/thresholds/threshold.yml&quot; ]; then</span>
</span><span id="__span-5-111"><a id="__codelineno-5-111" name="__codelineno-5-111"></a><span class="w">                </span><span class="no">echo &quot;Validating against threshold...&quot;</span>
</span><span id="__span-5-112"><a id="__codelineno-5-112" name="__codelineno-5-112"></a><span class="w">                </span><span class="no">saf threshold -i /results/scan-results.json -t /opt/thresholds/threshold.yml</span>
</span><span id="__span-5-113"><a id="__codelineno-5-113" name="__codelineno-5-113"></a><span class="w">                </span><span class="no">THRESHOLD_RESULT=$?</span>
</span><span id="__span-5-114"><a id="__codelineno-5-114" name="__codelineno-5-114"></a><span class="w">                </span><span class="no">echo &quot;$THRESHOLD_RESULT&quot; &gt; /results/threshold-result.txt</span>
</span><span id="__span-5-115"><a id="__codelineno-5-115" name="__codelineno-5-115"></a><span class="w">              </span><span class="no">fi</span>
</span><span id="__span-5-116"><a id="__codelineno-5-116" name="__codelineno-5-116"></a><span class="w">            </span><span class="no">fi</span>
</span><span id="__span-5-117"><a id="__codelineno-5-117" name="__codelineno-5-117"></a>
</span><span id="__span-5-118"><a id="__codelineno-5-118" name="__codelineno-5-118"></a><span class="w">            </span><span class="no"># Indicate scan is complete</span>
</span><span id="__span-5-119"><a id="__codelineno-5-119" name="__codelineno-5-119"></a><span class="w">            </span><span class="no">touch /results/scan-complete</span>
</span><span id="__span-5-120"><a id="__codelineno-5-120" name="__codelineno-5-120"></a>
</span><span id="__span-5-121"><a id="__codelineno-5-121" name="__codelineno-5-121"></a><span class="w">            </span><span class="no"># Keep container running briefly to allow result retrieval</span>
</span><span id="__span-5-122"><a id="__codelineno-5-122" name="__codelineno-5-122"></a><span class="w">            </span><span class="no">echo &quot;Scan complete. Results available in /results directory.&quot;</span>
</span><span id="__span-5-123"><a id="__codelineno-5-123" name="__codelineno-5-123"></a><span class="w">            </span><span class="no">sleep 300</span>
</span><span id="__span-5-124"><a id="__codelineno-5-124" name="__codelineno-5-124"></a><span class="w">          </span><span class="no">volumeMounts:</span>
</span><span id="__span-5-125"><a id="__codelineno-5-125" name="__codelineno-5-125"></a><span class="w">          </span><span class="no">- name: shared-results</span>
</span><span id="__span-5-126"><a id="__codelineno-5-126" name="__codelineno-5-126"></a><span class="w">            </span><span class="no">mountPath: /results</span>
</span><span id="__span-5-127"><a id="__codelineno-5-127" name="__codelineno-5-127"></a><span class="w">          </span><span class="no">- name: profiles</span>
</span><span id="__span-5-128"><a id="__codelineno-5-128" name="__codelineno-5-128"></a><span class="w">            </span><span class="no">mountPath: /opt/profiles</span>
</span><span id="__span-5-129"><a id="__codelineno-5-129" name="__codelineno-5-129"></a><span class="w">          </span><span class="no">- name: thresholds</span>
</span><span id="__span-5-130"><a id="__codelineno-5-130" name="__codelineno-5-130"></a><span class="w">            </span><span class="no">mountPath: /opt/thresholds</span>
</span><span id="__span-5-131"><a id="__codelineno-5-131" name="__codelineno-5-131"></a>
</span><span id="__span-5-132"><a id="__codelineno-5-132" name="__codelineno-5-132"></a><span class="w">        </span><span class="no">volumes:</span>
</span><span id="__span-5-133"><a id="__codelineno-5-133" name="__codelineno-5-133"></a><span class="w">        </span><span class="no">- name: shared-results</span>
</span><span id="__span-5-134"><a id="__codelineno-5-134" name="__codelineno-5-134"></a><span class="w">          </span><span class="no">emptyDir: {}</span>
</span><span id="__span-5-135"><a id="__codelineno-5-135" name="__codelineno-5-135"></a><span class="w">        </span><span class="no">- name: profiles</span>
</span><span id="__span-5-136"><a id="__codelineno-5-136" name="__codelineno-5-136"></a><span class="w">          </span><span class="no">configMap:</span>
</span><span id="__span-5-137"><a id="__codelineno-5-137" name="__codelineno-5-137"></a><span class="w">            </span><span class="no">name: inspec-profiles-${CI_PIPELINE_ID}</span>
</span><span id="__span-5-138"><a id="__codelineno-5-138" name="__codelineno-5-138"></a><span class="w">        </span><span class="no">- name: thresholds</span>
</span><span id="__span-5-139"><a id="__codelineno-5-139" name="__codelineno-5-139"></a><span class="w">          </span><span class="no">configMap:</span>
</span><span id="__span-5-140"><a id="__codelineno-5-140" name="__codelineno-5-140"></a><span class="w">            </span><span class="no">name: inspec-thresholds-${CI_PIPELINE_ID}</span>
</span><span id="__span-5-141"><a id="__codelineno-5-141" name="__codelineno-5-141"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-5-142"><a id="__codelineno-5-142" name="__codelineno-5-142"></a>
</span><span id="__span-5-143"><a id="__codelineno-5-143" name="__codelineno-5-143"></a><span class="w">      </span><span class="no"># Wait for pod to be ready</span>
</span><span id="__span-5-144"><a id="__codelineno-5-144" name="__codelineno-5-144"></a><span class="w">      </span><span class="no">kubectl wait --for=condition=ready pod/app-scanner-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE} --timeout=300s</span>
</span><span id="__span-5-145"><a id="__codelineno-5-145" name="__codelineno-5-145"></a>
</span><span id="__span-5-146"><a id="__codelineno-5-146" name="__codelineno-5-146"></a><span class="w">      </span><span class="no"># Save pod name for later stages</span>
</span><span id="__span-5-147"><a id="__codelineno-5-147" name="__codelineno-5-147"></a><span class="w">      </span><span class="no">echo &quot;SCANNER_POD=app-scanner-${CI_PIPELINE_ID}&quot; &gt;&gt; deploy.env</span>
</span><span id="__span-5-148"><a id="__codelineno-5-148" name="__codelineno-5-148"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-5-149"><a id="__codelineno-5-149" name="__codelineno-5-149"></a><span class="w">      </span><span class="no"># Verify the pod is ready</span>
</span><span id="__span-5-150"><a id="__codelineno-5-150" name="__codelineno-5-150"></a><span class="w">      </span><span class="no">kubectl get pod app-scanner-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE}</span>
</span><span id="__span-5-151"><a id="__codelineno-5-151" name="__codelineno-5-151"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-5-152"><a id="__codelineno-5-152" name="__codelineno-5-152"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-5-153"><a id="__codelineno-5-153" name="__codelineno-5-153"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy.env</span>
</span><span id="__span-5-154"><a id="__codelineno-5-154" name="__codelineno-5-154"></a>
</span><span id="__span-5-155"><a id="__codelineno-5-155" name="__codelineno-5-155"></a><span class="nt">retrieve_results</span><span class="p">:</span>
</span><span id="__span-5-156"><a id="__codelineno-5-156" name="__codelineno-5-156"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id="__span-5-157"><a id="__codelineno-5-157" name="__codelineno-5-157"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">deploy_sidecar_pod</span><span class="p p-Indicator">]</span>
</span><span id="__span-5-158"><a id="__codelineno-5-158" name="__codelineno-5-158"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-5-159"><a id="__codelineno-5-159" name="__codelineno-5-159"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-5-160"><a id="__codelineno-5-160" name="__codelineno-5-160"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-5-161"><a id="__codelineno-5-161" name="__codelineno-5-161"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-5-162"><a id="__codelineno-5-162" name="__codelineno-5-162"></a><span class="w">      </span><span class="no"># Wait for scan to complete</span>
</span><span id="__span-5-163"><a id="__codelineno-5-163" name="__codelineno-5-163"></a><span class="w">      </span><span class="no">echo &quot;Waiting for scan to complete...&quot;</span>
</span><span id="__span-5-164"><a id="__codelineno-5-164" name="__codelineno-5-164"></a><span class="w">      </span><span class="no">until kubectl exec -it ${SCANNER_POD} -n ${SCANNER_NAMESPACE} -c scanner -- ls /results/scan-complete &gt;/dev/null 2&gt;&amp;1; do</span>
</span><span id="__span-5-165"><a id="__codelineno-5-165" name="__codelineno-5-165"></a><span class="w">        </span><span class="no">echo &quot;Scan in progress...&quot;</span>
</span><span id="__span-5-166"><a id="__codelineno-5-166" name="__codelineno-5-166"></a><span class="w">        </span><span class="no">sleep 5</span>
</span><span id="__span-5-167"><a id="__codelineno-5-167" name="__codelineno-5-167"></a><span class="w">      </span><span class="no">done</span>
</span><span id="__span-5-168"><a id="__codelineno-5-168" name="__codelineno-5-168"></a>
</span><span id="__span-5-169"><a id="__codelineno-5-169" name="__codelineno-5-169"></a><span class="w">      </span><span class="no"># Retrieve scan results using the service container</span>
</span><span id="__span-5-170"><a id="__codelineno-5-170" name="__codelineno-5-170"></a><span class="w">      </span><span class="no">echo &quot;Retrieving scan results...&quot;</span>
</span><span id="__span-5-171"><a id="__codelineno-5-171" name="__codelineno-5-171"></a><span class="w">      </span><span class="no">kubectl cp ${SCANNER_NAMESPACE}/${SCANNER_POD}:/results/scan-results.json /tmp/scan-results.json -c scanner</span>
</span><span id="__span-5-172"><a id="__codelineno-5-172" name="__codelineno-5-172"></a><span class="w">      </span><span class="no">kubectl cp ${SCANNER_NAMESPACE}/${SCANNER_POD}:/results/scan-summary.md /tmp/scan-summary.md -c scanner</span>
</span><span id="__span-5-173"><a id="__codelineno-5-173" name="__codelineno-5-173"></a>
</span><span id="__span-5-174"><a id="__codelineno-5-174" name="__codelineno-5-174"></a><span class="w">      </span><span class="no"># Copy results to service container for processing</span>
</span><span id="__span-5-175"><a id="__codelineno-5-175" name="__codelineno-5-175"></a><span class="w">      </span><span class="no">docker cp /tmp/scan-results.json cinc-scanner:/tmp/</span>
</span><span id="__span-5-176"><a id="__codelineno-5-176" name="__codelineno-5-176"></a><span class="w">      </span><span class="no">docker cp /tmp/scan-summary.md cinc-scanner:/tmp/</span>
</span><span id="__span-5-177"><a id="__codelineno-5-177" name="__codelineno-5-177"></a>
</span><span id="__span-5-178"><a id="__codelineno-5-178" name="__codelineno-5-178"></a><span class="w">      </span><span class="no"># Process results in the service container</span>
</span><span id="__span-5-179"><a id="__codelineno-5-179" name="__codelineno-5-179"></a><span class="w">      </span><span class="no">docker exec cinc-scanner bash -c &quot;</span>
</span><span id="__span-5-180"><a id="__codelineno-5-180" name="__codelineno-5-180"></a><span class="w">        </span><span class="no"># Generate normalized report</span>
</span><span id="__span-5-181"><a id="__codelineno-5-181" name="__codelineno-5-181"></a><span class="w">        </span><span class="no">saf normalize -i /tmp/scan-results.json -o /tmp/normalized-results.json</span>
</span><span id="__span-5-182"><a id="__codelineno-5-182" name="__codelineno-5-182"></a>
</span><span id="__span-5-183"><a id="__codelineno-5-183" name="__codelineno-5-183"></a><span class="w">        </span><span class="no"># Additional report processing</span>
</span><span id="__span-5-184"><a id="__codelineno-5-184" name="__codelineno-5-184"></a><span class="w">        </span><span class="no">saf view -i /tmp/scan-results.json --output /tmp/scan-report.html</span>
</span><span id="__span-5-185"><a id="__codelineno-5-185" name="__codelineno-5-185"></a><span class="w">      </span><span class="no">&quot;</span>
</span><span id="__span-5-186"><a id="__codelineno-5-186" name="__codelineno-5-186"></a>
</span><span id="__span-5-187"><a id="__codelineno-5-187" name="__codelineno-5-187"></a><span class="w">      </span><span class="no"># Copy processed results back</span>
</span><span id="__span-5-188"><a id="__codelineno-5-188" name="__codelineno-5-188"></a><span class="w">      </span><span class="no">docker cp cinc-scanner:/tmp/normalized-results.json ./normalized-results.json</span>
</span><span id="__span-5-189"><a id="__codelineno-5-189" name="__codelineno-5-189"></a><span class="w">      </span><span class="no">docker cp cinc-scanner:/tmp/scan-report.html ./scan-report.html</span>
</span><span id="__span-5-190"><a id="__codelineno-5-190" name="__codelineno-5-190"></a><span class="w">      </span><span class="no">docker cp cinc-scanner:/tmp/scan-results.json ./scan-results.json</span>
</span><span id="__span-5-191"><a id="__codelineno-5-191" name="__codelineno-5-191"></a><span class="w">      </span><span class="no">docker cp cinc-scanner:/tmp/scan-summary.md ./scan-summary.md</span>
</span><span id="__span-5-192"><a id="__codelineno-5-192" name="__codelineno-5-192"></a>
</span><span id="__span-5-193"><a id="__codelineno-5-193" name="__codelineno-5-193"></a><span class="w">      </span><span class="no"># Check threshold result</span>
</span><span id="__span-5-194"><a id="__codelineno-5-194" name="__codelineno-5-194"></a><span class="w">      </span><span class="no">if kubectl exec -it ${SCANNER_POD} -n ${SCANNER_NAMESPACE} -c scanner -- cat /results/threshold-result.txt &gt;/dev/null 2&gt;&amp;1; then</span>
</span><span id="__span-5-195"><a id="__codelineno-5-195" name="__codelineno-5-195"></a><span class="w">        </span><span class="no">THRESHOLD_RESULT=$(kubectl exec -it ${SCANNER_POD} -n ${SCANNER_NAMESPACE} -c scanner -- cat /results/threshold-result.txt)</span>
</span><span id="__span-5-196"><a id="__codelineno-5-196" name="__codelineno-5-196"></a><span class="w">        </span><span class="no">echo &quot;THRESHOLD_PASSED=${THRESHOLD_RESULT}&quot; &gt;&gt; scan.env</span>
</span><span id="__span-5-197"><a id="__codelineno-5-197" name="__codelineno-5-197"></a>
</span><span id="__span-5-198"><a id="__codelineno-5-198" name="__codelineno-5-198"></a><span class="w">        </span><span class="no">if [ &quot;${THRESHOLD_RESULT}&quot; -eq 0 ]; then</span>
</span><span id="__span-5-199"><a id="__codelineno-5-199" name="__codelineno-5-199"></a><span class="w">          </span><span class="no">echo &quot; Security scan passed threshold requirements&quot;</span>
</span><span id="__span-5-200"><a id="__codelineno-5-200" name="__codelineno-5-200"></a><span class="w">        </span><span class="no">else</span>
</span><span id="__span-5-201"><a id="__codelineno-5-201" name="__codelineno-5-201"></a><span class="w">          </span><span class="no">echo &quot; Security scan failed to meet threshold requirements&quot;</span>
</span><span id="__span-5-202"><a id="__codelineno-5-202" name="__codelineno-5-202"></a><span class="w">        </span><span class="no">fi</span>
</span><span id="__span-5-203"><a id="__codelineno-5-203" name="__codelineno-5-203"></a><span class="w">      </span><span class="no">else</span>
</span><span id="__span-5-204"><a id="__codelineno-5-204" name="__codelineno-5-204"></a><span class="w">        </span><span class="no">echo &quot;Warning: Threshold result not found&quot;</span>
</span><span id="__span-5-205"><a id="__codelineno-5-205" name="__codelineno-5-205"></a><span class="w">        </span><span class="no">echo &quot;THRESHOLD_PASSED=1&quot; &gt;&gt; scan.env</span>
</span><span id="__span-5-206"><a id="__codelineno-5-206" name="__codelineno-5-206"></a><span class="w">      </span><span class="no">fi</span>
</span><span id="__span-5-207"><a id="__codelineno-5-207" name="__codelineno-5-207"></a>
</span><span id="__span-5-208"><a id="__codelineno-5-208" name="__codelineno-5-208"></a><span class="w">      </span><span class="no"># Display summary in job output</span>
</span><span id="__span-5-209"><a id="__codelineno-5-209" name="__codelineno-5-209"></a><span class="w">      </span><span class="no">echo &quot;============= SCAN SUMMARY =============&quot;</span>
</span><span id="__span-5-210"><a id="__codelineno-5-210" name="__codelineno-5-210"></a><span class="w">      </span><span class="no">cat scan-summary.md</span>
</span><span id="__span-5-211"><a id="__codelineno-5-211" name="__codelineno-5-211"></a><span class="w">      </span><span class="no">echo &quot;========================================&quot;</span>
</span><span id="__span-5-212"><a id="__codelineno-5-212" name="__codelineno-5-212"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-5-213"><a id="__codelineno-5-213" name="__codelineno-5-213"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-5-214"><a id="__codelineno-5-214" name="__codelineno-5-214"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-results.json</span>
</span><span id="__span-5-215"><a id="__codelineno-5-215" name="__codelineno-5-215"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-summary.md</span>
</span><span id="__span-5-216"><a id="__codelineno-5-216" name="__codelineno-5-216"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">normalized-results.json</span>
</span><span id="__span-5-217"><a id="__codelineno-5-217" name="__codelineno-5-217"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-report.html</span>
</span><span id="__span-5-218"><a id="__codelineno-5-218" name="__codelineno-5-218"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-5-219"><a id="__codelineno-5-219" name="__codelineno-5-219"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan.env</span>
</span><span id="__span-5-220"><a id="__codelineno-5-220" name="__codelineno-5-220"></a>
</span><span id="__span-5-221"><a id="__codelineno-5-221" name="__codelineno-5-221"></a><span class="c1"># This example shows how to utilize the service container </span>
</span><span id="__span-5-222"><a id="__codelineno-5-222" name="__codelineno-5-222"></a><span class="c1"># to generate specialized reports from the scan results</span>
</span><span id="__span-5-223"><a id="__codelineno-5-223" name="__codelineno-5-223"></a><span class="nt">generate_report</span><span class="p">:</span>
</span><span id="__span-5-224"><a id="__codelineno-5-224" name="__codelineno-5-224"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">report</span>
</span><span id="__span-5-225"><a id="__codelineno-5-225" name="__codelineno-5-225"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">retrieve_results</span><span class="p p-Indicator">]</span>
</span><span id="__span-5-226"><a id="__codelineno-5-226" name="__codelineno-5-226"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-5-227"><a id="__codelineno-5-227" name="__codelineno-5-227"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-5-228"><a id="__codelineno-5-228" name="__codelineno-5-228"></a><span class="w">      </span><span class="no"># Use the service container to generate comprehensive reports</span>
</span><span id="__span-5-229"><a id="__codelineno-5-229" name="__codelineno-5-229"></a><span class="w">      </span><span class="no">docker cp scan-results.json cinc-scanner:/tmp/</span>
</span><span id="__span-5-230"><a id="__codelineno-5-230" name="__codelineno-5-230"></a>
</span><span id="__span-5-231"><a id="__codelineno-5-231" name="__codelineno-5-231"></a><span class="w">      </span><span class="no"># Generate multiple report formats in the service container</span>
</span><span id="__span-5-232"><a id="__codelineno-5-232" name="__codelineno-5-232"></a><span class="w">      </span><span class="no">docker exec cinc-scanner bash -c &quot;</span>
</span><span id="__span-5-233"><a id="__codelineno-5-233" name="__codelineno-5-233"></a><span class="w">        </span><span class="no">cd /tmp</span>
</span><span id="__span-5-234"><a id="__codelineno-5-234" name="__codelineno-5-234"></a>
</span><span id="__span-5-235"><a id="__codelineno-5-235" name="__codelineno-5-235"></a><span class="w">        </span><span class="no"># Generate HTML report</span>
</span><span id="__span-5-236"><a id="__codelineno-5-236" name="__codelineno-5-236"></a><span class="w">        </span><span class="no">saf view -i scan-results.json --output enhanced-report.html</span>
</span><span id="__span-5-237"><a id="__codelineno-5-237" name="__codelineno-5-237"></a>
</span><span id="__span-5-238"><a id="__codelineno-5-238" name="__codelineno-5-238"></a><span class="w">        </span><span class="no"># Generate CSV report</span>
</span><span id="__span-5-239"><a id="__codelineno-5-239" name="__codelineno-5-239"></a><span class="w">        </span><span class="no">saf generate -i scan-results.json -o csv &gt; results.csv</span>
</span><span id="__span-5-240"><a id="__codelineno-5-240" name="__codelineno-5-240"></a>
</span><span id="__span-5-241"><a id="__codelineno-5-241" name="__codelineno-5-241"></a><span class="w">        </span><span class="no"># Generate Excel report</span>
</span><span id="__span-5-242"><a id="__codelineno-5-242" name="__codelineno-5-242"></a><span class="w">        </span><span class="no">saf generate -i scan-results.json -o xlsx &gt; results.xlsx</span>
</span><span id="__span-5-243"><a id="__codelineno-5-243" name="__codelineno-5-243"></a>
</span><span id="__span-5-244"><a id="__codelineno-5-244" name="__codelineno-5-244"></a><span class="w">        </span><span class="no"># Generate JUnit report for CI integration</span>
</span><span id="__span-5-245"><a id="__codelineno-5-245" name="__codelineno-5-245"></a><span class="w">        </span><span class="no">saf generate -i scan-results.json -o junit &gt; junit.xml</span>
</span><span id="__span-5-246"><a id="__codelineno-5-246" name="__codelineno-5-246"></a><span class="w">      </span><span class="no">&quot;</span>
</span><span id="__span-5-247"><a id="__codelineno-5-247" name="__codelineno-5-247"></a>
</span><span id="__span-5-248"><a id="__codelineno-5-248" name="__codelineno-5-248"></a><span class="w">      </span><span class="no"># Copy all reports back</span>
</span><span id="__span-5-249"><a id="__codelineno-5-249" name="__codelineno-5-249"></a><span class="w">      </span><span class="no">docker cp cinc-scanner:/tmp/enhanced-report.html ./enhanced-report.html</span>
</span><span id="__span-5-250"><a id="__codelineno-5-250" name="__codelineno-5-250"></a><span class="w">      </span><span class="no">docker cp cinc-scanner:/tmp/results.csv ./results.csv</span>
</span><span id="__span-5-251"><a id="__codelineno-5-251" name="__codelineno-5-251"></a><span class="w">      </span><span class="no">docker cp cinc-scanner:/tmp/results.xlsx ./results.xlsx</span>
</span><span id="__span-5-252"><a id="__codelineno-5-252" name="__codelineno-5-252"></a><span class="w">      </span><span class="no">docker cp cinc-scanner:/tmp/junit.xml ./junit.xml</span>
</span><span id="__span-5-253"><a id="__codelineno-5-253" name="__codelineno-5-253"></a>
</span><span id="__span-5-254"><a id="__codelineno-5-254" name="__codelineno-5-254"></a><span class="w">      </span><span class="no"># Create a simple markdown report for the MR</span>
</span><span id="__span-5-255"><a id="__codelineno-5-255" name="__codelineno-5-255"></a><span class="w">      </span><span class="no">cat &gt; scan-report.md &lt;&lt; EOF</span>
</span><span id="__span-5-256"><a id="__codelineno-5-256" name="__codelineno-5-256"></a><span class="w">      </span><span class="no"># Security Scan Results</span>
</span><span id="__span-5-257"><a id="__codelineno-5-257" name="__codelineno-5-257"></a>
</span><span id="__span-5-258"><a id="__codelineno-5-258" name="__codelineno-5-258"></a><span class="w">      </span><span class="no">## Summary</span>
</span><span id="__span-5-259"><a id="__codelineno-5-259" name="__codelineno-5-259"></a>
</span><span id="__span-5-260"><a id="__codelineno-5-260" name="__codelineno-5-260"></a><span class="w">      </span><span class="no">$(cat scan-summary.md)</span>
</span><span id="__span-5-261"><a id="__codelineno-5-261" name="__codelineno-5-261"></a>
</span><span id="__span-5-262"><a id="__codelineno-5-262" name="__codelineno-5-262"></a><span class="w">      </span><span class="no">## Threshold Check</span>
</span><span id="__span-5-263"><a id="__codelineno-5-263" name="__codelineno-5-263"></a>
</span><span id="__span-5-264"><a id="__codelineno-5-264" name="__codelineno-5-264"></a><span class="w">      </span><span class="no">$([ &quot;${THRESHOLD_PASSED}&quot; -eq 0 ] &amp;&amp; echo &quot; **PASSED**&quot; || echo &quot; **FAILED**&quot;)</span>
</span><span id="__span-5-265"><a id="__codelineno-5-265" name="__codelineno-5-265"></a>
</span><span id="__span-5-266"><a id="__codelineno-5-266" name="__codelineno-5-266"></a><span class="w">      </span><span class="no">Threshold: ${THRESHOLD_VALUE}%</span>
</span><span id="__span-5-267"><a id="__codelineno-5-267" name="__codelineno-5-267"></a>
</span><span id="__span-5-268"><a id="__codelineno-5-268" name="__codelineno-5-268"></a><span class="w">      </span><span class="no">## Details</span>
</span><span id="__span-5-269"><a id="__codelineno-5-269" name="__codelineno-5-269"></a>
</span><span id="__span-5-270"><a id="__codelineno-5-270" name="__codelineno-5-270"></a><span class="w">      </span><span class="no">For full results, see the enhanced report artifacts.</span>
</span><span id="__span-5-271"><a id="__codelineno-5-271" name="__codelineno-5-271"></a>
</span><span id="__span-5-272"><a id="__codelineno-5-272" name="__codelineno-5-272"></a><span class="w">      </span><span class="no">* HTML Report: enhanced-report.html</span>
</span><span id="__span-5-273"><a id="__codelineno-5-273" name="__codelineno-5-273"></a><span class="w">      </span><span class="no">* CSV Report: results.csv</span>
</span><span id="__span-5-274"><a id="__codelineno-5-274" name="__codelineno-5-274"></a><span class="w">      </span><span class="no">* Excel Report: results.xlsx</span>
</span><span id="__span-5-275"><a id="__codelineno-5-275" name="__codelineno-5-275"></a><span class="w">      </span><span class="no">* JUnit Report: junit.xml</span>
</span><span id="__span-5-276"><a id="__codelineno-5-276" name="__codelineno-5-276"></a><span class="w">      </span><span class="no">EOF</span>
</span><span id="__span-5-277"><a id="__codelineno-5-277" name="__codelineno-5-277"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-5-278"><a id="__codelineno-5-278" name="__codelineno-5-278"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-5-279"><a id="__codelineno-5-279" name="__codelineno-5-279"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enhanced-report.html</span>
</span><span id="__span-5-280"><a id="__codelineno-5-280" name="__codelineno-5-280"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">results.csv</span>
</span><span id="__span-5-281"><a id="__codelineno-5-281" name="__codelineno-5-281"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">results.xlsx</span>
</span><span id="__span-5-282"><a id="__codelineno-5-282" name="__codelineno-5-282"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">junit.xml</span>
</span><span id="__span-5-283"><a id="__codelineno-5-283" name="__codelineno-5-283"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scan-report.md</span>
</span><span id="__span-5-284"><a id="__codelineno-5-284" name="__codelineno-5-284"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-5-285"><a id="__codelineno-5-285" name="__codelineno-5-285"></a><span class="w">      </span><span class="nt">junit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">junit.xml</span>
</span><span id="__span-5-286"><a id="__codelineno-5-286" name="__codelineno-5-286"></a><span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
</span><span id="__span-5-287"><a id="__codelineno-5-287" name="__codelineno-5-287"></a>
</span><span id="__span-5-288"><a id="__codelineno-5-288" name="__codelineno-5-288"></a><span class="nt">cleanup</span><span class="p">:</span>
</span><span id="__span-5-289"><a id="__codelineno-5-289" name="__codelineno-5-289"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
</span><span id="__span-5-290"><a id="__codelineno-5-290" name="__codelineno-5-290"></a><span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">retrieve_results</span><span class="p p-Indicator">]</span>
</span><span id="__span-5-291"><a id="__codelineno-5-291" name="__codelineno-5-291"></a><span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span><span class="w">  </span><span class="c1"># Run even if previous stages failed</span>
</span><span id="__span-5-292"><a id="__codelineno-5-292" name="__codelineno-5-292"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-5-293"><a id="__codelineno-5-293" name="__codelineno-5-293"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$KUBE_CONFIG&quot; | base64 -d &gt; kubeconfig.yaml</span>
</span><span id="__span-5-294"><a id="__codelineno-5-294" name="__codelineno-5-294"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export KUBECONFIG=kubeconfig.yaml</span>
</span><span id="__span-5-295"><a id="__codelineno-5-295" name="__codelineno-5-295"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-5-296"><a id="__codelineno-5-296" name="__codelineno-5-296"></a><span class="w">      </span><span class="no"># Delete all resources</span>
</span><span id="__span-5-297"><a id="__codelineno-5-297" name="__codelineno-5-297"></a><span class="w">      </span><span class="no">kubectl delete pod/${SCANNER_POD} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-5-298"><a id="__codelineno-5-298" name="__codelineno-5-298"></a><span class="w">      </span><span class="no">kubectl delete configmap/inspec-profiles-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span><span id="__span-5-299"><a id="__codelineno-5-299" name="__codelineno-5-299"></a><span class="w">      </span><span class="no">kubectl delete configmap/inspec-thresholds-${CI_PIPELINE_ID} -n ${SCANNER_NAMESPACE} --ignore-not-found</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>These pipeline examples are designed to be adapted to your specific environment. Each example includes detailed comments explaining the purpose of each step and how to customize it for your needs.</p>
<div class="admonition note">
<p class="admonition-title">Strategic Priority</p>
<p>We strongly recommend the Kubernetes API Approach (standard GitLab CI example) for enterprise-grade container scanning. Our highest priority is enhancing the train-k8s-container plugin to support distroless containers. The other examples provide interim solutions until this enhancement is complete.</p>
</div>
<p>For detailed information on which scanning approach to use in different scenarios, see:</p>
<ul>
<li><a href="../approaches/comparison/">Approach Comparison</a></li>
<li><a href="../approaches/decision-matrix/">Approach Decision Matrix</a></li>
</ul>
<p>For detailed GitLab integration instructions, see the <a href="../integration/platforms/gitlab-ci/">GitLab Integration Guide</a>.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <!-- 
  This template extends the base Material theme to add a dynamic year
  in the copyright notice.
-->

<div class="md-copyright">
  
     2025 The MITRE Corporation. Brought to you by the <a href="https://saf.mitre.org">MITRE Security Automation Framework (SAF)</a>
  
</div>

      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/mitre" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/mitre" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://saf.mitre.org" target="_blank" rel="noopener" title="MITRE Security Automation Framework" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M256 0c4.6 0 9.2 1 13.4 2.9l188.3 79.9c22 9.3 38.4 31 38.3 57.2-.5 99.2-41.3 280.7-213.6 363.2-16.7 8-36.1 8-52.8 0C57.3 420.7 16.5 239.2 16 140c-.1-26.2 16.3-47.9 38.3-57.2L242.7 2.9C246.8 1 251.4 0 256 0"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "content.code.copy", "content.code.annotate", "content.code.select", "content.code.link", "content.tabs.link"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../js/mermaid-config.js"></script>
      
    
  </body>
</html>